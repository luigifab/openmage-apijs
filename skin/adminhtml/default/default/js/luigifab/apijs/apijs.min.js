/**
 * Copyright 2008-2015 | Fabrice Creuzot (luigifab) <code~luigifab~info>
 * (5.2.0) http://www.luigifab.info/magento/wiki/apijs
 *
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
if(!Function.prototype.hasOwnProperty('bind')){Function.prototype.bind=function(owner){var that=this,args=Array.prototype.slice.call(arguments,1);return function(){return that.apply(owner,(args.length===0)?arguments:(arguments.length===0)?args:args.concat(Array.prototype.slice.call(arguments,0)));};};}
if(!String.prototype.hasOwnProperty('trim')){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,'');};}
if(!Array.prototype.hasOwnProperty('has')){Array.prototype.has=function(needle){var key;if(needle instanceof Array){for(key in needle)if(needle.hasOwnProperty(key)){if(this.has(needle[key]))
return true;}}
else{for(key in this)if(this.hasOwnProperty(key)){if(!isNaN(key)&&(this[key]===needle))
return true;}}
return false;};}
var apijs={core:{},version:520,config:{lang:'auto',debug:false,dialog:{emotes:true,player:true,closeOnClick:false,restrictNavigation:true,imagePrev:null,imageNext:null,imageClose:null},slideshow:{ids:'slideshow',anchor:true},upload:{tokenName:'authenticity_token',tokenValue:null}},start:function(){var ua=navigator.userAgent,test=[],v;test.push(/Presto|Opera/.test(ua));test.push(0);v=ua.slice(ua.indexOf('rv:')+3);v=parseFloat(v.slice(0,v.indexOf(')')));test.push(('Gecko/'.indexOf(ua)>0)&&(v<2));test.push(v);v=ua.slice(ua.indexOf('WebKit/')+7);v=parseFloat(v.slice(0,v.indexOf(' ')));test.push(('WebKit/'.indexOf(ua)>0)&&(v<536.25));test.push(v);try{console.info('APIJS '+this.version.toString().replace(/([0-9]+)([0-9])([0-9])$/g,'$1.$2.$3')+' Hello!');console.info('APIJS oldPresto='+test[0]+' oldGecko='+test[2]+'/'+test[3]+' oldWebKit='+test[4]+'/'+test[5]);}
catch(e){window.console={info:function(){},warn:function(){},log:function(){}};}
if(test.has(true)){console.warn('APIJS canceled for old browser');return;}
this.i18n=new this.core.i18n();this.dialog=new this.core.dialog();this.upload=new this.core.upload();this.slideshow=new this.core.slideshow();if(typeof setApijsRewrites==='function')
setApijsRewrites();if(typeof setApijsLang==='function')
setApijsLang();if(typeof setApijsConfig==='function')
setApijsConfig();if(this.config.debug){this.logger(this.i18n,'apijs.i18n.');this.logger(this.dialog,'apijs.dialog.');this.logger(this.upload,'apijs.upload.');this.logger(this.slideshow,'apijs.slideshow.');console.info('APIJS debug mode enabled');console.info('APIJS available languages: '+Object.keys(this.i18n.data).join(','));console.info('APIJS setApijsLang:'+((typeof setApijsLang==='function')?'yes':'no')+' setApijsConfig:'+((typeof setApijsConfig==='function')?'yes':'no')+' setApijsRewrites:'+((typeof setApijsRewrites==='function')?'yes':'no'));}
this.i18n.init();this.slideshow.init();window.addEventListener('popstate',apijs.slideshow.popState,false);window.addEventListener('hashchange',apijs.slideshow.popState,false);if(this.config.debug){console.info('APIJS language loaded: '+this.config.lang);console.info('APIJS slideshows loaded: '+this.slideshow.started);console.info('APIJS successfully started');}},error:function(method,data){var key,text=[];if(typeof data==='string'){text.push(data);}
else{for(key in data)if(data.hasOwnProperty(key))
text.push(key+': '+data[key]);}
if(this.config.debug)
this.dialog.dialogInformation('(debug) Invalid call','[pre]'+method+'[br]➩ '+text.join('[br]➩ '),'debug');console.warn(method+' => '+text.join(' / '));},openTab:function(ev){ev.preventDefault();window.open(this.href);},serialize:function(form){var nodeName,nodeType,i,j,q=[];for(i=form.elements.length-1;i>=0;i=i-1){nodeName=form.elements[i].nodeName;nodeType=form.elements[i].type;if(nodeName==='INPUT'){if(['checkbox','radio'].has(nodeType)){if(form.elements[i].checked)
q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].value));}
else if(['file','button','reset','submit'].has(nodeType)){q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].value));}}
else if(nodeName==='TEXTAREA'){q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].value));}
else if(nodeName==='SELECT'){if(nodeType==='select-multiple'){for(j=form.elements[i].options.length-1;j>=0;j=j-1){if(form.elements[i].options[j].selected)
q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].options[j].value));}}
else{q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].value));}}}
return q.join('&');},logger:function(src,scope){for(var func in src){if(typeof(src[func])==='function'){apijs.methods[scope+func]=src[func];(function(){var functionName=func;src[functionName]=function(){var args=[].splice.call(arguments,0);if(functionName.indexOf('ranslate')<0){if((functionName.indexOf('dialog')>-1)||(functionName.indexOf('sendFile')>-1))
console.info('displaying '+scope+functionName+'()');else if(functionName.indexOf('popState')>-1)
console.info('history '+scope+functionName+'()');else if(functionName.indexOf('actionKey')>-1)
console.log(scope+functionName+'('+(isNaN(args[0])?args[0].keyCode:args[0])+')');else
console.log(scope+functionName+'('+args.join(', ')+')');}
return apijs.methods[scope+functionName].apply(src,args);};})();}}},methods:{}};if(typeof window.addEventListener==='function')
window.addEventListener('load',apijs.start.bind(apijs),false);
apijs.core.i18n=function(){this.data=[];this.data.de={buttonOk:"Ok",buttonCancel:"Abbrechen",buttonConfirm:"Bestätigen",buttonClose:"Schließen",buttonPrev:"Zurück",buttonNext:"Weiter",buttonBrowse:"Datei wählen",userLeavePage:"Du bist dabei die Seite zu verlassen...",operationTooLong:"Diese Operation dauert zu lange? ",warningLostChange:"Achtung: Alle derzeitigen Änderungen werden nicht gespeichert!",reloadLink:"laden Sie diese Seite",operationInProgress:"Verarbeitung läuft...",uploadInProgress:"Upload Vorgang...",imageError404:"Fehler 404\nDie Datei nicht existiert.",videoError:"Leider kann das Video momentan nicht wiedergegeben werden. Es ist möglich, dass die Datei vorübergehend nicht verfügbar ist oder dass Dein Browser das Video Format nicht lesen kann.[br][br]Versuche das Video [a href='§' title='§' download='§']downzuloaden[/a].",ctrlSlideshowFirstLast:"anfang/ende",ctrlSlideshowNextPrev:"zurück/weiter",ctrlVideoPause:"wiedergabe/pause",ctrlVideoTime:"rückwärts/vorwärts",ctrlVideoSound:"leiser/lauter",ctrlVideoMute:"stumm",ctrlDialogFullscreen:"vollbild",ctrlDialogQuit:"beenden",ctrlKeyEnd:"Ende",ctrlKeyEsc:"Esc",uploadAllType:"Alle Dateien wurden akzeptiert.[br]Maximale Grösse: § MB.",uploadOneType:"Aakzeptiertes Dateiformat: §.[br]Maximale Grösse: § MB.",uploadMultiType:"Aakzeptierte Dateiformate: § und §.[br]Maximale Grösse: § MB.",uploadDecimal:",",upload11:"§% - § KB/s - Noch § Minuten",upload12:"§% - § KB/s - Noch § Minute",upload13:"§% - § KB/s - Noch § Sekunden",upload14:"§% - § KB/s",upload21:"§% - bis § KB/s in § Minuten",upload22:"§% - bis § KB/s in § Minute",upload23:"§% - bis § KB/s in § Sekunden",upload24:"§% - bis § KB/s",uploadBadType:"Es ist nicht möglich die Datei zu senden weil das Dateiformat nicht unterstützt wird. Aktuelles Dateiformat: §.",uploadBadSize:"Es ist nicht möglich die Datei zu senden weil die Datei zu gross ist. Aktuelle Dateigrösse: § MB.",uploadEmpty:"Es ist nicht möglich die Datei zu senden weil die Datei keine Daten enthält.",uploadError0:"Es ist eun unerwarteter Fehler aufgetreten... Bitte versuchen Sie es noch einmal.",uploadError1:"Es ist ein Fehler beim Senden der Datei aufgetreten.[br][em]➩ Fehler §.[em]",uploadError2:"Es ist ein Fehler bei der Verarbeitung der Datei aufgetreten.[br][em]➩ §[/em]"};this.data.en={buttonOk:"Ok",buttonCancel:"Cancel",buttonConfirm:"Confirm",buttonClose:"Close",buttonPrev:"Previous",buttonNext:"Next",buttonBrowse:"Choose a file",userLeavePage:"You are about to leave...",operationTooLong:"This operation is too long? ",warningLostChange:"Warning: all changes in progress will be lost.",reloadLink:"Reload this page",operationInProgress:"Operation in progress...",uploadInProgress:"Upload in progress...",imageError404:"Error 404\nThe file does not exist.",videoError:"Unfortunately, it is not possible to play this video for now. Maybe the file is temporarily unavailable or your browser can't read the format of the video.[br][br]Try to [a href='§' title='§' download='§']download[/a] the video.",ctrlSlideshowFirstLast:"start/end",ctrlSlideshowNextPrev:"previous/next",ctrlVideoPause:"play/pause",ctrlVideoTime:"backward/forward",ctrlVideoSound:"decrease/increase the volume",ctrlVideoMute:"mute",ctrlDialogFullscreen:"full screen",ctrlDialogQuit:"quit",ctrlKeyEnd:"End",ctrlKeyEsc:"Escape",uploadAllType:"All files are accepted.[br]Maximum size: § MB.",uploadOneType:"Accepted file format: §.[br]Maximum size: § MB.",uploadMultiType:"Accepted file formats: § and §.[br]Maximum size: § MB.",uploadDecimal:".",upload11:"§% - § KB/s - § minutes left",upload12:"§% - § KB/s - § minute left",upload13:"§% - § KB/s - § seconds left",upload14:"§% - § KB/s",upload21:"§% - at § KB/s in § minutes",upload22:"§% - at § KB/s in § minute",upload23:"§% - at § KB/s in § seconds",upload24:"§% - at § KB/s",uploadBadType:"It's impossible to send the file because the proposed file format isn't allowed. Proposed file format: §.",uploadBadSize:"It's impossible to send the file because the file size is too large. Proposed file size: § MB.",uploadEmpty:"It's impossible to send the file because the file is empty.",uploadError0:"It seems that a unlikely mistake just happened... Please try again.",uploadError1:"An error occurred while sending the file.[br][em]➩ Error §.[/em]",uploadError2:"An error occurred while processing the file.[br][em]➩ §[/em]"};this.data.es={buttonOk:"Aceptar",buttonCancel:"Cancelar",buttonConfirm:"Confirmar",buttonClose:"Cerrar",buttonPrev:"Anterior",buttonNext:"Siguiente",buttonBrowse:"Eligir un fichero",userLeavePage:"Está a punto de quitar...",operationTooLong:"Esta operación toma demasiado tiempo? ",warningLostChange:"Atención: todos los cambios en curso se perderán.",reloadLink:"Recargar esta página",operationInProgress:"Operación en curso...",uploadInProgress:"Subida de datos en curso...",imageError404:"Error 404\nEl fichero no existe.",videoError:"Desgraciadamente, no se puede leer esta video por el momento. Se puede que el fichero no sea accesible o que su navegador no pueda leer el formato de la video.[br][br]Intente [a href='§' title='§' download='§']cargar[/a] la video.",ctrlSlideshowFirstLast:"inicio/fin",ctrlSlideshowNextPrev:"anterior/siguiente",ctrlVideoPause:"reproducir/pausa",ctrlVideoTime:"atrás/adelante",ctrlVideoSound:"bajar/subir el volumen",ctrlVideoMute:"silenciar",ctrlDialogFullscreen:"pantalla completa",ctrlDialogQuit:"salir",ctrlKeyEnd:"Fin",ctrlKeyEsc:"Esc",uploadAllType:"Se aceptan todos los archivos.[br]Tamaño máximo: § MB.",uploadOneType:"Formato de archivo aceptado: §.[br]Tamaño máximo: § MB.",uploadMultiType:"Formatos de archivos aceptados: § y §.[br]Tamaño máximo: § MB.",uploadDecimal:".",upload11:"§% - § KB/s - § minutos restantes",upload12:"§% - § KB/s - § minuto restantes",upload13:"§% - § KB/s - § segundos restantes",upload14:"§% - § KB/s",upload21:"§% - a § KB/s en § minutos",upload22:"§% - a § KB/s en § minuto",upload23:"§% - a § KB/s en § segundos",upload24:"§% - a § KB/s",uploadBadType:"Fue imposible enviar el archivo porque no se permite el formato del archivo. El formato del archivo es: §.",uploadBadSize:"Fue imposible enviar el archivo porque el tamaño es demasiado elevado. El tamaño del archivo es: § MB.",uploadEmpty:"Fue imposible enviar el archivo porque el archivo está vacío.",uploadError0:"Parece que un error improbable acabo de pasar... Por favor, inténtelo de nuevo.",uploadError1:"Se produjo un error durante el envío del archivo.[br][em]➩ Error §.[/em]",uploadError2:"Se produjo un error durante el procesamiento del archivo.[br][em]➩ §[/em]"};this.data.fr={buttonOk:"Ok",buttonCancel:"Annuler",buttonConfirm:"Valider",buttonClose:"Fermer",buttonPrev:"Précédent",buttonNext:"Suivant",buttonBrowse:"Choisir un fichier",userLeavePage:"Vous vous apprêtez à partir...",operationTooLong:"Cette opération prend trop de temps ? ",warningLostChange:"Attention : toutes les modifications en cours seront perdues.",reloadLink:"Rechargez la page",operationInProgress:"Opération en cours...",uploadInProgress:"Envoi du fichier en cours...",imageError404:"Erreur 404\nLe fichier n'existe pas.",videoError:"Malheureusement, il n'est pas possible de lire cette vidéo pour le moment. Il se peut que le fichier soit temporairement inaccessible ou que votre navigateur ne puisse pas lire le format de la vidéo.[br][br]Essayez de [a href='§' title='§' download='§']télécharger[/a] la vidéo.",ctrlSlideshowFirstLast:"début/fin",ctrlSlideshowNextPrev:"précédent/suivant",ctrlVideoPause:"lecture/pause",ctrlVideoTime:"reculer/avancer",ctrlVideoSound:"baisser/augmenter le volume",ctrlVideoMute:"couper le son",ctrlDialogFullscreen:"plein écran",ctrlDialogQuit:"quitter",ctrlKeyEnd:"Fin",ctrlKeyEsc:"Échap",uploadAllType:"Tous les fichiers sont acceptés.[br]Taille maximale : § Mo.",uploadOneType:"Format de fichier accepté : §.[br]Taille maximale : § Mo.",uploadMultiType:"Formats de fichier acceptés : § et §.[br]Taille maximale : § Mo.",uploadDecimal:",",upload11:"§% - § Ko/s - § minutes restantes",upload12:"§% - § Ko/s - § minute restante",upload13:"§% - § Ko/s - § secondes restantes",upload14:"§% - § Ko/s",upload21:"§% - à § Ko/s en § minutes",upload22:"§% - à § Ko/s en § minute",upload23:"§% - à § Ko/s en § secondes",upload24:"§% - à § Ko/s",uploadBadType:"Il est impossible d'envoyer le fichier car le format du fichier proposé n'est pas autorisé. Format du fichier proposé : §.",uploadBadSize:"Il est impossible d'envoyer le fichier car la taille du fichier proposé est trop importante. Taille du fichier proposé : § Mo.",uploadEmpty:"Il est impossible d'envoyer le fichier car le fichier est vide.",uploadError0:"Il semblerait qu'une erreur improbable vient de se produire... Veuillez réessayer.",uploadError1:"Une erreur est survenue lors de l'envoi du fichier.[br][em]➩ Erreur §.[/em]",uploadError2:"Une erreur est survenue lors du traitement du fichier.[br][em]➩ §[/em]"};this.data.ru={buttonOk:"Ок",buttonCancel:"Отмена",buttonConfirm:"Подтвердить",buttonClose:"Закрыть",buttonPrev:"Предыдущий",buttonNext:"Следующий",buttonBrowse:"Выберите файл",userLeavePage:"Вы собираетесь покинуть...",operationTooLong:"Операция длится слишком долго? ",warningLostChange:"Внимание: все изменения будут потеряны.",reloadLink:"Обновить страницу",operationInProgress:"Операция в процессе...",uploadInProgress:"Загрузка в процессе...",imageError404:"Ошибка 404\nФайл не существует.",ctrlSlideshowFirstLast:"начало/конец",ctrlSlideshowNextPrev:"предыдущий/следующий",ctrlVideoPause:"воспроизведение/пауза",ctrlVideoTime:"назад/вперед",ctrlVideoSound:"понизить/повысить громкость",ctrlVideoMute:"отключить звук",ctrlDialogFullscreen:"на весь экран",ctrlDialogQuit:"выйти",ctrlKeyEnd:"End",ctrlKeyEsc:"Escape",uploadAllType:"Все файлы приняты.[br]Максимальный размер: § MB.",uploadOneType:"Формат файла: §.[br]Максимальный размер: § MB.",uploadMultiType:"Форматы файлов: § и §.[br]Максимальный размер: § MB.",uploadDecimal:".",upload11:"§% - § KB/s - осталось § минут",upload12:"§% - § KB/s - осталось § минут",upload13:"§% - § KB/s - осталось § секунд",upload14:"§% - § KB/s",upload21:"§% - § KB/s за § минут",upload22:"§% - § KB/s за § минут",upload23:"§% - § KB/s за § секунд",upload24:"§% - § KB/s",uploadBadType:"Нельзя отправить файл потому что формат файла запрещен. Рекомендуемый формат файла: §.",uploadBadSize:"Нельзя отправить файл потому что размер файла слишком велик. Рекомендуемый размер файла: § MB.",uploadEmpty:"Нельзя отправить файл поскольку он пуст.",uploadError0:"Кажется произошла не предусмотренная ошибка... Попробуйте еще раз.",uploadError1:"Возникла ошибка при отправке файла.[br][em]➩ Ошибка §.[/em]",uploadError2:"Возникла ошибка при обработке файла.[br][em]➩ §[/em]"};this.init=function(){var autolang,html=document.querySelector('html');if(apijs.config.lang.indexOf('auto')>-1){if(html.getAttribute('xml:lang'))
autolang=html.getAttribute('xml:lang').slice(0,2);else if(html.getAttribute('lang'))
autolang=html.getAttribute('lang').slice(0,2);if((typeof autolang==='string')&&this.data.hasOwnProperty(autolang))
apijs.config.lang=autolang;else if(apijs.config.lang.indexOf('auto-')>-1)
apijs.config.lang=apijs.config.lang.slice(5);}
if(!this.data.hasOwnProperty(apijs.config.lang))
apijs.config.lang='en';};this.translate=function(word){var lang=apijs.config.lang,i=0,arg=1,translation='',data;if(typeof this.data[lang][word]!=='string'){if((lang!=='en')&&(typeof this.data.en[word]==='string'))
lang='en';else
return word;}
if(arguments.length>1){for(data=this.data[lang][word].split('§');i<data.length;i++)
translation+=(arg<arguments.length)?data[i]+arguments[arg++]:data[i];return translation;}
return this.data[lang][word];};this.nodeTranslate=function(word){return document.createTextNode(this.translate(word));};this.changeLang=function(lang){if(typeof lang==='string'){if(this.data.hasOwnProperty(lang)){apijs.config.lang=lang;return true;}
if(lang.indexOf('auto')>-1){apijs.config.lang=lang;this.init();return true;}}
return false;};};
apijs.core.player=function(){this.media=null;this.player=null;this.init=function(media,player){this.media=media;this.player=player;this.media.removeAttribute('controls');this.media.onloadedmetadata=function(){apijs.dialog.actionResizeMedia();apijs.dialog.player.onTimeupdateSeeking();apijs.dialog.player.onProgress();}.bind(this);this.media.ontimeupdate=apijs.dialog.player.onTimeupdateSeeking.bind(this);this.media.onseeking=apijs.dialog.player.onTimeupdateSeeking.bind(this);this.media.onprogress=apijs.dialog.player.onProgress.bind(this);this.media.onplay=apijs.dialog.player.onPlayPause.bind(this);this.media.onpause=apijs.dialog.player.onPlayPause.bind(this);this.media.onended=apijs.dialog.player.onEnded.bind(this);this.media.onvolumechange=apijs.dialog.player.onVolumeChange.bind(this);this.media.addEventListener('error',apijs.dialog.player.onError.bind(this),true);};this.onTimeupdateSeeking=function(){var hours,mins,secs,time,currentTime,duration;time=currentTime=this.media.currentTime;hours=Math.floor(time/3600);mins=Math.floor((time%3600)/60);secs=Math.floor(time%60);if(secs<10)
secs='0'+secs;if(mins<10)
mins='0'+mins;hours=(hours>0)?hours+':':'';this.player.querySelector('span.time').innerHTML=hours+mins+':'+secs;if((this.media.duration!==Infinity)&&!isNaN(this.media.duration)){time=duration=this.media.duration;hours=Math.floor(time/3600);mins=Math.floor((time%3600)/60);secs=Math.floor(time%60);if(secs<10)
secs='0'+secs;if(mins<10)
mins='0'+mins;hours=(hours>0)?hours+':':'';}
this.player.querySelector('span.time').innerHTML+=' / '+hours+mins+':'+secs;if(this.media.duration!==Infinity)
this.player.querySelector('svg.bar rect').style.width=(currentTime/duration*100)+'%';};this.onProgress=function(){var i,elem,left,width;if((this.media.buffered.length>0)&&(this.media.duration>0)&&(this.media.duration!==Infinity)){elem=this.player.querySelector('svg.bar');i=this.player.querySelectorAll('svg.bar rect.buffer').length;while(i-->0)
elem.removeChild(elem.lastChild);i=this.media.buffered.length;while(i-->0){left=(this.media.buffered.start(i)/this.media.duration)*100;width=((this.media.buffered.end(i)-this.media.buffered.start(i))/this.media.duration)*100;if(width>=100){left=0;width=100;this.media.removeAttribute('onprogress');}
elem=document.createElement('rect');elem.setAttribute('class','buffer');elem.setAttribute('style','left:'+left+'%; width:'+width+'%;');this.player.querySelector('svg.bar').appendChild(elem);}}};this.onPlayPause=function(){var elem=this.player.querySelector('span.play');elem.innerHTML=(this.media.paused)?'▶':'▮▮';elem=this.player.querySelector('span.run');if(!elem.hasAttribute('style'))
elem.setAttribute('style','display:none;');};this.onEnded=function(){this.player.querySelector('span.run').removeAttribute('style');this.player.querySelector('span.run').innerHTML='⟲';this.player.querySelector('span.play').innerHTML='⟲';};this.onError=function(){if(this.media.networkState===3){var elem=this.media.querySelector('source'),src=elem.getAttribute('src');this.player.setAttribute('class','player error');this.player.querySelector('span.run').innerHTML=apijs.i18n.translate('videoError',src,src.substr(src.lastIndexOf('/')+1),src.substr(src.lastIndexOf('/')+1)).replace(/\[/g,'<').replace(/\]/g,'>');if(elem.hasAttribute('type'))
this.player.querySelector('span.run a').setAttribute('type',elem.getAttribute('type'));}};this.actionVolumeVideo=this.onVolumeChange=function(ev){var value,left=0,media=apijs.dialog.media,elem=apijs.dialog.tBox.querySelector('svg.vol');if(media.networkState!==3){if((typeof ev==='object')&&!isNaN(ev.clientX)){value=elem.offsetWidth;do{left+=elem.offsetLeft;}
while((elem=elem.offsetParent)!==null);value=(1*(ev.clientX-left)*100/value)/100;value=(value<=0.1)?0:((value>0.92)?1:value);media.volume=value;if(media.muted)
media.muted=false;}
apijs.dialog.tBox.querySelector('svg.vol rect').style.width=(media.muted)?0:(media.volume*100)+'%';}};this.actionPositionVideo=function(ev){var value,left=0,media=apijs.dialog.media,elem=apijs.dialog.tBox.querySelector('svg.bar');if(media.networkState!==3){if((typeof ev==='object')&&(media.duration!==Infinity)){value=elem.offsetWidth;do{left+=elem.offsetLeft;}
while((elem=elem.offsetParent)!==null);value=(media.duration*(ev.clientX-left)*100/value)/100;value=(value<=1)?0:value;media.currentTime=value;}}};};
apijs.core.dialog=function(){this.styles=null;this.media=null;this.player=null;this.paused=true;this.scrollTime=0;this.timer=null;this.callback=null;this.args=null;this.frag=null;this.a=null;this.b=null;this.c=null;this.d=null;this.e=null;this.tDialog=null;this.tBox=null;this.tTitle=null;this.dialogInformation=function(title,text,icon){if((typeof title==='string')&&(typeof text==='string')){this.initDialog('information',icon);this.htmlParent();this.htmlContent(title,text);this.htmlButtonOk();this.showDialog();this.tBox.querySelector('button.confirm').focus();}
else{apijs.error('TheDialog.dialogInformation',{'(string) *title':title,'(string) *text':text,'(string) icon':icon});}};this.dialogConfirmation=function(title,text,callback,args,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof callback==='function')){this.initDialog('confirmation',icon);this.htmlParent();this.htmlContent(title,text);this.htmlButtonConfirm('button');this.callback=callback;this.args=args;this.showDialog();this.tBox.querySelector('button.confirm').focus();}
else{if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))
callback=callback.name;apijs.error('TheDialog.dialogConfirmation',{'(string) *title':title,'(string) *text':text,'(function) *callback':callback,'(mixed) args':args,'(string) icon':icon});}};this.dialogFormOptions=function(title,text,action,callback,args,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof action==='string')&&(typeof callback==='function')){this.initDialog('options',icon);this.htmlParent(action);this.htmlContent(title,text);this.htmlButtonConfirm('submit');this.callback=callback;this.args=args;this.showDialog();window.setTimeout(function(){apijs.dialog.tBox.querySelector('input:not([readonly]),textarea:not([readonly]),select:not([disabled])').focus();},12);}
else{if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))
callback=callback.name;apijs.error('TheDialog.dialogFormOptions',{'(string) *title':title,'(string) *text':text,'(string) *action':action,'(function) *callback':callback,'(mixed) args':args,'(string) icon':icon});}};this.dialogFormUpload=function(title,text,action,inputname,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof action==='string')&&(typeof inputname==='string')){this.initDialog('upload',icon);this.htmlParent(action);this.htmlContent(title,text);this.htmlFormUpload(inputname);this.htmlButtonConfirm('submit');this.showDialog();window.setTimeout(function(){apijs.dialog.tBox.querySelector('.browse').focus();},12);}
else{apijs.error('TheDialog.dialogFormUpload',{'(string) *title':title,'(string) *text':text,'(string) *action':action,'(string) *inputname':inputname,'(string) icon':icon});}};this.dialogProgress=function(title,text,icon){if((typeof title==='string')&&(typeof text==='string')){this.initDialog('progress',icon);this.htmlParent();this.htmlContent(title,text);this.htmlProgressBar();this.showDialog();}
else{apijs.error('TheDialog.dialogProgress',{'(string) *title':title,'(string) *text':text,'(string) icon':icon});}};this.dialogWaiting=function(title,text,time,icon){if((typeof title==='string')&&(typeof text==='string')){this.initDialog('waiting',icon);this.htmlParent();this.htmlContent(title,text);this.showDialog();if((typeof time==='number')&&(time>5))
this.timer=window.setTimeout(apijs.dialog.htmlLinkReload,time*1000);}
else{apijs.error('TheDialog.dialogWaiting',{'(string) *title':title,'(string) *text':text,'(number) time':time,'(string) icon':icon});}};this.dialogPhoto=function(url,name,date,legend,slideshow){if((typeof url==='string')&&(typeof name==='string')&&(typeof date==='string')&&(typeof legend==='string')){if(typeof slideshow==='string'){this.initDialog('photo','notransition slideshow');this.htmlParent(slideshow);}
else{this.initDialog('photo','notransition');this.htmlParent();}
this.htmlMedia(url,name,date,legend);this.htmlHelp((typeof slideshow==='string'),false);this.htmlButtonClose();this.htmlButtonNavigation();this.showDialog();this.media=new Image();this.media.src=this.a=url;this.media.onload=function(width,height){width=this.media.width;height=this.media.height;this.media=document.getElementById('apijsMedia');if(this.media){this.media.width=width;this.media.height=height;this.media.setAttribute('class','img default');this.media.setAttribute('style','background-image:url("'+this.a+'");');this.actionResizeMedia();}}.bind(this);this.media.onerror=function(){this.media=document.getElementById('apijsMedia');if(this.media){this.media.setAttribute('class','img error');this.media.firstChild.appendChild(apijs.i18n.nodeTranslate('imageError404'));}}.bind(this);}
else{apijs.error('TheDialog.dialogPhoto',{'(string) *url':url,'(string) *name':name,'(string) *date':date,'(string) *legend':legend});}};this.dialogVideo=function(url,name,date,legend,slideshow){if((typeof url==='string')&&(typeof name==='string')&&(typeof legend==='string')&&(typeof legend==='string')){if(typeof slideshow==='string'){this.initDialog('video','notransition slideshow');this.htmlParent(slideshow);}
else{this.initDialog('video','notransition');this.htmlParent();}
this.htmlMedia(url,name,date,legend);this.htmlHelp((typeof slideshow==='string'),true);this.htmlButtonClose();this.htmlButtonNavigation();this.htmlPlayer();this.showDialog();if(apijs.config.dialog.player){this.player=new apijs.core.player();this.player.init(this.media,this.a);}}
else{apijs.error('TheDialog.dialogVideo',{'(string) *url':url,'(string) *name':name,'(string) *date':date,'(string) *legend':legend});}};this.actionClose=function(ev){if(new RegExp('#('+apijs.config.slideshow.ids+'(?:-|\\.)[0-9]+(?:-|\\.)[0-9]+)').test(location.href)){if(apijs.config.slideshow.anchor&&(typeof history.pushState==='function'))
history.pushState({},'',location.href.slice(0,location.href.indexOf('#')));}
if(typeof ev==='object'){if((ev.target.getAttribute('id')==='apijsDialog')&&!apijs.dialog.styles.has('photo','video','waiting','progress','lock'))
apijs.dialog.deleteDialog(true);}
else{if(document.getElementById('apijsDialog'))
this.deleteDialog((typeof ev!=='boolean')?true:ev);}};this.actionKey=function(ev){var styles=apijs.dialog.styles,media=apijs.dialog.media;if(!isNaN(ev))
ev={keyCode:ev,ctrlKey:false,altKey:false,preventDefault:function(){}};if(styles.has('waiting','progress','lock')){if((ev.ctrlKey&&[81,87,82,115,116].has(ev.keyCode))||(ev.altKey&&ev.keyCode===115)||[27,116].has(ev.keyCode))
ev.preventDefault();}
else if(styles.has('photo','video')&&(ev.keyCode===122)){ev.preventDefault();apijs.dialog.actionFullscreen();}
else if(styles.has('slideshow')){if(ev.keyCode===27){ev.preventDefault();apijs.dialog.actionClose();}
else if(ev.keyCode===35){ev.preventDefault();apijs.slideshow.actionLast();}
else if(ev.keyCode===36){ev.preventDefault();apijs.slideshow.actionFirst();}
else if(ev.keyCode===37){ev.preventDefault();apijs.slideshow.actionPrev();}
else if(ev.keyCode===39){ev.preventDefault();apijs.slideshow.actionNext();}}
else if(ev.keyCode===27){ev.preventDefault();apijs.dialog.actionClose();}
if(styles.has('video')){if((ev.keyCode===32)||(ev.keyCode===80)){ev.preventDefault();if(media.networkState!==3){if(media.ended||media.paused)
media.play();else
media.pause();}}
else if((ev.keyCode===38)||(ev.keyCode===33)){ev.preventDefault();if((media.networkState!==3)&&(media.duration!==Infinity)){if(media.currentTime<(media.duration-10))
media.currentTime+=10;}}
else if((ev.keyCode===40)||(ev.keyCode===34)){ev.preventDefault();if((media.networkState!==3)&&(media.duration!==Infinity)){if(media.currentTime>10)
media.currentTime-=10;else
media.currentTime=0;}}
else if(ev.keyCode===107){ev.preventDefault();if(media.networkState!==3){if(media.muted)
media.muted=false;if(media.volume<0.8)
media.volume+=0.2;else
media.volume=1;}}
else if(ev.keyCode===109){ev.preventDefault();if(media.networkState!==3){if(media.muted)
media.muted=false;if(media.volume>0.21)
media.volume-=0.2;else
media.volume=0;}}
else if(ev.keyCode===77){ev.preventDefault();if(media.networkState!==3)
media.muted=!media.muted;}}
if([32,33,34,35,36,38,40].has(ev.keyCode)){if(!['INPUT','TEXTAREA','SELECT'].has(ev.target.nodeName))
apijs.dialog.actionScrollBrowser(ev);}};this.actionCloseBrowser=function(ev){if(apijs.dialog.styles.has('waiting','progress','lock')){ev.preventDefault();ev.stopPropagation();return apijs.i18n.translate('userLeavePage')+'\n'+apijs.i18n.translate('warningLostChange');}};this.actionScrollBrowser=function(ev){if(apijs.dialog.styles.has('slideshow')&&['DOMMouseScroll','mousewheel'].has(ev.type)){var time=new Date().getTime()/1000;if((apijs.dialog.scrollTime<1)||(time>apijs.dialog.scrollTime+2)){apijs.dialog.scrollTime=time;if((ev.detail>0)||(ev.wheelDelta<0))
apijs.slideshow.actionNext();else
apijs.slideshow.actionPrev();}}
ev.preventDefault();ev.stopPropagation();};this.actionConfirm=function(){if(this.styles.has('options','confirmation')){if(this.styles.has('options')){if(this.callback(false,this.args)!==true)
return false;}
this.styles.add('lock');this.tBox.querySelector('div.control').style.visibility='hidden';this.tBox.querySelector('div.bbcode').style.visibility='hidden';this.a=document.createElement('p');this.a.setAttribute('class','saving');this.a.appendChild(apijs.i18n.nodeTranslate('operationInProgress'));this.tBox.appendChild(this.a);this.timer=window.setTimeout(apijs.dialog.htmlLinkReload,7000);window.setTimeout(function(){if((this.tBox)&&(this.tBox.nodeName==='FORM'))
this.callback(this.tBox.getAttribute('action'),this.args);else if(this.tBox)
this.callback(this.args);}.bind(this),1000);}
else if(this.styles.has('upload')){apijs.upload.actionConfirm(this.tBox.getAttribute('action'));}
return false;};this.actionResizeMedia=function(){var that=apijs.dialog,media=that.media,bis=false,width=0,height=0,top=0;if(media.nodeName==='DIV'){if((media.width>media.offsetWidth)||(media.height>media.offsetHeight))
bis=true;media.setAttribute('class',media.getAttribute('class').replace((bis)?'default':'bis',(bis)?'bis':'default'));}
else if(media.nodeName==='VIDEO'){if((media.videoWidth>0)&&(media.videoHeight>0)&&(media.duration>0)){if((media.videoWidth/media.videoHeight)<=(media.offsetWidth/media.offsetHeight)){width=media.videoWidth/(media.videoHeight/media.offsetHeight);height=media.offsetHeight;}
else{width=media.offsetWidth;height=media.videoHeight/(media.videoWidth/media.offsetWidth);top=(media.offsetHeight-height)/2;}}
else{width=media.offsetHeight*0.9*1.33333;height=media.offsetHeight*0.9;top=(media.offsetHeight-media.offsetHeight*0.9)/2;}
that.tBox.querySelector('div.player').setAttribute('style','width:'+parseInt(width,10)+'px;');that.tBox.querySelector('div.player div').setAttribute('style','margin-top:'+parseInt(top,10)+'px; height:'+parseInt(height,10)+'px; line-height:'+parseInt(height,10)+'px;');}};this.actionHidden=function(){var media=apijs.dialog.media;if(!document.hidden&&!document.mozHidden&&!document.msHidden&&!document.webkitHidden){if(!apijs.dialog.paused)
media.play();}
else{apijs.dialog.paused=media.paused;media.pause();}};this.actionFullscreen=function(){var elem=apijs.dialog.tDialog;if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement){if(elem.requestFullscreen)
elem.requestFullscreen();else if(elem.mozRequestFullScreen)
elem.mozRequestFullScreen();else if(elem.webkitRequestFullscreen)
elem.webkitRequestFullscreen();}
else{if(document.cancelFullScreen)
document.cancelFullScreen();else if(document.mozCancelFullScreen)
document.mozCancelFullScreen();else if(document.webkitCancelFullScreen)
document.webkitCancelFullScreen();}};this.initDialog=function(type,icon){if(this.styles!==null)
this.deleteDialog(false);this.styles=new apijs.core.styles();this.styles.init(type,icon);this.frag=document.createDocumentFragment();document.addEventListener('keydown',apijs.dialog.actionKey,false);window.addEventListener('beforeunload',apijs.dialog.actionCloseBrowser,false);window.addEventListener('DOMMouseScroll',apijs.dialog.actionScrollBrowser,false);window.addEventListener('mousewheel',apijs.dialog.actionScrollBrowser,false);window.addEventListener('touchmove',apijs.dialog.actionScrollBrowser,false);if(apijs.config.dialog.restrictNavigation){var elem,elems=document.querySelectorAll('a,area,button,input,object,select,textarea,iframe');for(elem=0;elem<elems.length;elem++){if(typeof elems[elem]==='object')
elems[elem].setAttribute('tabindex','-1');}}};this.showDialog=function(){if(document.getElementById('apijsDialog')&&(document.getElementById('apijsDialog').getAttribute('class')==='end'))
document.body.removeChild(document.getElementById('apijsDialog'));if(document.getElementById('apijsDialog')||this.styles.has('notransition')){this.tDialog.setAttribute('class',this.tDialog.getAttribute('class').replace('start','ready'));this.tBox.setAttribute('class',this.tBox.getAttribute('class').replace('start','ready'));if(document.getElementById('apijsDialog')){document.getElementById('apijsDialog').appendChild(this.tBox);this.tDialog=document.getElementById('apijsDialog');}
else{document.body.appendChild(this.frag);}}
else{document.body.appendChild(this.frag);window.setTimeout(function(){this.tDialog.setAttribute('class',this.tDialog.getAttribute('class').replace('start','ready'));this.tBox.setAttribute('class',this.tBox.getAttribute('class').replace('start','ready'));}.bind(this),12);}
if(apijs.config.dialog.closeOnClick&&!this.styles.has('waiting','progress','lock'))
document.addEventListener('click',apijs.dialog.actionClose,false);if(this.styles.has('photo','video'))
window.addEventListener('resize',apijs.dialog.actionResizeMedia,false);if(this.styles.has('video')){if(typeof document.hidden==='boolean')
document.addEventListener('visibilitychange',apijs.dialog.actionHidden,false);else if(typeof document.mozHidden==='boolean')
document.addEventListener('mozvisibilitychange',apijs.dialog.actionHidden,false);else if(typeof document.msHidden==='boolean')
document.addEventListener('msvisibilitychange',apijs.dialog.actionHidden,false);else if(typeof document.webkitHidden==='boolean')
document.addEventListener('webkitvisibilitychange',apijs.dialog.actionHidden,false);}};this.deleteDialog=function(all){if(this.timer)
clearTimeout(this.timer);document.removeEventListener('keydown',apijs.dialog.actionKey,false);window.removeEventListener('beforeunload',apijs.dialog.actionCloseBrowser,false);window.removeEventListener('DOMMouseScroll',apijs.dialog.actionScrollBrowser,false);window.removeEventListener('mousewheel',apijs.dialog.actionScrollBrowser,false);window.removeEventListener('touchmove',apijs.dialog.actionScrollBrowser,false);if(apijs.config.dialog.restrictNavigation){var elem,elems=document.querySelectorAll('a,area,button,input,object,select,textarea,iframe');for(elem=0;elem<elems.length;elem++){if(typeof elems[elem]==='object')
elems[elem].removeAttribute('tabindex');}}
if(apijs.config.dialog.closeOnClick)
document.removeEventListener('click',apijs.dialog.actionClose,false);if(this.styles.has('photo','video'))
window.removeEventListener('resize',apijs.dialog.actionResizeMedia,false);if(this.styles.has('video')){if(typeof this.media.pause==='function'){this.media.onpause=null;this.media.pause();if(navigator.userAgent.indexOf('WebKit/')>0)
this.media.setAttribute('src','');}
if(typeof document.hidden==='boolean')
document.removeEventListener('visibilitychange',apijs.dialog.actionHidden,false);else if(typeof document.mozHidden==='boolean')
document.removeEventListener('mozvisibilitychange',apijs.dialog.actionHidden,false);else if(typeof document.msHidden==='boolean')
document.removeEventListener('msvisibilitychange',apijs.dialog.actionHidden,false);else if(typeof document.webkitHidden==='boolean')
document.removeEventListener('webkitvisibilitychange',apijs.dialog.actionHidden,false);}
this.tDialog=document.getElementById('apijsDialog');this.tBox=document.getElementById('apijsBox');if(all){var styles=window.getComputedStyle(this.tBox,null),event=(typeof this.tBox.style.webkitTransition==='string')?'webkitTransitionEnd':'transitionend';if(!this.styles.has('notransition')&&(styles.transitionDuration!=='0s')&&(typeof styles.transitionDuration==='string')){this.tDialog.setAttribute('class',this.tDialog.getAttribute('class').replace('ready','end'));this.tBox.setAttribute('class',this.tBox.getAttribute('class').replace('ready','end'));this.tDialog.addEventListener(event,function(){if(document.getElementById('apijsDialog'))
document.body.removeChild(document.getElementById('apijsDialog'));},false);}
else{document.body.removeChild(document.getElementById('apijsDialog'));}}
else if(this.tBox){this.tBox.parentNode.removeChild(this.tBox);}
this.styles=null;this.media=null;this.player=null;this.paused=true;if(all){this.scrollTime=0;this.callback=null;this.args=null;}
this.frag=null;this.a=null;this.b=null;this.c=null;this.d=null;this.e=null;this.tDialog=null;this.tBox=null;this.tTitle=null;};this.htmlParent=function(data){this.tDialog=document.createElement('div');this.tDialog.setAttribute('class',(this.styles.has('slideshow'))?'start '+data:'start');this.tDialog.setAttribute('id','apijsDialog');if(!this.styles.has('options','upload')){this.tBox=document.createElement('div');}
else{this.tBox=document.createElement('form');this.tBox.setAttribute('action',data);this.tBox.setAttribute('method','post');this.tBox.setAttribute('enctype','multipart/form-data');this.tBox.setAttribute('onsubmit','return apijs.dialog.actionConfirm();');}
this.tBox.setAttribute('class','start '+this.styles.toString());this.tBox.setAttribute('id','apijsBox');this.tDialog.appendChild(this.tBox);this.frag.appendChild(this.tDialog);};this.htmlContent=function(title,data){if(title.length>0){this.tTitle=document.createElement('h1');this.tTitle.appendChild(document.createTextNode(title));this.tBox.appendChild(this.tTitle);}
this.a=document.createElement('div');this.a.setAttribute('class','bbcode');if(data[0]!=='[')
data='[p]'+data+'[/p]';if(apijs.config.dialog.emotes){data=data.replace(/ (\(L\))/g,'`$1`00¤').replace(/ (\(u\))/ig,'`$1`01¤').replace(/ (\(y\))/ig,'`$1`02¤').replace(/ (\(n\))/ig,'`$1`03¤').replace(/ (:D)/ig,'`$1`04¤').replace(/ (:\))/g,'`$1`05¤').replace(/ (:p)/ig,'`$1`06¤').replace(/ (:\()/g,'`$1`07¤').replace(/ (;\))/g,'`$1`08¤').replace(/ (:lol)/ig,'`$1`09¤').replace(/ (8\))/g,'`$1`0a¤').replace(/ (:@)/g,'`$1`0b¤').replace(/ (\(6\))/g,'`$1`0c¤').replace(/ (:o)/ig,'`$1`0d¤').replace(/ (\(\!\))/g,'`$1`0e¤').replace(/ (\(\?\))/g,'`$1`0f¤').replace(/ (:s)/ig,'`$1`10¤').replace(/ (:\|)/g,'`$1`11¤').replace(/ (:\/)/g,'`$1`12¤').replace(/ (\(i\))/ig,'`$1`13¤').replace(/`(.{2,4})`([0-9a-f]{2})¤/g,' [span title="$1" class="ico"]&#xe6$2;[/span]');}
this.a.innerHTML=data.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\[/g,'<').replace(/\]/g,'>');var link,links=this.a.querySelectorAll('a.popup');for(link=0;link<links.length;link++)
links[link].addEventListener('click',apijs.openTab,false);this.tBox.appendChild(this.a);};this.htmlButtonOk=function(){this.a=document.createElement('div');this.a.setAttribute('class','control');this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('onclick','apijs.dialog.actionClose();');this.b.setAttribute('class','confirm');this.b.appendChild(apijs.i18n.nodeTranslate('buttonOk'));this.a.appendChild(this.b);this.tBox.appendChild(this.a);};this.htmlButtonConfirm=function(type){this.a=document.createElement('div');this.a.setAttribute('class','control');this.b=document.createElement('button');this.b.setAttribute('type',type);this.b.setAttribute('class','confirm');if(type!=='submit')
this.b.setAttribute('onclick','apijs.dialog.actionConfirm();');this.b.appendChild(apijs.i18n.nodeTranslate('buttonConfirm'));this.a.appendChild(this.b);this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('class','cancel');this.b.setAttribute('onclick','apijs.dialog.actionClose();');this.b.appendChild(apijs.i18n.nodeTranslate('buttonCancel'));this.a.appendChild(this.b);this.tBox.appendChild(this.a);};this.htmlButtonNavigation=function(){var txt=((apijs.config.dialog.imagePrev===null)||(apijs.config.dialog.imageNext===null));this.a=document.createElement('div');this.a.setAttribute('class',(txt)?'navigation txt':'navigation img');this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('disabled','disabled');this.b.setAttribute('onclick','apijs.slideshow.actionPrev();');this.b.setAttribute('class','prev');this.b.setAttribute('id','apijsPrev');if(txt){this.c=document.createElement('span');this.c.appendChild(apijs.i18n.nodeTranslate('buttonPrev'));}
else{this.c=document.createElement('img');this.c.setAttribute('src',apijs.config.dialog.imagePrev.src);this.c.setAttribute('width',apijs.config.dialog.imagePrev.width);this.c.setAttribute('height',apijs.config.dialog.imagePrev.height);this.c.setAttribute('alt',apijs.i18n.translate('buttonPrev'));}
this.b.appendChild(this.c);this.a.appendChild(this.b);this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('disabled','disabled');this.b.setAttribute('onclick','apijs.slideshow.actionNext();');this.b.setAttribute('class','next');this.b.setAttribute('id','apijsNext');if(txt){this.c=document.createElement('span');this.c.appendChild(apijs.i18n.nodeTranslate('buttonNext'));}
else{this.c=document.createElement('img');this.c.setAttribute('src',apijs.config.dialog.imageNext.src);this.c.setAttribute('width',apijs.config.dialog.imageNext.width);this.c.setAttribute('height',apijs.config.dialog.imageNext.height);this.c.setAttribute('alt',apijs.i18n.translate('buttonNext'));}
this.b.appendChild(this.c);this.a.appendChild(this.b);this.tBox.appendChild(this.a);};this.htmlButtonClose=function(){var txt=(apijs.config.dialog.imageClose===null);this.a=document.createElement('div');this.a.setAttribute('class',(txt)?'close txt':'close img');this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('onclick','apijs.dialog.actionClose();');this.b.setAttribute('class','close');if(txt){this.b.appendChild(apijs.i18n.nodeTranslate('buttonClose'));}
else{this.c=document.createElement('img');this.c.setAttribute('src',apijs.config.dialog.imageClose.src);this.c.setAttribute('width',apijs.config.dialog.imageClose.width);this.c.setAttribute('height',apijs.config.dialog.imageClose.height);this.c.setAttribute('alt',apijs.i18n.translate('buttonClose'));this.b.appendChild(this.c);}
this.a.appendChild(this.b);this.tBox.appendChild(this.a);};this.htmlLinkReload=function(){var that=apijs.dialog;that.a=document.createElement('p');that.a.setAttribute('class','reload');that.a.appendChild(apijs.i18n.nodeTranslate('operationTooLong'));that.b=document.createElement('a');that.b.setAttribute('href','javascript:location.reload();');that.b.appendChild(apijs.i18n.nodeTranslate('reloadLink'));that.a.appendChild(that.b);that.a.appendChild(document.createTextNode('.'));that.b=document.createElement('br');that.a.appendChild(that.b);that.a.appendChild(apijs.i18n.nodeTranslate('warningLostChange'));that.tBox.appendChild(that.a);};this.htmlFormUpload=function(inputname){this.a=document.createElement('div');this.a.setAttribute('class','control upload');if(typeof apijs.config.upload.tokenValue==='string'){this.b=document.createElement('input');this.b.setAttribute('type','hidden');this.b.setAttribute('name',apijs.config.upload.tokenName);this.b.setAttribute('value',apijs.config.upload.tokenValue);this.a.appendChild(this.b);}
this.b=document.createElement('input');this.b.setAttribute('type','file');this.b.setAttribute('name',inputname);this.b.setAttribute('id','apijsFile');this.b.setAttribute('onchange',"apijs.dialog.tBox.querySelector('button.confirm').focus(); apijs.dialog.tBox.querySelector('span').innerHTML = (this.files) ? this.files[0].name : this.value.slice(12);");this.a.appendChild(this.b);if(navigator.userAgent.indexOf('MSIE')>0){this.b=document.createElement('label');this.b.setAttribute('for','apijsFile');this.b.setAttribute('tabindex','1');}
else{this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('onclick',"document.getElementById('apijsFile').click();");}
this.b.setAttribute('class','browse');this.b.appendChild(apijs.i18n.nodeTranslate('buttonBrowse'));this.a.appendChild(this.b);this.b=document.createElement('span');this.b.setAttribute('class','filename');this.a.appendChild(this.b);this.b=document.createElement('div');this.b.setAttribute('class','status');this.b.appendChild(document.createTextNode(''));this.a.appendChild(this.b);this.tBox.appendChild(this.a);};this.htmlProgressBar=function(){this.a=document.createElement('svg');this.a.setAttribute('xmlns','http://www.w3.org/2000/svg');this.a.setAttribute('id','apijsProgress');this.b=document.createElement('rect');this.b.setAttribute('class','auto');this.a.appendChild(this.b);this.tBox.appendChild(this.a);};this.htmlMedia=function(url,name,date,legend){var i,fileid=url.slice(url.lastIndexOf('/')+1),arr,ext,src,mimes={ogv:'video/ogg',webm:'video/webm',mp4:'video/mp4',m4v:'video/mp4'};this.a=document.createElement('dl');this.a.setAttribute('class','media');this.b=document.createElement('dt');if(this.styles.has('photo')){this.media=document.createElement('div');this.media.setAttribute('class','img loading');this.d=document.createElement('span');this.media.appendChild(this.d);}
else{this.media=document.createElement('video');this.media.setAttribute('controls','controls');this.media.setAttribute('preload','metadata');this.media.setAttribute('onloadstart','apijs.dialog.actionResizeMedia();');arr=url.slice(url.lastIndexOf('.')+1);arr=((arr.indexOf('?')>0)&&(arr.indexOf('#')>0))?arr.slice(0,arr.indexOf('?'))+arr.slice(arr.indexOf('#')):arr;arr=((arr.indexOf('?')>0)&&(arr.indexOf('#')<0))?arr.slice(0,arr.indexOf('?')):arr;arr=arr.replace('#','.').replace(',','.').split('.');for(i=0;i<arr.length;i++){ext=arr[i];src=url.slice(0,url.lastIndexOf('.')+1)+ext;src=((url.indexOf('?')>0)&&(url.indexOf('#')>0))?src+url.slice(url.indexOf('?'),url.indexOf('#')):src;src=((url.indexOf('?')>0)&&(url.indexOf('#')<0))?src+url.slice(url.indexOf('?')):src;this.c=document.createElement('source');this.c.setAttribute('src',src);if(mimes.hasOwnProperty(ext))
this.c.setAttribute('type',mimes[ext]);this.media.appendChild(this.c);}}
this.media.setAttribute('id','apijsMedia');this.b.appendChild(this.media);this.a.appendChild(this.b);this.b=document.createElement('dd');if((name!=='false')||(date!=='false')){this.c=document.createElement('span');if((name!=='false')&&(name!=='auto')&&(date!=='false'))
this.c.appendChild(document.createTextNode(name+' ('+date+')'));else if((name!=='false')&&(name!=='auto'))
this.c.appendChild(document.createTextNode(name));else if((name==='auto')&&(date!=='false'))
this.c.appendChild(document.createTextNode(fileid+' ('+date+')'));else if(name==='auto')
this.c.appendChild(document.createTextNode(fileid));else if(date!=='false')
this.c.appendChild(document.createTextNode('('+date+')'));this.b.appendChild(this.c);}
this.b.appendChild(document.createTextNode(' '+legend+' '));this.a.appendChild(this.b);this.tBox.appendChild(this.a);};this.htmlPlayer=function(){this.a=document.createElement('div');this.a.setAttribute('class','player');this.b=document.createElement('div');this.b.setAttribute('onclick','apijs.dialog.actionKey(80);');this.c=document.createElement('span');this.c.setAttribute('class','run');this.c.appendChild(document.createTextNode('▶'));this.b.appendChild(this.c);this.a.appendChild(this.b);this.b=document.createElement('div');this.c=document.createElement('span');this.c.setAttribute('class','play');this.c.setAttribute('onclick','apijs.dialog.actionKey(80);');this.c.appendChild(document.createTextNode('▶'));this.b.appendChild(this.c);this.c=document.createElement('span');this.c.setAttribute('class','bar');this.d=document.createElement('svg');this.d.setAttribute('xmlns','http://www.w3.org/2000/svg');this.d.setAttribute('class','bar');this.d.setAttribute('onclick','apijs.dialog.player.actionPositionVideo(event);');this.e=document.createElement('rect');this.d.appendChild(this.e);this.c.appendChild(this.d);this.b.appendChild(this.c);this.c=document.createElement('span');this.c.setAttribute('class','time');this.c.appendChild(document.createTextNode('00:00 / 00:00'));this.b.appendChild(this.c);this.c=document.createElement('span');this.c.setAttribute('class','vol');this.d=document.createElement('svg');this.d.setAttribute('xmlns','http://www.w3.org/2000/svg');this.d.setAttribute('class','vol');this.d.setAttribute('onclick','apijs.dialog.player.actionVolumeVideo(event);');this.e=document.createElement('rect');this.d.appendChild(this.e);this.c.appendChild(this.d);this.b.appendChild(this.c);this.c=document.createElement('span');this.c.setAttribute('class','full');this.c.setAttribute('title',apijs.i18n.translate('ctrlDialogFullscreen'));this.c.setAttribute('onclick','apijs.dialog.actionKey(122);');this.c.appendChild(document.createTextNode('+'));this.b.appendChild(this.c);this.a.appendChild(this.b);this.media.parentNode.appendChild(this.a);};this.htmlHelp=function(slideshow,video){var i,j,tmp,total,data=[];if(slideshow){data.push(['start;↖','ctrlKeyEnd','ctrlSlideshowFirstLast']);data.push(['left;←','right;→','ctrlSlideshowNextPrev']);}
if(video){data.push(['bot;↓','top;↑','ctrlVideoTime']);data.push(['less;-','more;+','ctrlVideoSound']);data.push(['m','ctrlVideoMute']);data.push(['p','ctrlVideoPause']);}
data.push(['ctrlKeyEsc','ctrlDialogQuit']);this.a=document.createElement('div');this.a.setAttribute('class','kbd');this.b=document.createElement('ul');for(i=0;i<data.length;i++){total=data[i].length-1;this.c=document.createElement('li');for(j=0;j<total;j++){this.d=document.createElement('kbd');if(data[i][j].indexOf(';')>0){tmp=data[i][j].split(';');this.d.setAttribute('class',tmp[0]);this.d.setAttribute('title',tmp[1]);}
else{this.d.appendChild(apijs.i18n.nodeTranslate(data[i][j]));}
this.c.appendChild(this.d);}
this.c.appendChild(apijs.i18n.nodeTranslate(data[i][total]));this.b.appendChild(this.c);}
this.a.appendChild(this.b);this.tBox.appendChild(this.a);};};apijs.core.styles=function(){this.data=[];this.init=function(type,icon){this.data.push(type);if(typeof icon==='string')
this.data=this.data.concat(icon.split(' '));};this.add=function(value){if(!this.data.hasOwnProperty(value))
this.data.push(value);return this.data;};this.toggle=function(search,replace){if(this.has(search))
this.remove(search);if(!this.has(replace))
this.add(replace);};this.has=function(){return this.data.has(Array.prototype.slice.call(arguments,0));};this.remove=function(){var arg,args=Array.prototype.slice.call(arguments,0);for(arg in args)if(args.hasOwnProperty(arg))
this.data.splice(this.data.indexOf(args[arg]),1);return this.data;};this.toString=function(){return this.data.join(' ');};};
apijs.core.slideshow=function(){this.started=0;this.current=null;this.init=function(){var i,j,id,ids=apijs.config.slideshow.ids,hoverload=false;for(i=0;document.getElementById(ids+'.'+i)!==null;i++){hoverload=(document.getElementById(ids+'.'+i).getAttribute('class').indexOf('hoverload')>-1);for(j=0;document.getElementById(ids+'.'+i+'.'+j)!==null;j++){document.getElementById(ids+'.'+i+'.'+j).addEventListener('click',apijs.slideshow.showMedia.bind(this),false);if(hoverload)
document.getElementById(ids+'.'+i+'.'+j).addEventListener('mouseover',apijs.slideshow.showMedia.bind(this),false);}
if(document.getElementById(ids+'.'+i+'.999'))
document.getElementById(ids+'.'+i+'.999').addEventListener('click',apijs.slideshow.showMedia.bind(this),false);this.started+=1;}
if(new RegExp('#('+ids+'(?:-|\\.)[0-9]+(?:-|\\.)[0-9]+)').test(location.href)){id=RegExp.$1.replace(/-/g,'.');if(document.getElementById(id))
this.showMedia(id);}};this.showMedia=function(ev,push){var source,media={};if(typeof ev==='string'){source=document.getElementById(ev);media.id=ev;}
else{ev.preventDefault();source=(ev.target.nodeName==='A')?ev.target:ev.target.parentNode;media.id=source.getAttribute('id');if((ev.type==='mouseover')&&source.hasAttribute('class')&&(source.getAttribute('class').indexOf('current')>-1))
return;}
media.prefix=apijs.config.slideshow.ids+'.'+media.id.split('.')[1];media.number=media.numberSrc=parseInt(media.id.split('.')[2],10);media.presentation=document.getElementById(media.prefix+'.999');if(media.number!==999){var allLinks=document.getElementById(media.prefix).querySelectorAll('a[id][type]'),allConts=document.getElementById(media.prefix).querySelectorAll('dl'),i;if((media.presentation!==null)||(allLinks.length!==allConts.length)){for(i=0;i<allLinks.length;i++){if(allLinks[i].hasAttribute('class'))
allLinks[i].removeAttribute('class');}
source.setAttribute('class','current');}
else{for(i=0;i<allConts.length;i++){if(allConts[i].hasAttribute('class'))
allConts[i].removeAttribute('class');}
source.parentNode.parentNode.setAttribute('class','current');}}
if(media.presentation!==null){if(media.number===999){source=(media.presentation.hasAttribute('class'))?media.presentation.getAttribute('class'):media.prefix+'.0';source=document.getElementById(source);media.number=parseInt(source.getAttribute('id').split('.')[2],10);}
media.config=source.querySelector('input').getAttribute('value').split('|');media.mainImg=media.config.shift();if(media.numberSrc!==999){media.presentation.setAttribute('href',source.getAttribute('href'));media.presentation.querySelector('img').setAttribute('src',media.mainImg);media.presentation.querySelector('img').setAttribute('alt',source.querySelector('img').getAttribute('alt'));media.presentation.setAttribute('class',media.id);}
media.mainImg=null;}
else{media.config=source.querySelector('input').getAttribute('value').split('|');}
media.url=source.getAttribute('href');media.type=source.getAttribute('type').substr(0,5).replace('image','dialogPhoto').replace('video','dialogVideo');media.styles=document.getElementById(media.prefix).getAttribute('class').replace(/gallery|album/g,'slideshow');if((media.presentation&&(media.numberSrc===999))||!media.presentation||(typeof ev==='string'))
this.showDialog(media,push);};this.showDialog=function(media,push){apijs.dialog[media.type](media.url,media.config[0],media.config[1],media.config[2],media.styles);if((apijs.dialog.styles!==null)&&apijs.dialog.styles.has('slideshow')){this.current={number:media.number,first:null,prev:null,next:null,last:null,total:null};this.current.total=document.getElementById(media.prefix).querySelectorAll('a[id][type]').length-1;this.current.total=(media.presentation)?this.current.total-1:this.current.total;this.current.first=media.prefix+'.0';this.current.prev=(media.number>0)?media.prefix+'.'+(this.current.number-1):null;this.current.next=(media.number<this.current.total)?media.prefix+'.'+(this.current.number+1):null;this.current.last=media.prefix+'.'+this.current.total;if(this.current.prev!==null)
document.getElementById('apijsPrev').removeAttribute('disabled');if(this.current.next!==null)
document.getElementById('apijsNext').removeAttribute('disabled');if(apijs.config.slideshow.anchor&&(typeof history.pushState==='function')&&((typeof push==='boolean')?push:true)){var hash=location.href;hash=(hash.indexOf('#')>0)?hash.slice(0,hash.indexOf('#')):hash;hash+='#'+(media.prefix+'.'+((media.number!==999)?media.number:0)).replace(/\./g,'-');history.pushState({},'',hash);}}
else{this.current=null;}};this.popState=function(){if(new RegExp('#('+apijs.config.slideshow.ids+'(?:-|\\.)[0-9]+(?:-|\\.)[0-9]+)').test(location.href)){var id=RegExp.$1.replace(/-/g,'.');if(document.getElementById(id))
apijs.slideshow.showMedia(id,false);}
else if(apijs.slideshow.current!==null){apijs.dialog.actionClose(true);}};this.actionFirst=function(){if((this.current!==null)&&(this.current.number>0)&&(this.current.number<=this.current.total))
this.showMedia(this.current.first);};this.actionPrev=function(){if((this.current!==null)&&(this.current.prev!==null)&&(this.current.number>0))
this.showMedia(this.current.prev);};this.actionNext=function(){if((this.current!==null)&&(this.current.next!==null)&&(this.current.number<this.current.total))
this.showMedia(this.current.next);};this.actionLast=function(){if((this.current!==null)&&(this.current.number>=0)&&(this.current.number<this.current.total))
this.showMedia(this.current.last);};};
apijs.core.upload=function(){this.extensions=null;this.callback=null;this.args=null;this.icon=null;this.title=null;this.maxsize=0;this.startTime=0;this.lastTime=0;this.sendFile=function(title,action,inputname,maxsize,extensions,callback,args,icon){var text;if((typeof title==='string')&&(typeof action==='string')&&(typeof inputname==='string')&&(typeof maxsize==='number')&&(typeof extensions==='string')&&(typeof callback==='function')){this.extensions=extensions.split(',');this.callback=callback;this.args=args;this.icon=icon;this.title=title;this.maxsize=maxsize;maxsize=maxsize.toFixed(2).replace('.00','').replace('.',apijs.i18n.translate('uploadDecimal'));if(this.extensions[0]==='*')
text=apijs.i18n.translate('uploadAllType',maxsize);else if(this.extensions.length===1)
text=apijs.i18n.translate('uploadOneType',extensions,maxsize);else
text=apijs.i18n.translate('uploadMultiType',this.extensions.slice(0,-1).join(', '),this.extensions.slice(-1),maxsize);apijs.dialog.dialogFormUpload(title,text,action,inputname,icon);}
else{if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))
callback=callback.name;apijs.error('TheUpload.sendFile',{'(string) *title':title,'(string) *action':action,'(string) *inputname':inputname,'(number) *maxsize':maxsize,'(string) *extensions':extensions,'(function) *callback':callback,'(mixed) args':args,'(string) icon':icon,});}};this.actionConfirm=function(action){var tagInput=document.getElementById('apijsFile'),tagError=apijs.dialog.tBox.querySelector('div.status').firstChild,checks={filePresent:false,fileType:true,fileSize:false,type:'',size:this.maxsize};if((this.extensions!==null)&&(tagInput.value.length>0)){checks.filePresent=true;if(this.extensions[0]!=='*'){checks.type=tagInput.value.slice(tagInput.value.lastIndexOf('.')+1).toLowerCase();if(!this.extensions.has(checks.type))
checks.fileType=false;}
if(typeof tagInput.files==='object')
checks.size=tagInput.files[0].size;if((checks.size>0)&&(checks.size<=this.maxsize*1048576))
checks.fileSize=true;}
if(checks.filePresent&&checks.fileType&&checks.fileSize){try{if(action.indexOf('noAjax')>0){apijs.dialog.tBox.submit();window.setTimeout(apijs.upload.onStart.bind(this),12);}
else{this.startUpload(action);}}
catch(e){apijs.dialog.tBox.submit();window.setTimeout(apijs.upload.onStart.bind(this),12);console.warn(e);}}
else if(this.extensions!==null){if(checks.filePresent&&!checks.fileType){tagError.replaceData(0,tagError.nodeValue.length,apijs.i18n.translate('uploadBadType',checks.type));}
else if(checks.filePresent&&!checks.fileSize&&(checks.size>0)){checks.size=(checks.size/1048576).toFixed(2).replace('.00','').replace('.',apijs.i18n.translate('uploadDecimal'));tagError.replaceData(0,tagError.nodeValue.length,apijs.i18n.translate('uploadBadSize',checks.size));}
else if(checks.filePresent&&!checks.fileSize){tagError.replaceData(0,tagError.nodeValue.length,apijs.i18n.translate('uploadEmpty'));}
apijs.dialog.tBox.querySelector('.browse').focus();}};this.startUpload=function(action){var form=new FormData(),xhr=new XMLHttpRequest();form.append(document.getElementById('apijsFile').getAttribute('name'),document.getElementById('apijsFile').files[0]);xhr.open('POST',action+((action.indexOf('?')>0)?'&isAjax=true':'?isAjax=true'),true);if(typeof apijs.config.upload.tokenValue==='string')
xhr.setRequestHeader('X-CSRF-Token',apijs.config.upload.tokenValue);xhr.onreadystatechange=function(){if((xhr.readyState===4)&&(xhr.status===200)){var text=xhr.responseText.trim();if(apijs.config.debug)
console.warn('(onreadystatechange) upload ended with status 200: '+text);if(text.indexOf('success-')===0){apijs.upload.updateTitle();apijs.upload.callback(text.slice(8),apijs.upload.args);}
else{apijs.upload.onError('uploadError2',text);}}
else if(xhr.readyState===4){if(apijs.config.debug)
console.warn('(onreadystatechange) upload ended with status '+xhr.status+': '+xhr.responseText);apijs.upload.onError('uploadError1',xhr.status);}};xhr.upload.onloadstart=apijs.upload.onStart.bind(this);xhr.upload.onprogress=apijs.upload.onProgress.bind(this);xhr.upload.onload=apijs.upload.onProgress.bind(this);xhr.upload.onerror=apijs.upload.onError.bind(this);xhr.send(form);};this.onError=function(key,text){if(typeof key==='string')
text=((key==='uploadError2')&&(text.indexOf('[/')>0))?text:apijs.i18n.translate(key,text);else
text=apijs.i18n.translate('uploadError0');this.updateTitle();this.icon=(this.icon!==null)?'upload error '+this.icon:'upload error';apijs.dialog.dialogInformation(this.title,text,this.icon);};this.onStart=function(){this.startTime=this.lastTime=Math.round(new Date().getTime()/1000);apijs.dialog.dialogProgress(this.title,apijs.i18n.translate('uploadInProgress')+' [span] [/span]',this.icon);};this.onProgress=function(ev){var percent,key,rate,time,elapsedTime,totalTime,currentTime=Math.round(new Date().getTime()/1000),mins;if(ev.lengthComputable&&(ev.type==='progress')&&(currentTime>=(this.lastTime+2))){this.lastTime=currentTime;percent=Math.floor((ev.loaded*100)/ev.total);if((percent>0)&&(percent<100)){this.updateTitle(percent);elapsedTime=currentTime-this.startTime;totalTime=elapsedTime*100/percent+10;if(elapsedTime>=25){time=Math.round(totalTime-elapsedTime);time=Math.ceil(time/10)*10;mins=Math.ceil(time/60);rate=Math.round(ev.loaded/elapsedTime/1024);if((elapsedTime<40)||(totalTime<90)){key=14;time=null;}
else if(mins>1){key=11;time=mins;}
else if(time>50){key=12;time=1;}
else{key=13;}}
this.updateProgress(percent,key,rate,time);}}
else if(ev.type==='load'){time=Math.round(new Date().getTime()/1000)-this.startTime;mins=Math.ceil(time/60);rate=Math.round(ev.loaded/time/1024);if((rate>0)&&(rate!==Infinity)){if(mins>1){key=21;time=mins;}
else if(time>50){key=22;time=1;}
else if(time>20){key=23;}
else{key=24;time=null;}}
else{rate=null;time=null;}
this.updateTitle(100);this.updateProgress(100,key,rate,time);}};this.updateProgress=function(percent,key,rate,time){var rect=document.getElementById('apijsProgress').querySelector('rect'),text=apijs.dialog.tBox.querySelector('p span').firstChild,data;if(percent>99){rect.setAttribute('class','end');rect.style.width='';data='100%';}
else{rect.style.width=data=percent+'%';if(rect.hasAttribute('class'))
rect.removeAttribute('class');}
if((typeof key==='number')&&(typeof rate==='number')&&(typeof time==='number'))
data=apijs.i18n.translate('upload'+key,percent,rate,time);else if((typeof key==='number')&&(typeof rate==='number'))
data=apijs.i18n.translate('upload'+key,percent,rate);text.replaceData(0,text.length,data);};this.updateTitle=function(percent){if(typeof percent==='number'){document.title=(/^[0-9]{1,3}% - /.test(document.title))?percent+'% - '+document.title.slice(document.title.indexOf(' - ')+3):percent+'% - '+document.title;}
else if(/^[0-9]{1,3}% - /.test(document.title)){document.title=document.title.slice(document.title.indexOf(' - ')+3);}};};