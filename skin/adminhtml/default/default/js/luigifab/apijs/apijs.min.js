/**
 * Copyright 2008-2017 | Fabrice Creuzot (luigifab) <code~luigifab~info>
 * http://www.luigifab.info/apijs - toujours plus toujours mieux - 5.3.0
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
if(!Array.prototype.hasOwnProperty('has'))Object.defineProperty(Array.prototype,'has',{value:function(needle){var key;if(needle instanceof Array){for(key in needle)if(needle.hasOwnProperty(key))if(this.has(needle[key]))return true}else for(key in this)if(this.hasOwnProperty(key))if(this[key]===needle)return true;return false},enumerable:false});if(!Object.prototype.hasOwnProperty('invokeAll'))Object.defineProperty(Object.prototype,'invokeAll',{value:function(method){var args=Array.prototype.slice.call(arguments).slice(1),key;for(key in this)if(this.hasOwnProperty(key))if(typeof this[key]==='object')if(typeof this[key][method]==='function')this[key][method].apply(this[key],args)},enumerable:false});var apijs={core:{},version:530,config:{lang:'auto',debug:false,dialog:{closeOnClick:false,restrictNavigation:true},slideshow:{ids:'slideshow',anchor:true},upload:{tokenName:'authenticity_token',tokenValue:null}},start:function(){console.info('APIJS '+this.version.toString().replace(/([0-9]+)([0-9])([0-9])$/g,'$1.$2.$3')+' Hello! 1 MB/Mo = 1024 kB/ko');if(document.getElementById('oldBrowser'))throw new Error('APIJS canceled, #oldBrowser detected!');this.i18n=new this.core.i18n();this.dialog=new this.core.dialog();this.upload=new this.core.upload();this.slideshow=new this.core.slideshow();if(typeof setApijsRewrites==='function')setApijsRewrites();if(typeof setApijsLang==='function')setApijsLang();if(typeof setApijsConfig==='function')setApijsConfig();if(this.config.debug){console.info('APIJS available languages: '+Object.keys(this.i18n.data).join(','));console.info('APIJS setApijsLang:'+((typeof setApijsLang==='function')?'yes':'no')+' setApijsConfig:'+((typeof setApijsConfig==='function')?'yes':'no')+' setApijsRewrites:'+((typeof setApijsRewrites==='function')?'yes':'no'))};this.i18n.init();this.slideshow.init();window.addEventListener('popstate',apijs.slideshow.popState,false);window.addEventListener('hashchange',apijs.slideshow.popState,false);if(this.config.debug){console.info('APIJS language loaded: '+this.config.lang);console.info('APIJS slideshows loaded: '+this.slideshow.ready);console.info('APIJS successfully started')}},error:function(method,data){var key,text=[''];if(typeof data==='string'){text.push(data)}else for(key in data)if(data.hasOwnProperty(key))text.push(key+': '+data[key]);if(this.config.debug)this.dialog.dialogInformation('(debug) Invalid call','[pre]'+method+text.join('[br]➩ '),'debug');console.warn('APIJS '+method+text.join(', '))},log:function(txt){if(apijs.config.debug)console.log('APIJS '+txt)},html:function(s){if((s.indexOf('#')===0)||(s.indexOf(this.config.slideshow.ids)===0)){return document.getElementById(s.replace('#','apijs'))}else if(this.dialog.t1){return this.dialog.t1.querySelector(s)}else return null},openTab:function(ev){ev.preventDefault();window.open(this.href)},serialize:function(form){var nodeName,nodeType,i,j,q=[];for(i=form.elements.length-1;i>=0;i=i-1){nodeName=form.elements[i].nodeName;nodeType=form.elements[i].type;if(nodeName==='INPUT'){if(['checkbox','radio'].has(nodeType)){if(form.elements[i].checked)q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].value))}else if(['file','button','reset','submit'].has(nodeType))q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].value))}else if(nodeName==='TEXTAREA'){q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].value))}else if(nodeName==='SELECT')if(nodeType==='select-multiple'){for(j=form.elements[i].options.length-1;j>=0;j=j-1)if(form.elements[i].options[j].selected)q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].options[j].value))}else q.push(form.elements[i].getAttribute('name')+'='+encodeURIComponent(form.elements[i].value))};return q.join('&')},objectFitImages:function(){"use strict"
function t(t){for(var e,r=getComputedStyle(t).fontFamily,i={};null!==(e=c.exec(r));)i[e[1]]=e[2];return i}
function e(e,i){if(!e[n].parsingSrcset){var s=t(e);if(s["object-fit"]=s["object-fit"]||"fill",!e[n].s){if("fill"===s["object-fit"])return;if(!e[n].skipTest&&l&&!s["object-position"])return};var c=e[n].ios7src||e.currentSrc||e.src;if(i){c=i}else if(e.srcset&&!u&&window.picturefill){var o=window.picturefill._;e[n].parsingSrcset=!0,e[o.ns]&&e[o.ns].evaled||o.fillImg(e,{reselect:!0}),e[o.ns].curSrc||(e[o.ns].supported=!1,o.fillImg(e,{reselect:!0})),delete e[n].parsingSrcset,c=e[o.ns].curSrc||c};if(e[n].s){e[n].s=c,i&&(e[n].srcAttr=i)}else{e[n]={s:c,srcAttr:i||f.call(e,"src"),srcsetAttr:e.srcset},e.src=n;try{e.srcset&&(e.srcset="",Object.defineProperty(e,"srcset",{value:e[n].srcsetAttr})),r(e)}catch(t){e[n].ios7src=c}};e.style.backgroundImage='url("'+c+'")',e.style.backgroundPosition=s["object-position"]||"center",e.style.backgroundRepeat="no-repeat",/scale-down/.test(s["object-fit"])?(e[n].i||(e[n].i=new Image(),e[n].i.src=c),function t(){return e[n].i.naturalWidth?void((e[n].i.naturalWidth>e.width||e[n].i.naturalHeight>e.height?e.style.backgroundSize="contain":e.style.backgroundSize="auto")):void(setTimeout(t,100))}()):e.style.backgroundSize=s["object-fit"].replace("none","auto").replace("fill","100% 100%")}}
function r(t){var r={get:function(){return t[n].s},set:function(r){return delete t[n].i,e(t,r),r}};Object.defineProperty(t,"src",r),Object.defineProperty(t,"currentSrc",{get:r.get})}
function i(){a||(HTMLImageElement.prototype.getAttribute=function(t){return!this[n]||"src"!==t&&"srcset"!==t?f.call(this,t):this[n][t+"Attr"]},HTMLImageElement.prototype.setAttribute=function(t,e){!this[n]||"src"!==t&&"srcset"!==t?g.call(this,t,e):this["src"===t?"src":t+"Attr"]=String(e)})}
function s(t,r){var i=!A&&!t;if(r=r||{},t=t||"img",a&&!r.skipTest)return!1;"string"==typeof t?t=document.querySelectorAll("img"):"length"in t&&(t=[t]);for(var c=0;c<t.length;c++)t[c][n]=t[c][n]||r,e(t[c]);i&&(document.body.addEventListener("load",function(t){"IMG"===t.target.tagName&&s(t.target,{skipTest:r.skipTest})},!0),A=!0,t="img"),r.watchMQ&&window.addEventListener("resize",s.bind(null,t,{skipTest:r.skipTest}))};var n="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",c=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g,o=new Image(),l="object-fit"in o.style,a="object-position"in o.style,u="string"==typeof o.currentSrc,f=o.getAttribute,g=o.setAttribute,A=!1;return s.supportsObjectFit=l,s.supportsObjectPosition=a,i(),s}()};if(typeof window.addEventListener==='function')window.addEventListener('load',apijs.start.bind(apijs),false)
apijs.core.i18n=function(){"use strict";this.data={};this.data.de={buttonOk:"Ok",buttonCancel:"Abbrechen",buttonConfirm:"Bestätigen",buttonClose:"Schließen",buttonPrev:"Zurück",buttonNext:"Weiter",buttonBrowse:"Datei wählen",operationTooLong:"Diese Operation dauert zu lange? ",warningLostChange:"Achtung: Alle derzeitigen Änderungen werden nicht gespeichert!",reloadLink:"laden Sie diese Seite",operationInProgress:"Verarbeitung läuft...",uploadInProgress:"Upload Vorgang...",uploadInEnding:"Datenverarbeitung im Vorgang...",imageError:"Leider kann das Bild momentan nicht angezeigt werden. Es ist möglich, dass die Datei vorübergehend nicht verfügbar ist.",videoError:"Leider kann das Video momentan nicht wiedergegeben werden. Es ist möglich, dass die Datei vorübergehend nicht verfügbar ist oder dass Dein Browser das Video Format nicht lesen kann.[br][br]Versuche das Video [a href='§' download='']downzuloaden[/a].",ctrlSlideshowFirstLast:"anfang/ende",ctrlSlideshowNextPrev:"zurück/weiter",ctrlVideoPause:"wiedergabe/pause",ctrlVideoTime:"rückwärts/vorwärts",ctrlVideoSound:"leiser/lauter",ctrlVideoMute:"stumm",ctrlDialogFullscreen:"vollbild",ctrlDialogQuit:"beenden",ctrlKeyEnd:"Ende",ctrlKeyEsc:"Esc",uploadAllType:"Alle Dateien wurden akzeptiert.[br]Maximale Größe: § MB.",uploadOneType:"Akzeptiertes Dateiformat: §.[br]Maximale Größe: § MB.",uploadMultiType:"Akzeptiertes Dateiformate: § und §.[br]Maximale Größe: § MB.",uploadDecimal:",",upload11:"§% - § kB/s - Noch § Minuten",upload12:"§% - § kB/s - Noch § Minute",upload13:"§% - § kB/s - Noch § Sekunden",upload14:"§% - § kB/s",upload21:"§% - bis § kB/s in § Minuten",upload22:"§% - bis § kB/s in § Minute",upload23:"§% - bis § kB/s in § Sekunden",upload24:"§% - bis § kB/s",uploadBadType:"Es ist nicht möglich die Datei zu senden weil das Dateiformat nicht unterstützt wird. Aktuelles Dateiformat: §.",uploadBadSize:"Es ist nicht möglich die Datei zu senden weil die Datei zu gross ist. Aktuelle Dateigrösse: §\u00a0MB.",uploadEmpty:"Es ist nicht möglich die Datei zu senden weil die Datei keine Daten enthält.",uploadError0:"Es ist ein unerwarteter Fehler aufgetreten... Bitte versuchen Sie es noch einmal.",uploadError1:"Es ist ein Fehler beim Senden der Datei aufgetreten.[br][em]➩ Fehler §.[/em]",uploadError2:"Es ist ein Fehler bei der Verarbeitung der Datei aufgetreten.[br][em]➩ §[/em]",uploadRestart:"Wir laden Sie ein es erneut zu [a §]versuchen[/a]."};this.data.en={buttonOk:"Ok",buttonCancel:"Cancel",buttonConfirm:"Confirm",buttonClose:"Close",buttonPrev:"Previous",buttonNext:"Next",buttonBrowse:"Choose a file",operationTooLong:"This operation is too long? ",warningLostChange:"Warning: all changes in progress will be lost.",reloadLink:"Reload this page",operationInProgress:"Operation in progress...",uploadInProgress:"Upload in progress...",uploadInEnding:"Processing file in progress...",imageError:"Unfortunately, it is not possible to display this picture for now. Maybe the file is temporarily unavailable.",videoError:"Unfortunately, it is not possible to play this video for now. Maybe the file is temporarily unavailable or your browser can't read the format of the video.[br][br]Try to [a href='§' download='']download[/a] the video.",ctrlSlideshowFirstLast:"start/end",ctrlSlideshowNextPrev:"previous/next",ctrlVideoPause:"play/pause",ctrlVideoTime:"backward/forward",ctrlVideoSound:"decrease/increase the volume",ctrlVideoMute:"mute",ctrlDialogFullscreen:"full screen",ctrlDialogQuit:"quit",ctrlKeyEnd:"End",ctrlKeyEsc:"Escape",uploadAllType:"All files are accepted.[br]Maximum size: § MB.",uploadOneType:"Accepted file format: §.[br]Maximum size: § MB.",uploadMultiType:"Accepted file formats: § and §.[br]Maximum size: § MB.",uploadDecimal:".",upload11:"§% - § kB/s - § minutes left",upload12:"§% - § kB/s - § minute left",upload13:"§% - § kB/s - § seconds left",upload14:"§% - § kB/s",upload21:"§% - at § kB/s in § minutes",upload22:"§% - at § kB/s in § minute",upload23:"§% - at § kB/s in § seconds",upload24:"§% - at § kB/s",uploadBadType:"It's impossible to send the file because the proposed file format isn't allowed. Proposed file format: §.",uploadBadSize:"It's impossible to send the file because the file size is too large. Proposed file size: §\u00a0MB.",uploadEmpty:"It's impossible to send the file because the file is empty.",uploadError0:"It seems that an unlikely mistake just happened... Please try again.",uploadError1:"An error occurred while sending the file.[br][em]➩ Error §.[/em]",uploadError2:"An error occurred while processing the file.[br][em]➩ §[/em]",uploadRestart:"We invite you to [a §]try again[/a]."};this.data.es={buttonOk:"Aceptar",buttonCancel:"Cancelar",buttonConfirm:"Confirmar",buttonClose:"Cerrar",buttonPrev:"Anterior",buttonNext:"Siguiente",buttonBrowse:"Eligir un archivo",operationTooLong:"¿Esta operación toma demasiado tiempo? ",warningLostChange:"Atención: todos los cambios en curso se perderán.",reloadLink:"Recargar esta página",operationInProgress:"Operación en curso...",uploadInProgress:"Envío del archivo en progreso...",uploadInEnding:"Tratamiento del archivo en curso...",imageError:"Desgraciadamente, no se puede mostrar esta foto por el momento. Puede ser que el archivo sea temporalmente inaccesible.",videoError:"Desgraciadamente, no se puede leer éste video por el momento. Puede ser que el archivo sea temporalmente inaccesible o que su navegador no pueda leer el formato del video.[br][br]Intente [a href='§' download='']cargar[/a] la video.",ctrlSlideshowFirstLast:"inicio/fin",ctrlSlideshowNextPrev:"retroceder/avanzar",ctrlVideoPause:"reproducir/pausa",ctrlVideoTime:"atrás/adelante",ctrlVideoSound:"bajar/subir el volumen",ctrlVideoMute:"silenciar",ctrlDialogFullscreen:"pantalla completa",ctrlDialogQuit:"salir",ctrlKeyEnd:"Fin",ctrlKeyEsc:"Esc",uploadAllType:"Se aceptan todos los archivos.[br]Tamaño máximo: § MB.",uploadOneType:"Formato de archivo aceptado: §.[br]Tamaño máximo: § MB.",uploadMultiType:"Formatos de archivos aceptados: § y §.[br]Tamaño máximo: § MB.",uploadDecimal:".",upload11:"§% - § kB/s - § minutos restantes",upload12:"§% - § kB/s - § minuto restantes",upload13:"§% - § kB/s - § segundos restantes",upload14:"§% - § kB/s",upload21:"§% - a § kB/s en § minutos",upload22:"§% - a § kB/s en § minuto",upload23:"§% - a § kB/s en § segundos",upload24:"§% - a § kB/s",uploadBadType:"Es imposible enviar el archivo porque el formato del archivo propuesto no es autorizado. Formato del archivo propuesto: §.",uploadBadSize:"Es imposible enviar el archivo porque el tamaño del archivo propuesto es demasiado elevado. Tamaño del archivo propuesto: §\u00a0MB.",uploadEmpty:"Es imposible enviar el archivo porque el archivo está vacío.",uploadError0:"Parece que un error improbable acabo de ocurrir... Por favor, inténtelo de nuevo.",uploadError1:"Se produjo un error durante el envío del archivo.[br][em]➩ Error §.[/em]",uploadError2:"Se produjo un error durante el procesamiento del archivo.[br][em]➩ §[/em]",uploadRestart:"Le invitamos a [a §]intenter de nuevo[/a]."};this.data.fr={buttonOk:"Ok",buttonCancel:"Annuler",buttonConfirm:"Valider",buttonClose:"Fermer",buttonPrev:"Précédent",buttonNext:"Suivant",buttonBrowse:"Choisir un fichier",operationTooLong:"Cette opération prend trop de temps ? ",warningLostChange:"Attention : toutes les modifications en cours seront perdues.",reloadLink:"Rechargez la page",operationInProgress:"Opération en cours...",uploadInProgress:"Envoi du fichier en cours...",uploadInEnding:"Traitement du fichier en cours...",imageError:"Malheureusement, il n'est pas possible d'afficher cette photo pour le moment. Il se peut que le fichier soit temporairement inaccessible.",videoError:"Malheureusement, il n'est pas possible de lire cette vidéo pour le moment. Il se peut que le fichier soit temporairement inaccessible ou que votre navigateur ne puisse pas lire le format de la vidéo.[br][br]Essayez de [a href='§' download='']télécharger[/a] la vidéo.",ctrlSlideshowFirstLast:"début/fin",ctrlSlideshowNextPrev:"précédent/suivant",ctrlVideoPause:"lecture/pause",ctrlVideoTime:"reculer/avancer",ctrlVideoSound:"baisser/augmenter le volume",ctrlVideoMute:"couper le son",ctrlDialogFullscreen:"plein écran",ctrlDialogQuit:"quitter",ctrlKeyEnd:"Fin",ctrlKeyEsc:"Échap",uploadAllType:"Tous les fichiers sont acceptés.[br]Taille maximale : § Mo.",uploadOneType:"Format de fichier accepté : §.[br]Taille maximale : § Mo.",uploadMultiType:"Formats de fichier acceptés : § et §.[br]Taille maximale : § Mo.",uploadDecimal:",",upload11:"§% - § ko/s - § minutes restantes",upload12:"§% - § ko/s - § minute restante",upload13:"§% - § ko/s - § secondes restantes",upload14:"§% - § ko/s",upload21:"§% - à § ko/s en § minutes",upload22:"§% - à § ko/s en § minute",upload23:"§% - à § ko/s en § secondes",upload24:"§% - à § ko/s",uploadBadType:"Il est impossible d'envoyer le fichier car le format du fichier proposé n'est pas autorisé. Format du fichier proposé : §.",uploadBadSize:"Il est impossible d'envoyer le fichier car la taille du fichier proposé est trop importante. Taille du fichier proposé : §\u00a0Mo.",uploadEmpty:"Il est impossible d'envoyer le fichier car le fichier est vide.",uploadError0:"Il semblerait qu'une erreur improbable vienne de se produire... Veuillez réessayer.",uploadError1:"Une erreur est survenue lors de l'envoi du fichier.[br][em]➩ Erreur §.[/em]",uploadError2:"Une erreur est survenue lors du traitement du fichier.[br][em]➩ §[/em]",uploadRestart:"Nous vous invitons à [a §]réessayer[/a]."};this.data.it={buttonOk:"Ok",buttonCancel:"Annulla",buttonConfirm:"Conferma",buttonClose:"Chiudi",buttonPrev:"Precedente",buttonNext:"Successivo",buttonBrowse:"Scegli un file",operationTooLong:"Questa operazione prende troppo tempo? ",warningLostChange:"Attenzione: tutte le modifiche in corso saranno perdute.",reloadLink:"Ricaricare la pagina",operationInProgress:"Operazione in corso...",uploadInProgress:"Invio del file in corso...",uploadInEnding:"Trattamento del file in corso...",imageError:"Purtroppo, non é possibile visualizzare questa foto al momento. Il file potrebbe essere temporaneamente inaccessibile.",videoError:"Purtroppo, non é possibile leggere questo video al momento. Il file portebbe essere temporaneamente inaccessibile o che il vostro browser non possa leggere il formato.[br][br]Provate a [a href='§' download='']scaricare[/a] il video.",ctrlSlideshowFirstLast:"inizio/fine",ctrlSlideshowNextPrev:"precedente/successivo",ctrlVideoPause:"riproduci/pausa",ctrlVideoTime:"indietro/avanti",ctrlVideoSound:"abbassare/aumentare il volume",ctrlVideoMute:"muto",ctrlDialogFullscreen:"schermo intero",ctrlDialogQuit:"esci",ctrlKeyEnd:"Fine",ctrlKeyEsc:"Esc",uploadAllType:"Tutti i file sono accettati.[br]Dimensione massima: § MB.",uploadOneType:"Formato del file accettato: §.[br]Dimensione massima: § MB.",uploadMultiType:"Formati accettati: § et §.[br]Dimensione massima: § MB.",uploadDecimal:",",upload11:"§% - § kB/s - § minuti rimanenti",upload12:"§% - § kB/s - § minuto rimanente",upload13:"§% - § kB/s - § secondi rimanenti",upload14:"§% - § kB/s",upload21:"§% - a § kB/s in § minuti",upload22:"§% - a § kB/s in § minuto",upload23:"§% - a § kB/s in § segundi",upload24:"§% - a § kB/s",uploadBadType:"Impossibile inviare il file, il formato proposto non é autorizzato. Formato proposto: §.",uploadBadSize:"Impossibile inviare, il file é troppo grande. Dimensione proposta: §\u00a0MB.",uploadEmpty:"Impossibile inviare, il file é vuoto.",uploadError0:"Sembrerebbe che un errore inaspettato si sia verificato... Riprova.",uploadError1:"Un errore si é verificato durante l'invio del file.[br][em]➩ Errore §.[/em]",uploadError2:"Un errore si é verificato durante il trattamento del file.[br][em]➩ §[/em]",uploadRestart:"Vi invitiamo a [a §]riprovare[/a]."};this.data.pt={buttonOk:"Ok",buttonCancel:"Cancelar",buttonConfirm:"Confirmar",buttonClose:"Fechar",buttonPrev:"Anterior",buttonNext:"Seguinte",buttonBrowse:"Escolher um ficheiro",userLeavePage:"Está prestes a sair...",operationTooLong:"Esta operação é muito demorada? ",warningLostChange:"Atenção: todas as alterações em curso serão perdidas.",reloadLink:"Recarregar esta página",operationInProgress:"Operação em curso...",uploadInProgress:"Envio do ficheiro em curso...",uploadInEnding:"Tratamento do ficheiro em curso...",imageError:"Infelizmente, não é possível visualizar esta imagem agora. Talvez o ficheiro esteja temporariamente indisponível.",videoError:"Infelizmente, não é possível visualizar este vídeo agora. Talvez o ficheiro esteja temporariamente indisponível ou o seu navegador não consiga ler o formato do vídeo.[br][br]Tente [a href='§' download='']descarregar[/a] o vídeo.",ctrlSlideshowFirstLast:"início/fim",ctrlSlideshowNextPrev:"anterior/seguinte",ctrlVideoPause:"reprodução/pausa",ctrlVideoTime:"recuar/avançar",ctrlVideoSound:"subir/baixar o volume",ctrlVideoMute:"silenciar",ctrlDialogFullscreen:"ecrã completo",ctrlDialogQuit:"sair",ctrlKeyEnd:"Fim",ctrlKeyEsc:"Esc",uploadAllType:"Todos os ficheiros foram aceites.[br]Tamanho máximo: § MB.",uploadOneType:"Formato do ficheiro aceite: §.[br]Tamanho máximo: § MB.",uploadMultiType:"Formatos de ficheiro aceites: § e §.[br]Tamanho máximo: § MB.",uploadDecimal:",",upload11:"§% - § kB/s - § minutos restantes",upload12:"§% - § kB/s - § minuto restantes",upload13:"§% - § kB/s - § segundos restantes",upload14:"§% - § kB/s",upload21:"§% - § kB/s em § minutos",upload22:"§% - § kB/s em § minuto",upload23:"§% - § kB/s em § segundos",upload24:"§% - § kB/s",uploadBadType:"É impossível enviar o ficheiro porque o formato não é permitido. Formato do ficheiro proposto: §.",uploadBadSize:"É impossível enviar o ficheiro porque o tamanho do ficheiro é demasiado grande. Tamanho do ficheiro proposto: §\u00a0MB.",uploadEmpty:"É impossível enviar o ficheiro porque o ficheiro está vazio.",uploadError0:"Parece ter acontecido um erro imprevisto. Por favor, tente novamente.",uploadError1:"Ocorreu um erro ao enviar o ficheiro.[br][em]➩ Erro §.[/em]",uploadError2:"Ocorreu um erro ao processar o ficheiro.[br][em]➩ §[/em]",uploadRestart:"Convidamo-lo a [a §]tentar novamente[/a]."};this.data.ru={buttonOk:"Ок",buttonCancel:"Отмена",buttonConfirm:"Подтвердить",buttonClose:"Закрыть",buttonPrev:"Предыдущий",buttonNext:"Следующий",buttonBrowse:"Выберите файл",operationTooLong:"Операция длится слишком долго? ",warningLostChange:"Внимание: все изменения будут потеряны.",reloadLink:"Обновить страницу",operationInProgress:"Операция в процессе...",uploadInProgress:"Загрузка в процессе...",ctrlSlideshowFirstLast:"начало/конец",ctrlSlideshowNextPrev:"предыдущий/следующий",ctrlVideoPause:"воспроизведение/пауза",ctrlVideoTime:"назад/вперед",ctrlVideoSound:"понизить/повысить громкость",ctrlVideoMute:"отключить звук",ctrlDialogFullscreen:"на весь экран",ctrlDialogQuit:"выйти",ctrlKeyEnd:"End",ctrlKeyEsc:"Escape",uploadAllType:"Все файлы приняты.[br]Максимальный размер: § MB.",uploadOneType:"Формат файла: §.[br]Максимальный размер: § MB.",uploadMultiType:"Форматы файлов: § и §.[br]Максимальный размер: § MB.",uploadDecimal:",",upload11:"§% - § kB/s - осталось § минут",upload12:"§% - § kB/s - осталось § минут",upload13:"§% - § kB/s - осталось § секунд",upload14:"§% - § kB/s",upload21:"§% - § kB/s за § минут",upload22:"§% - § kB/s за § минут",upload23:"§% - § kB/s за § секунд",upload24:"§% - § kB/s",uploadBadType:"Нельзя отправить файл потому что формат файла запрещен. Рекомендуемый формат файла: §.",uploadBadSize:"Нельзя отправить файл потому что размер файла слишком велик. Рекомендуемый размер файла: §\u00a0MB.",uploadEmpty:"Нельзя отправить файл поскольку он пуст.",uploadError0:"Кажется произошла не предусмотренная ошибка... Попробуйте еще раз.",uploadError1:"Возникла ошибка при отправке файла.[br][em]➩ Ошибка §.[/em]",uploadError2:"Возникла ошибка при обработке файла.[br][em]➩ §[/em]"};this.init=function(){var autolang,lang=apijs.config.lang,html=document.querySelector('html');if(lang.indexOf('auto')>-1){if(html.getAttribute('xml:lang')){autolang=html.getAttribute('xml:lang').slice(0,2)}else if(html.getAttribute('lang'))autolang=html.getAttribute('lang').slice(0,2);if((typeof autolang==='string')&&this.data.hasOwnProperty(autolang)){apijs.config.lang=autolang}else if(lang.indexOf('auto-')>-1)apijs.config.lang=lang.slice(5)};if(!this.data.hasOwnProperty(apijs.config.lang))apijs.config.lang='en'};this.translate=function(word){var lang=apijs.config.lang,i=0,arg=1,translation='',data;if(typeof this.data[lang][word]!=='string')if((lang!=='en')&&(typeof this.data.en[word]==='string')){lang='en'}else return word;if(arguments.length>1){for(data=this.data[lang][word].split('§');i<data.length;i++)translation+=(arg<arguments.length)?data[i]+arguments[arg++]:data[i];return translation};return this.data[lang][word]};this.nodeTranslate=function(word){return document.createTextNode(this.translate(word))};this.changeLang=function(lang){if(typeof lang==='string'){if(this.data.hasOwnProperty(lang)){apijs.config.lang=lang;return true};if(lang.indexOf('auto')>-1){apijs.config.lang=lang;this.init();return true}};return false}}
apijs.core.dialog=function(){"use strict";this.styles=null;this.media=null;this.paused=true;this.scrollTime=0;this.timer=null;this.callback=null;this.args=null;this.frag=null;this.a=null;this.b=null;this.c=null;this.d=null;this.e=null;this.t1=null;this.t2=null;this.dialogInformation=function(title,text,icon){if((typeof title==='string')&&(typeof text==='string')){this.initDialog('information',icon);this.htmlParent();this.htmlContent(title,text);this.htmlButtonOk();this.showDialog();apijs.html('button.confirm').focus()}else apijs.error('TheDialog:dialogInformation',{'(string) *title':title,'(string) *text':text,'(string) icon':icon})};this.dialogConfirmation=function(title,text,callback,args,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof callback==='function')){this.initDialog('confirmation',icon);this.htmlParent();this.htmlContent(title,text);this.htmlButtonConfirm('button');this.callback=callback;this.args=args;this.showDialog();apijs.html('button.confirm').focus()}else{if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))callback=callback.name;apijs.error('TheDialog:dialogConfirmation',{'(string) *title':title,'(string) *text':text,'(function) *callback':callback,'(mixed) args':args,'(string) icon':icon})}};this.dialogFormOptions=function(title,text,action,callback,args,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof action==='string')&&(typeof callback==='function')){this.initDialog('options',icon);this.htmlParent(action);this.htmlContent(title,text);this.htmlButtonConfirm('submit');this.callback=callback;this.args=args;this.showDialog();window.setTimeout(function(){apijs.html('input:not([readonly]),textarea:not([readonly]),select:not([disabled])').focus()},12)}else{if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))callback=callback.name;apijs.error('TheDialog:dialogFormOptions',{'(string) *title':title,'(string) *text':text,'(string) *action':action,'(function) *callback':callback,'(mixed) args':args,'(string) icon':icon})}};this.dialogFormUpload=function(title,text,action,inputname,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof action==='string')&&(typeof inputname==='string')){this.initDialog('upload',icon);this.htmlParent(action);this.htmlContent(title,text);this.htmlFormUpload(inputname);this.htmlButtonConfirm('submit');this.showDialog();apijs.html('button.browse').focus()}else apijs.error('TheDialog:dialogFormUpload',{'(string) *title':title,'(string) *text':text,'(string) *action':action,'(string) *inputname':inputname,'(string) icon':icon})};this.dialogProgress=function(title,text,icon){if((typeof title==='string')&&(typeof text==='string')){this.initDialog('progress',icon);this.htmlParent();this.htmlContent(title,text);this.htmlProgressBar();this.showDialog()}else apijs.error('TheDialog:dialogProgress',{'(string) *title':title,'(string) *text':text,'(string) icon':icon})};this.dialogWaiting=function(title,text,time,icon){if((typeof title==='string')&&(typeof text==='string')){this.initDialog('waiting',icon);this.htmlParent();this.htmlContent(title,text);this.showDialog();if((typeof time==='number')&&(time>5))this.timer=window.setTimeout(apijs.dialog.htmlLinkReload,time*1e3)}else apijs.error('TheDialog:dialogWaiting',{'(string) *title':title,'(string) *text':text,'(number) time':time,'(string) icon':icon})};this.dialogPhoto=function(url,name,date,legend,slideshow){if((typeof url==='string')&&(typeof name==='string')&&(typeof date==='string')&&(typeof legend==='string')){if(typeof slideshow==='string'){this.initDialog('photo','notransition slideshow loading'+((typeof slideshow==='string')?' '+slideshow:''));this.htmlParent()}else{this.initDialog('photo','notransition loading');this.htmlParent()};this.htmlMedia(url,name,date,legend);this.htmlHelp((typeof slideshow==='string'),false);this.htmlButtonClose();this.htmlButtonNavigation();this.showDialog()}else apijs.error('TheDialog:dialogPhoto',{'(string) *url':url,'(string) *name':name,'(string) *date':date,'(string) *legend':legend})};this.dialogVideo=function(url,name,date,legend,slideshow){if((typeof url==='string')&&(typeof name==='string')&&(typeof legend==='string')&&(typeof legend==='string')){if(typeof slideshow==='string'){this.initDialog('video','notransition slideshow loading'+((typeof slideshow==='string')?' '+slideshow:''));this.htmlParent()}else{this.initDialog('video','notransition loading');this.htmlParent()};this.htmlMedia(url,name,date,legend);this.htmlHelp((typeof slideshow==='string'),true);this.htmlButtonClose();this.htmlButtonNavigation();this.showDialog()}else apijs.error('TheDialog:dialogVideo',{'(string) *url':url,'(string) *name':name,'(string) *date':date,'(string) *legend':legend})};this.actionClose=function(ev){if(new RegExp('#('+apijs.config.slideshow.ids+'(?:-|\\.)[0-9]+(?:-|\\.)[0-9]+)').test(location.href))if(apijs.config.slideshow.anchor&&(typeof history.pushState==='function'))history.pushState({},'',location.href.slice(0,location.href.indexOf('#')));if(typeof ev==='object'){if((ev.target.getAttribute('id')==='apijsDialog')&&!apijs.dialog.styles.has('photo','video','progress','waiting','lock'))apijs.dialog.deleteDialog(true)}else if(this.t1)this.deleteDialog((typeof ev!=='boolean')?true:ev)};this.actionKey=function(ev){var styles=apijs.dialog.styles,media=apijs.dialog.media;if(!isNaN(ev))ev={keyCode:ev,ctrlKey:false,altKey:false,preventDefault:function(){}};if(styles.has('progress','waiting','lock')){if((ev.ctrlKey&&[81,87,82,115,116].has(ev.keyCode))||(ev.altKey&&(ev.keyCode===115))||[27,116].has(ev.keyCode))ev.preventDefault()}else if(styles.has('photo','video')&&(ev.keyCode===122)){ev.preventDefault();apijs.dialog.actionFullscreen()}else if(styles.has('slideshow')){if(ev.keyCode===27){ev.preventDefault();apijs.dialog.actionClose()}else if(ev.keyCode===35){ev.preventDefault();apijs.slideshow.actionLast()}else if(ev.keyCode===36){ev.preventDefault();apijs.slideshow.actionFirst()}else if(ev.keyCode===37){ev.preventDefault();apijs.slideshow.actionPrev()}else if(ev.keyCode===39){ev.preventDefault();apijs.slideshow.actionNext()}}else if(ev.keyCode===27){ev.preventDefault();apijs.dialog.actionClose()};if(styles.has('video'))if((ev.keyCode===32)||(ev.keyCode===80)){ev.preventDefault();if(media.networkState!==3)if(media.ended||media.paused){media.play()}else media.pause()}else if((ev.keyCode===38)||(ev.keyCode===33)){ev.preventDefault();if((media.networkState!==3)&&(media.duration!==Infinity))if(media.currentTime<(media.duration-10))media.currentTime+=10}else if((ev.keyCode===40)||(ev.keyCode===34)){ev.preventDefault();if((media.networkState!==3)&&(media.duration!==Infinity))if(media.currentTime>10){media.currentTime-=10}else media.currentTime=0}else if(ev.keyCode===107){ev.preventDefault();if(media.networkState!==3){if(media.muted)media.muted=false;if(media.volume<0.8){media.volume+=0.2}else media.volume=1}}else if(ev.keyCode===109){ev.preventDefault();if(media.networkState!==3){if(media.muted)media.muted=false;if(media.volume>0.21){media.volume-=0.2}else media.volume=0}}else if(ev.keyCode===77){ev.preventDefault();if(media.networkState!==3)media.muted=!media.muted};if([32,33,34,35,36,38,40].has(ev.keyCode))if(!['INPUT','TEXTAREA','SELECT'].has(ev.target.nodeName))apijs.dialog.actionScrollBrowser(ev)};this.actionCloseBrowser=function(ev){if(apijs.dialog.styles.has('progress','waiting','lock')){ev.preventDefault();ev.stopPropagation();ev.m=apijs.i18n.translate('warningLostChange');ev.returnValue=ev.m;return ev.m}};this.actionScrollBrowser=function(ev){if(apijs.dialog.styles.has('slideshow')&&['DOMMouseScroll','mousewheel'].has(ev.type)){var time=new Date().getTime()/1e3;if((apijs.dialog.scrollTime<1)||(time>(1+apijs.dialog.scrollTime))){apijs.dialog.scrollTime=time;apijs.slideshow[((ev.detail>0)||(ev.wheelDelta<0))?'actionNext':'actionPrev']()}};ev.preventDefault();ev.stopPropagation()};this.actionConfirm=function(){if(this.styles.has('options','confirmation')){if(this.styles.has('options'))if(this.callback(false,this.args)!==true)return false;this.styles.add('waiting');apijs.html('div.control').style.visibility='hidden';apijs.html('div.bbcode').style.visibility='hidden';this.a=document.createElement('p');this.a.setAttribute('class','saving');this.a.appendChild(apijs.i18n.nodeTranslate('operationInProgress'));this.t2.appendChild(this.a);this.timer=window.setTimeout(apijs.dialog.htmlLinkReload,7e3);window.setTimeout(function(){if((this.t2)&&(this.t2.nodeName==='FORM')){this.callback(this.t2.getAttribute('action'),this.args)}else if(this.t2)this.callback(this.args)}.bind(this),1e3)}else if(this.styles.has('upload'))apijs.upload.actionConfirm();return false};this.mediaReady=function(ev){var that=apijs.dialog,media=that.media,text;apijs.log('mediaReady:'+ev.type+' (styles: '+that.styles+')');if(media&&((ev.type==='load')||(ev.type==='durationchange'))&&that.styles.has('loading')){that.styles.remove('loading');media.setAttribute('style','visibility:visible;');if(media.nodeName==='IMG')media.setAttribute('src',media.imageData.src);apijs.objectFitImages()}else if(media&&(ev.type==='error')&&!that.styles.has('error')){that.styles.toggle('loading','error');text=document.createElement('span');text.innerHTML=((media.nodeName==='IMG')?apijs.i18n.translate('imageError'):apijs.i18n.translate('videoError',apijs.html('source').getAttribute('src'))).replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\[/g,'<').replace(/\]/g,'>');media.parentNode.insertBefore(text,media)}};this.actionHidden=function(){var media=apijs.dialog.media;if(!document.hidden&&!document.mozHidden&&!document.msHidden&&!document.webkitHidden){if(!apijs.dialog.paused)media.play()}else{apijs.dialog.paused=media.paused;media.pause()}};this.actionFullscreen=function(){var elem=apijs.dialog.t1;if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement){if(elem.requestFullscreen){elem.requestFullscreen()}else if(elem.mozRequestFullScreen){elem.mozRequestFullScreen()}else if(elem.webkitRequestFullscreen)elem.webkitRequestFullscreen()}else if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen)document.webkitCancelFullScreen()};this.initDialog=function(type,icon){if(typeof icon==='string'){icon=icon.replace(/start|ready|end|information|confirmation|options|upload|progress|waiting|photo|video/g,'').trim();icon=(icon.length>0)?icon:null};if(this.frag!==null)this.deleteDialog(false);this.styles=new apijs.core.styles();this.styles.init(type,icon);this.frag=document.createDocumentFragment();document.addEventListener('keydown',apijs.dialog.actionKey,false);window.addEventListener('beforeunload',apijs.dialog.actionCloseBrowser,false);window.addEventListener('DOMMouseScroll',apijs.dialog.actionScrollBrowser,false);window.addEventListener('mousewheel',apijs.dialog.actionScrollBrowser,false);window.addEventListener('touchmove',apijs.dialog.actionScrollBrowser,false);if(apijs.config.dialog.restrictNavigation)document.querySelectorAll('a,area,button,input,object,select,textarea,iframe').invokeAll('setAttribute','tabindex','-1')};this.showDialog=function(){if(apijs.html('#Dialog')){this.styles.toggle('start','ready');this.t1=apijs.html('#Dialog');this.t1.appendChild(this.frag.firstChild.firstChild);this.t1.setAttribute('class',this.t2.getAttribute('class'))}else if(this.styles.has('notransition')){this.styles.toggle('start','ready');document.body.appendChild(this.frag)}else{document.body.appendChild(this.frag);window.setTimeout(function(){this.styles.toggle('start','ready')}.bind(this),12)};if(apijs.config.dialog.closeOnClick&&!this.styles.has('progress','waiting','lock'))document.addEventListener('click',apijs.dialog.actionClose,false);if(this.styles.has('video'))if(typeof document.hidden==='boolean'){document.addEventListener('visibilitychange',apijs.dialog.actionHidden,false)}else if(typeof document.mozHidden==='boolean'){document.addEventListener('mozvisibilitychange',apijs.dialog.actionHidden,false)}else if(typeof document.msHidden==='boolean'){document.addEventListener('msvisibilitychange',apijs.dialog.actionHidden,false)}else if(typeof document.webkitHidden==='boolean')document.addEventListener('webkitvisibilitychange',apijs.dialog.actionHidden,false)};this.deleteDialog=function(all){if(this.timer)clearTimeout(this.timer);document.removeEventListener('keydown',apijs.dialog.actionKey,false);window.removeEventListener('beforeunload',apijs.dialog.actionCloseBrowser,false);window.removeEventListener('DOMMouseScroll',apijs.dialog.actionScrollBrowser,false);window.removeEventListener('mousewheel',apijs.dialog.actionScrollBrowser,false);window.removeEventListener('touchmove',apijs.dialog.actionScrollBrowser,false);if(apijs.config.dialog.restrictNavigation)document.querySelectorAll('a,area,button,input,object,select,textarea,iframe').invokeAll('removeAttribute','tabindex');if(apijs.config.dialog.closeOnClick)document.removeEventListener('click',apijs.dialog.actionClose,false);this.t2.querySelectorAll('a.popup').invokeAll('removeEventListener','click',apijs.openTab,false);if(this.styles.has('video')){this.media.onerror=null;if(typeof this.media.pause==='function'){this.media.onpause=null;this.media.pause();if(navigator.userAgent.indexOf('WebKit/')>0)this.media.setAttribute('src','')};if(typeof document.hidden==='boolean'){document.removeEventListener('visibilitychange',apijs.dialog.actionHidden,false)}else if(typeof document.mozHidden==='boolean'){document.removeEventListener('mozvisibilitychange',apijs.dialog.actionHidden,false)}else if(typeof document.msHidden==='boolean'){document.removeEventListener('msvisibilitychange',apijs.dialog.actionHidden,false)}else if(typeof document.webkitHidden==='boolean')document.removeEventListener('webkitvisibilitychange',apijs.dialog.actionHidden,false)};if(all){this.styles.toggle('ready','end');document.body.removeChild(this.t1)}else this.t1.removeChild(this.t2);this.styles=null;this.media=null;this.paused=true;if(all){this.scrollTime=0;this.callback=null;this.args=null};this.frag=null;this.a=null;this.b=null;this.c=null;this.d=null;this.e=null;this.t1=null;this.t2=null};this.htmlParent=function(action){this.t1=document.createElement('div');this.t1.setAttribute('id','apijsDialog');if(typeof action==='string'){this.t2=document.createElement('form');this.t2.setAttribute('action',action);this.t2.setAttribute('method','post');this.t2.setAttribute('enctype','multipart/form-data');this.t2.setAttribute('onsubmit','return apijs.dialog.actionConfirm();')}else this.t2=document.createElement('div');this.t2.setAttribute('id','apijsBox');this.t1.appendChild(this.t2);this.frag.appendChild(this.t1)};this.htmlContent=function(title,text){if(title.length>0){this.a=document.createElement('h1');this.a.appendChild(document.createTextNode(title));this.t2.appendChild(this.a)};this.a=document.createElement('div');this.a.setAttribute('class','bbcode');if(text[0]!=='[')text='[p]'+text+'[/p]';this.a.innerHTML=text.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\[/g,'<').replace(/\]/g,'>');this.a.querySelectorAll('a.popup').invokeAll('addEventListener','click',apijs.openTab,false);this.t2.appendChild(this.a)};this.htmlButtonOk=function(){this.a=document.createElement('div');this.a.setAttribute('class','control');this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('onclick','apijs.dialog.actionClose();');this.b.setAttribute('class','confirm');this.b.appendChild(apijs.i18n.nodeTranslate('buttonOk'));this.a.appendChild(this.b);this.t2.appendChild(this.a)};this.htmlButtonConfirm=function(type){this.a=document.createElement('div');this.a.setAttribute('class','control');this.b=document.createElement('button');this.b.setAttribute('type',type);this.b.setAttribute('class','confirm');if(type!=='submit')this.b.setAttribute('onclick','apijs.dialog.actionConfirm();');this.b.appendChild(apijs.i18n.nodeTranslate('buttonConfirm'));this.a.appendChild(this.b);this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('class','cancel');this.b.setAttribute('onclick','apijs.dialog.actionClose();');this.b.appendChild(apijs.i18n.nodeTranslate('buttonCancel'));this.a.appendChild(this.b);this.t2.appendChild(this.a)};this.htmlButtonNavigation=function(){this.a=document.createElement('div');this.a.setAttribute('class','navigation');this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('disabled','disabled');this.b.setAttribute('onclick','apijs.slideshow.actionPrev();');this.b.setAttribute('class','prev');this.b.setAttribute('id','apijsPrev');this.c=document.createElement('span');this.c.appendChild(apijs.i18n.nodeTranslate('buttonPrev'));this.b.appendChild(this.c);this.a.appendChild(this.b);this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('disabled','disabled');this.b.setAttribute('onclick','apijs.slideshow.actionNext();');this.b.setAttribute('class','next');this.b.setAttribute('id','apijsNext');this.c=document.createElement('span');this.c.appendChild(apijs.i18n.nodeTranslate('buttonNext'));this.b.appendChild(this.c);this.a.appendChild(this.b);this.t2.appendChild(this.a)};this.htmlButtonClose=function(){this.a=document.createElement('div');this.a.setAttribute('class','close');this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('onclick','apijs.dialog.actionClose();');this.b.setAttribute('class','close');this.c=document.createElement('span');this.c.appendChild(apijs.i18n.nodeTranslate('buttonClose'));this.b.appendChild(this.c);this.a.appendChild(this.b);this.t2.appendChild(this.a)};this.htmlLinkReload=function(){var that=apijs.dialog;that.a=document.createElement('p');that.a.setAttribute('class','reload');that.a.appendChild(apijs.i18n.nodeTranslate('operationTooLong'));that.b=document.createElement('a');that.b.setAttribute('href','javascript:location.reload();');that.b.appendChild(apijs.i18n.nodeTranslate('reloadLink'));that.a.appendChild(that.b);that.a.appendChild(document.createTextNode('.'));that.b=document.createElement('br');that.a.appendChild(that.b);that.a.appendChild(apijs.i18n.nodeTranslate('warningLostChange'));that.t2.appendChild(that.a)};this.htmlFormUpload=function(inputname){this.a=document.createElement('div');this.a.setAttribute('class','control upload');if(typeof apijs.config.upload.tokenValue==='string'){this.b=document.createElement('input');this.b.setAttribute('type','hidden');this.b.setAttribute('name',apijs.config.upload.tokenName);this.b.setAttribute('value',apijs.config.upload.tokenValue);this.a.appendChild(this.b)};this.b=document.createElement('input');this.b.setAttribute('type','file');this.b.setAttribute('name',inputname);this.b.setAttribute('onchange',"apijs.html('button.confirm').focus(); apijs.html('span.filename').innerHTML = this.files[0].name");this.b.setAttribute('id','apijsFile');this.a.appendChild(this.b);this.b=document.createElement('button');this.b.setAttribute('type','button');this.b.setAttribute('onclick',"apijs.html('#File').click();");this.b.setAttribute('class','browse');this.b.appendChild(apijs.i18n.nodeTranslate('buttonBrowse'));this.a.appendChild(this.b);this.b=document.createElement('span');this.b.setAttribute('class','filename');this.a.appendChild(this.b);this.b=document.createElement('div');this.b.setAttribute('class','status');this.b.appendChild(document.createTextNode(''));this.a.appendChild(this.b);this.t2.appendChild(this.a)};this.htmlProgressBar=function(){this.a=document.createElement('svg');this.a.setAttribute('xmlns','http://www.w3.org/2000/svg');this.a.setAttribute('id','apijsProgress');this.b=document.createElement('rect');this.b.setAttribute('class','auto');this.a.appendChild(this.b);this.t2.appendChild(this.a);this.a=document.createElement('span');this.a.setAttribute('class','info');this.t2.appendChild(this.a)};this.htmlMedia=function(url,name,date,legend){var i,fileid=url.slice(url.lastIndexOf('/')+1),arr,ext,src,mimes={ogv:'video/ogg',webm:'video/webm',mp4:'video/mp4',m4v:'video/mp4'};this.a=document.createElement('dl');this.a.setAttribute('class','media');this.b=document.createElement('dt');if(this.styles.has('photo')){this.media=document.createElement('img');this.media.setAttribute('alt',legend.replace('"',''));this.media.imageData=new Image();this.media.imageData.src=url;this.media.imageData.onload=apijs.dialog.mediaReady;this.media.imageData.onerror=apijs.dialog.mediaReady}else{this.media=document.createElement('video');this.media.setAttribute('controls','controls');this.media.setAttribute('preload','metadata');arr=url.slice(url.lastIndexOf('.')+1);arr=((arr.indexOf('?')>0)&&(arr.indexOf('#')>0))?arr.slice(0,arr.indexOf('?'))+arr.slice(arr.indexOf('#')):arr;arr=((arr.indexOf('?')>0)&&(arr.indexOf('#')<0))?arr.slice(0,arr.indexOf('?')):arr;arr=arr.replace('#','.').replace(',','.').split('.');for(i=0;i<arr.length;i++){ext=arr[i];src=url.slice(0,url.lastIndexOf('.')+1)+ext;src=((url.indexOf('?')>0)&&(url.indexOf('#')>0))?src+url.slice(url.indexOf('?'),url.indexOf('#')):src;src=((url.indexOf('?')>0)&&(url.indexOf('#')<0))?src+url.slice(url.indexOf('?')):src;this.c=document.createElement('source');this.c.setAttribute('src',src);this.c.setAttribute('type',(mimes.hasOwnProperty(ext))?mimes[ext]:'video/unknown');this.media.appendChild(this.c)};this.media.ondurationchange=apijs.dialog.mediaReady;this.media.onerror=apijs.dialog.mediaReady;this.c.onerror=apijs.dialog.mediaReady};this.media.setAttribute('id','apijsMedia');this.b.appendChild(this.media);this.a.appendChild(this.b);this.b=document.createElement('dd');if((name!=='false')||(date!=='false')){this.c=document.createElement('span');if((name!=='false')&&(name!=='auto')&&(date!=='false')){this.c.appendChild(document.createTextNode(name+' ('+date+') '))}else if((name!=='false')&&(name!=='auto')){this.c.appendChild(document.createTextNode(name+' '))}else if((name==='auto')&&(date!=='false')){this.c.appendChild(document.createTextNode(fileid+' ('+date+') '))}else if(name==='auto'){this.c.appendChild(document.createTextNode(fileid+' '))}else if(date!=='false')this.c.appendChild(document.createTextNode('('+date+') '));this.b.appendChild(this.c)};this.b.appendChild(document.createTextNode((legend.length>0)?legend:'\u00A0'));this.a.appendChild(this.b);this.t2.appendChild(this.a)};this.htmlHelp=function(slideshow,video){var i,j,tmp,total,data=[];if(slideshow){data.push(['start;↖','ctrlKeyEnd','ctrlSlideshowFirstLast']);data.push(['left;←','right;→','ctrlSlideshowNextPrev'])};if(video){data.push(['bottom;↓','top;↑','ctrlVideoTime']);data.push(['minus;-','plus;+','ctrlVideoSound']);data.push(['m','ctrlVideoMute']);data.push(['p','ctrlVideoPause'])};data.push(['f11','ctrlDialogFullscreen']);data.push(['ctrlKeyEsc','ctrlDialogQuit']);this.a=document.createElement('ul');this.a.setAttribute('class','kbd');for(i=0;i<data.length;i++){total=data[i].length-1;this.b=document.createElement('li');for(j=0;j<total;j++){this.c=document.createElement('kbd');if(data[i][j].indexOf(';')>0){tmp=data[i][j].split(';');this.c.setAttribute('class',tmp[0]);this.c.setAttribute('title',tmp[1])}else this.c.appendChild(apijs.i18n.nodeTranslate(data[i][j]));this.b.appendChild(this.c)};this.b.appendChild(apijs.i18n.nodeTranslate(data[i][total]));this.a.appendChild(this.b)};this.t2.appendChild(this.a)}};apijs.core.styles=function(){"use strict";this.data=[];this.init=function(type,icon){this.data.push('start');this.data.push(type);if(typeof icon==='string')this.data=this.data.concat(icon.split(' '))};this.add=function(value){if(!this.data.hasOwnProperty(value))this.data.push(value);this.update();return this};this.toggle=function(search,replace){if(this.has(search))this.remove(search);if(!this.has(replace))this.add(replace);this.update();return this};this.remove=function(){var arg,args=Array.prototype.slice.call(arguments,0);for(arg in args)if(args.hasOwnProperty(arg))this.data.splice(this.data.indexOf(args[arg]),1);this.update();return this};this.has=function(){return this.data.has(Array.prototype.slice.call(arguments,0))};this.toString=function(){return this.data.join(' ')};this.update=function(){if(this.has('start','ready','end')){if(apijs.dialog.t1)apijs.dialog.t1.setAttribute('class',this.toString());if(apijs.dialog.t2)apijs.dialog.t2.setAttribute('class',this.toString())}}}
apijs.core.slideshow=function(){"use strict";this.ready=0;this.current=null;this.init=function(){var i,j,id,ids=apijs.config.slideshow.ids,hoverload=false;for(i=0;apijs.html(ids+'.'+i)!==null;i++){hoverload=(apijs.html(ids+'.'+i).getAttribute('class').indexOf('hoverload')>-1);for(j=0;apijs.html(ids+'.'+i+'.'+j)!==null;j++){apijs.html(ids+'.'+i+'.'+j).addEventListener('click',apijs.slideshow.showMedia,false);if(hoverload)apijs.html(ids+'.'+i+'.'+j).addEventListener('mouseover',apijs.slideshow.showMedia,false)};if(apijs.html(ids+'.'+i+'.999'))apijs.html(ids+'.'+i+'.999').addEventListener('click',apijs.slideshow.showMedia,false);this.ready+=1};if(new RegExp('#('+ids+'(?:-|\\.)[0-9]+(?:-|\\.)[0-9]+)').test(location.href)){id=RegExp.$1.replace(/-/g,'.');if(apijs.html(id))this.showMedia(id)}};this.showMedia=function(ev,push){var source,media={};if(typeof ev==='string'){source=apijs.html(ev);media.id=ev}else{ev.preventDefault();source=(ev.target.nodeName==='A')?ev.target:ev.target.parentNode;media.id=source.getAttribute('id');if((ev.type==='mouseover')&&source.hasAttribute('class')&&(source.getAttribute('class').indexOf('current')>-1))return};media.prefix=apijs.config.slideshow.ids+'.'+media.id.split('.')[1];media.number=media.numberSrc=parseInt(media.id.split('.')[2],10);media.presentation=apijs.html(media.prefix+'.999');if(media.number!==999){var allLinks=apijs.html(media.prefix).querySelectorAll('a[id][type]'),allConts=apijs.html(media.prefix).querySelectorAll('dl');if((media.presentation!==null)||(allLinks.length!==allConts.length)){allLinks.invokeAll('removeAttribute','class');source.setAttribute('class','current')}else{allConts.invokeAll('removeAttribute','class');source.parentNode.parentNode.setAttribute('class','current')}};if(media.presentation!==null){if(media.number===999){source=(media.presentation.hasAttribute('class'))?media.presentation.getAttribute('class'):media.prefix+'.0';source=apijs.html(source);media.number=parseInt(source.getAttribute('id').split('.')[2],10)};media.config=source.querySelector('input').getAttribute('value').split('|');media.mainImg=media.config.shift();if(media.numberSrc!==999){media.presentation.setAttribute('href',source.getAttribute('href'));media.presentation.querySelector('img').setAttribute('src',media.mainImg);media.presentation.querySelector('img').setAttribute('alt',source.querySelector('img').getAttribute('alt'));media.presentation.setAttribute('class',media.id)};media.mainImg=null}else media.config=source.querySelector('input').getAttribute('value').split('|');media.url=source.getAttribute('href');media.type=source.getAttribute('type').substr(0,5).replace('image','dialogPhoto').replace('video','dialogVideo');media.type=(media.type.indexOf('dialog')===0)?media.type:'dialogPhoto';media.styles=apijs.html(media.prefix).getAttribute('class').replace(/gallery|album/g,'').trim();if((media.presentation&&(media.numberSrc===999))||!media.presentation||(typeof ev==='string'))apijs.slideshow.showDialog(media,push)};this.showDialog=function(media,push){apijs.dialog[media.type](media.url,media.config[0],media.config[1],media.config[2],media.styles);if((apijs.dialog.styles!==null)&&apijs.dialog.styles.has('slideshow')){this.current={number:media.number,first:null,prev:null,next:null,last:null,total:null};this.current.total=apijs.html(media.prefix).querySelectorAll('a[id][type]').length-1;this.current.total=(media.presentation)?this.current.total-1:this.current.total;this.current.first=media.prefix+'.0';this.current.prev=(media.number>0)?media.prefix+'.'+(this.current.number-1):null;this.current.next=(media.number<this.current.total)?media.prefix+'.'+(this.current.number+1):null;this.current.last=media.prefix+'.'+this.current.total;if(this.current.prev!==null)apijs.html('#Prev').removeAttribute('disabled');if(this.current.next!==null)apijs.html('#Next').removeAttribute('disabled');if(apijs.config.slideshow.anchor&&(typeof history.pushState==='function')&&((typeof push==='boolean')?push:true)){var hash=location.href;hash=(hash.indexOf('#')>0)?hash.slice(0,hash.indexOf('#')):hash;hash+='#'+(media.prefix+'.'+((media.number!==999)?media.number:0)).replace(/\./g,'-');history.pushState({},'',hash)}}else this.current=null};this.popState=function(){if(new RegExp('#('+apijs.config.slideshow.ids+'(?:-|\\.)[0-9]+(?:-|\\.)[0-9]+)').test(location.href)){var id=RegExp.$1.replace(/-/g,'.');if(apijs.html(id))apijs.slideshow.showMedia(id,false)}else if(apijs.slideshow.current!==null)apijs.dialog.actionClose(true)};this.actionFirst=function(){if((this.current!==null)&&(this.current.number>0)&&(this.current.number<=this.current.total))this.showMedia(this.current.first)};this.actionPrev=function(){if((this.current!==null)&&(this.current.prev!==null)&&(this.current.number>0))this.showMedia(this.current.prev)};this.actionNext=function(){if((this.current!==null)&&(this.current.next!==null)&&(this.current.number<this.current.total))this.showMedia(this.current.next)};this.actionLast=function(){if((this.current!==null)&&(this.current.number>=0)&&(this.current.number<this.current.total))this.showMedia(this.current.last)}}
apijs.core.upload=function(){"use strict";this.title=null;this.action=null;this.inputname=null;this.extensions=null;this.callback=null;this.args=null;this.icon=null;this.maxsize=0;this.startTime=0;this.lastTime=0;this.sendFile=function(title,action,inputname,maxsize,extensions,callback,args,icon){var text;if(arguments.length>=6){this.title=title;this.action=action;this.inputname=inputname;this.extensions=(typeof extensions==='string')?extensions.split(','):[];this.callback=callback;this.args=args;this.icon=icon;this.maxsize=maxsize}else if(title!==true)this.title=null;if((typeof this.title==='string')&&(typeof this.action==='string')&&(typeof this.inputname==='string')&&(typeof this.maxsize==='number')&&(this.extensions.length>0)&&(typeof this.callback==='function')){maxsize=this.maxsize.toFixed(2).replace('.00','').replace('.',apijs.i18n.translate('uploadDecimal'));if(this.extensions[0]==='*'){text=apijs.i18n.translate('uploadAllType',maxsize)}else if(this.extensions.length===1){text=apijs.i18n.translate('uploadOneType',this.extensions.join(','),maxsize)}else text=apijs.i18n.translate('uploadMultiType',this.extensions.slice(0,-1).join(', '),this.extensions.slice(-1),maxsize);apijs.dialog.dialogFormUpload(this.title,text,this.action,this.inputname,this.icon)}else{if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))callback=callback.name;apijs.error('TheUpload:sendFile',{'(string) *title':title,'(string) *action':action,'(string) *inputname':inputname,'(number) *maxsize':maxsize,'(string) *extensions':extensions,'(function) *callback':callback,'(mixed) args':args,'(string) icon':icon})}};this.actionConfirm=function(){var tagInput=apijs.html('#File'),tagError=apijs.html('div.status').firstChild,checks={filePresent:false,fileType:true,fileSize:false,type:'',size:this.maxsize};if((this.extensions!==null)&&(tagInput.value.length>0)){checks.filePresent=true;if(this.extensions[0]!=='*'){checks.type=tagInput.value.slice(tagInput.value.lastIndexOf('.')+1).toLowerCase();if(!this.extensions.has(checks.type))checks.fileType=false};if(typeof tagInput.files==='object')checks.size=tagInput.files[0].size;if((checks.size>0)&&(checks.size<=this.maxsize*1048576))checks.fileSize=true};if(checks.filePresent&&checks.fileType&&checks.fileSize){if(this.action.indexOf('noAjax')>0){apijs.html('form').submit();window.setTimeout(apijs.upload.onStart.bind(this),12)}else this.ajaxSend()}else if(this.extensions!==null){if(checks.filePresent&&!checks.fileType){tagError.replaceData(0,tagError.nodeValue.length,apijs.i18n.translate('uploadBadType',checks.type))}else if(checks.filePresent&&!checks.fileSize&&(checks.size>0)){checks.size=(checks.size/1048576).toFixed(2).replace('.00','').replace('.',apijs.i18n.translate('uploadDecimal'));tagError.replaceData(0,tagError.nodeValue.length,apijs.i18n.translate('uploadBadSize',checks.size))}else if(checks.filePresent&&!checks.fileSize)tagError.replaceData(0,tagError.nodeValue.length,apijs.i18n.translate('uploadEmpty'));apijs.html('button.browse').focus()}};this.ajaxSend=function(){var form=new FormData(),xhr=new XMLHttpRequest();form.append(apijs.html('#File').getAttribute('name'),apijs.html('#File').files[0]);xhr.open('POST',this.action+((this.action.indexOf('?')>0)?'&isAjax=true':'?isAjax=true'),true);if(typeof apijs.config.upload.tokenValue==='string')xhr.setRequestHeader('X-CSRF-Token',apijs.config.upload.tokenValue);xhr.onreadystatechange=function(){if((xhr.readyState===4)&&(xhr.status===200)){var text=xhr.responseText.trim();apijs.log('ajaxSend:onreadystatechange status:200 message:'+text);if(text.indexOf('success-')===0){apijs.upload.updateTitle();apijs.upload.callback(text.slice(8),apijs.upload.args)}else apijs.upload.onError('uploadError2',text)}else if(xhr.readyState===4){apijs.log('ajaxSend:onreadystatechange status:'+xhr.status+' message: '+xhr.responseText);apijs.upload.onError('uploadError1',xhr.status)}};xhr.upload.onloadstart=apijs.upload.onStart.bind(this);xhr.upload.onprogress=apijs.upload.onProgress.bind(this);xhr.upload.onload=apijs.upload.onProgress.bind(this);xhr.upload.onerror=apijs.upload.onError.bind(this);xhr.send(form)};this.onError=function(key,txt){this.updateTitle();txt=((typeof key==='string')?apijs.i18n.translate(key,txt):apijs.i18n.translate('uploadError0'))+'[br][br]'+apijs.i18n.translate('uploadRestart','href="apijs://restart" onclick="apijs.upload.sendFile(true); return false;"');apijs.dialog.dialogInformation(this.title,txt,([null,undefined].indexOf(this.icon)<0)?'upload error '+this.icon:'upload error')};this.onStart=function(){this.startTime=this.lastTime=Math.round(new Date().getTime()/1e3);apijs.dialog.dialogProgress(this.title,apijs.i18n.translate('uploadInProgress'),this.icon);apijs.log('onStart:sending...')};this.onProgress=function(ev){var percent,key,rate,time,elapsedTime,totalTime,currentTime=Math.round(new Date().getTime()/1e3),mins;if(ev.lengthComputable&&(ev.type==='progress')&&(currentTime>=(this.lastTime+2))){this.lastTime=currentTime;percent=Math.floor((ev.loaded*100)/ev.total);if((percent>0)&&(percent<100)){this.updateTitle(percent);elapsedTime=currentTime-this.startTime;totalTime=elapsedTime*100/percent+10;if(elapsedTime>=25){time=Math.round(totalTime-elapsedTime);time=Math.ceil(time/10)*10;mins=Math.ceil(time/60);rate=Math.round(ev.loaded/elapsedTime/1024);if((elapsedTime<40)||(totalTime<90)){key=14;time=null}else if(mins>1){key=11;time=mins}else if(time>50){key=12;time=1}else key=13};this.updateProgress(percent,key,rate,time)}}else if(ev.type==='load'){time=Math.round(new Date().getTime()/1e3)-this.startTime;mins=Math.ceil(time/60);rate=Math.round(ev.loaded/time/1024);if((rate>0)&&(rate!==Infinity)){if(mins>1){key=21;time=mins}else if(time>50){key=22;time=1}else if(time>20){key=23}else{key=24;time=null}}else{rate=null;time=null};this.updateTitle(100);this.updateProgress(100,key,rate,time)}};this.updateProgress=function(percent,key,rate,time){var rect=apijs.html('rect'),text=apijs.html('span.info'),data;if(percent>99){rect.setAttribute('class','end');rect.style.width='';data='100%';apijs.html('p').textContent=apijs.i18n.translate('uploadInEnding')}else{rect.style.width=data=percent+'%';if(rect.hasAttribute('class'))rect.removeAttribute('class')};if((typeof key==='number')&&(typeof rate==='number')&&(typeof time==='number')){data=apijs.i18n.translate('upload'+key,percent,rate,time)}else if((typeof key==='number')&&(typeof rate==='number'))data=apijs.i18n.translate('upload'+key,percent,rate);text.textContent=data};this.updateTitle=function(percent){if(typeof percent==='number'){document.title=(/^[0-9]{1,3}% - /.test(document.title))?percent+'% - '+document.title.slice(document.title.indexOf(' - ')+3):percent+'% - '+document.title}else if(/^[0-9]{1,3}% - /.test(document.title))document.title=document.title.slice(document.title.indexOf(' - ')+3)}}