/**
 * Copyright 2009-2013 | Fabrice Creuzot (luigifab) <code~luigifab~info>
 * https://redmine.luigifab.info/projects/magento/wiki/apijs
 * (4.0.0) http://www.luigifab.info/apijs
 *
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
var apijs={core:{},config:{lang:'fr',debug:false,debugkey:false,navigator:true,transition:true,autolang:true,dialog:{closeOnClic:false,restrictNavigation:true,savingDialog:false,savingTime:700,margin:25,emotes:false,showLoader:true,showFullsize:false,savePhoto:false,saveVideo:false,videoAutoplay:true,videoWidth:640,videoHeight:480,imagePrev:null,imageNext:null,imageClose:null,imageUpload:{src:'progress2.svg.php',width:300,height:17},filePhoto:null,fileVideo:null,fileUpload:null},slideshow:{ids:'diaporama'}}};if(typeof window.addEventListener==='function'){window.addEventListener('load',startApijs,false);}
else if(navigator.userAgent.indexOf('MSIE 8')>-1){apijs.config.navigator=false;apijs.config.transition=false;document.createElement('video');window.innerWidth=document.documentElement.clientWidth;window.innerHeight=document.documentElement.clientHeight;window.attachEvent('onload',startApijs);}
function startApijs(){if((typeof document.body.style.transitionDuration!=='string')&&(typeof document.body.style.OTransitionDuration!=='string')&&(typeof document.body.style.MozTransitionDuration!=='string')&&(typeof document.body.style.webkitTransitionDuration!=='string')){apijs.config.transition=false;}
if((typeof apijs.core.i18n==='function')&&(typeof apijs.core.bbcode==='function')&&(typeof apijs.core.dialog==='function')&&(typeof apijs.core.upload==='function')&&(typeof apijs.core.slideshow==='function')){apijs.i18n=new apijs.core.i18n();apijs.i18n.init();if(typeof setApijsConfig==='function')
setApijsConfig();apijs.dialog=new apijs.core.dialog();apijs.upload=new apijs.core.upload();apijs.slideshow=new apijs.core.slideshow();apijs.slideshow.init();}}
apijs.core.i18n=function(){this.data=[];this.data.en={buttonOk:"Ok",buttonCancel:"Cancel",buttonConfirm:"Confirm",buttonClose:"Close",buttonPrev:"Previous",buttonNext:"Next",downloadLink:"Download",operationTooLong:"This operation is too long ? ",warningLostChange:"Warning: all changes in progress will be lost.",reloadLink:"Reload this page",operationInProgress:"Operation in progress...",uploadInProgress:"Upload in progress...",savingInProgress:"Saving...",uploadTime:"§% (§)",uploadRate:"§% (§ KB/s)",uploadRateTime:"§% (§ KB/s - §)",uploadAllType:"All files are accepted.[br]Maximum size: § [abbr title='Megabyte']MB[/abbr].",uploadOneType:"Accepted file format: §.[br]Maximum size: § [abbr title='Megabyte']MB[/abbr].",uploadMultiType:"Accepted file formats: § and §.[br]Maximum size: § [abbr title='Megabyte']MB[/abbr].",uploadBadOneType:"[p]It's impossible to send the file because the file format proposed isn't allowed.[/p][p]➩ Proposed file: [strong]§[/strong][br]➩ Accepted file format: §.[/p]",uploadBadMultiType:"[p]It's impossible to send the file because the file format proposed isn't allowed.[/p][p]➩ Proposed file: [strong]§[/strong][br]➩ Accepted file formats: § and §.[/p]",deleteNotFound:"Unfortunately, it's currently impossible to delete requested file (Error §: §).",browserNoVideo:"[p]Your browser [strong]§ §[/strong] doesn't support the <video> tag.[br]To watch this video, you need to upgrade your browser.[/p][ul][li][a href='http://www.google.com/chrome?hl=en' class='popup']Chrome 3.0+[/a][/li][li][a href='http://www.mozilla-europe.org/en/firefox/' class='popup']Firefox 3.5+[/a][/li][li][a href='http://windows.microsoft.com/en-US/internet-explorer/products/ie/home' class='popup']Internet Explorer 9.0+[/a][/li][li][a href='http://www.konqueror.org/' class='popup']Konqueror 4.4+[/a][/li][li][a href='http://www.opera.com/' class='popup']Opera 10.50+[/a][/li][li][a href='http://www.apple.com/safari/' class='popup']Safari 3.1+[/a][/li][/ul][p]It is also possible that the <video> tag is supported, but the codec used by the video (§) does not.[/p][p class='navigator']Your browser identifies itself as: §[/p]",debugInvalidCall:"(debug) Invalid call",debugInvalidUse:"(debug) Invalid use",debugUnknownAction:"(debug) Unknown action",debugKeyDetected:"(debug) Key detected",debugKeyCode:"Code of the seizure key: §",debugInvalidConfig:"(debug) Invalid configuration",debugNotRecognizedConfig:"Image configuration wasn't recognized.",debugNotExist:"doesn't exist (unlikely error)",debugBadUse:"The upload dialog must be called with apijs.upload.sendFile()."};this.data.fr={buttonOk:"Ok",buttonCancel:"Annuler",buttonConfirm:"Valider",buttonClose:"Fermer",buttonPrev:"Précédent",buttonNext:"Suivant",downloadLink:"Télécharger",operationTooLong:"Cette opération prend trop de temps ? ",warningLostChange:"Attention : toutes les modifications en cours seront perdues.",reloadLink:"Rechargez la page",operationInProgress:"Opération en cours...",uploadInProgress:"Envoi du fichier en cours...",savingInProgress:"Enregistrement en cours...",uploadTime:"§% (§)",uploadRate:"§% (§ Ko/s)",uploadRateTime:"§% (§ Ko/s - §)",uploadAllType:"Tous les fichiers sont acceptés.[br]Taille maximale : § [abbr title='Mégaoctet']Mo[/abbr].",uploadOneType:"Format de fichier accepté : §.[br]Taille maximale : § [abbr title='Mégaoctet']Mo[/abbr].",uploadMultiType:"Formats de fichier acceptés : § et §.[br]Taille maximale : § [abbr title='Mégaoctet']Mo[/abbr].",uploadBadOneType:"[p]Il est impossible d'envoyer le fichier car le format du fichier proposé n'est pas autorisé.[/p][p]➩ Fichier proposé : [strong]§[/strong][br]➩ Format de fichier accepté : §.[/p]",uploadBadMultiType:"[p]Il est impossible d'envoyer le fichier car le format du fichier proposé n'est pas autorisé.[/p][p]➩ Fichier proposé : [strong]§[/strong][br]➩ Formats de fichier acceptés : § et §.[/p]",deleteNotFound:"Malheureusement, il est actuellement impossible de supprimer le fichier demandé (Erreur § : [span xml:lang='en']§[/span]).",browserNoVideo:"[p]Votre navigateur [strong]§ §[/strong] ne supporte pas la balise <video>.[br]Pour voir cette vidéo, vous devez mettre à jour votre navigateur.[/p][ul][li][a href='http://www.google.com/chrome?hl=fr' class='popup']Chrome 3.0+[/a][/li][li][a href='http://www.mozilla-europe.org/fr/firefox/' class='popup']Firefox 3.5+[/a][/li][li][a href='http://windows.microsoft.com/fr-FR/internet-explorer/products/ie/home' class='popup']Internet Explorer 9.0+[/a][/li][li][a href='http://www.konqueror.org/' class='popup']Konqueror 4.4+[/a][/li][li][a href='http://www.opera.com/' class='popup']Opera 10.50+[/a][/li][li][a href='http://www.apple.com/fr/safari/' class='popup']Safari 3.1+[/a][/li][/ul][p]Il se peut également que la balise <video> soit supportée, mais que le codec utilisé par la vidéo (§) ne le soit pas.[/p][p class='navigator']Votre navigateur s'identifie en tant que : §[/p]",debugInvalidCall:"(debug) Appel invalide",debugInvalidUse:"(debug) Utilisation invalide",debugUnknownAction:"(debug) Action inconnue",debugKeyDetected:"(debug) Touche détectée",debugKeyCode:"Code de la touche saisie : §",debugInvalidConfig:"(debug) Configuration invalide",debugNotRecognizedConfig:"La configuration de l'image n'a pas été reconnue.",debugNotExist:"n'existe pas (erreur improbable)",debugBadUse:"Le dialogue d'upload doit être appelé via apijs.upload.sendFile()."};this.init=function(){if(apijs.config.autolang){var autolang=null;if(document.getElementsByTagName('html')[0].getAttribute('xml:lang'))
autolang=document.getElementsByTagName('html')[0].getAttribute('xml:lang').slice(0,2);else if(document.getElementsByTagName('html')[0].getAttribute('lang'))
autolang=document.getElementsByTagName('html')[0].getAttribute('lang').slice(0,2);if((typeof autolang==='string')&&this.data.hasOwnProperty(autolang))
apijs.config.lang=autolang;else if((typeof apijs.config.lang!=='string')||!this.data.hasOwnProperty(apijs.config.lang))
apijs.config.lang='en';}
else if((typeof apijs.config.lang!=='string')||!this.data.hasOwnProperty(apijs.config.lang)){apijs.config.lang='en';}};this.translate=function(word){if(typeof this.data[apijs.config.lang][word]!=='string'){return word;}
if(arguments.length>1){var i=0,arg=1,data='',translation='';for(data=this.data[apijs.config.lang][word].split('§');i<data.length;i++)
translation+=(arg<arguments.length)?data[i]+arguments[arg++]:data[i];return translation;}
return this.data[apijs.config.lang][word];};this.changeLang=function(lang){if((typeof lang==='string')&&this.data.hasOwnProperty(lang)){apijs.config.lang=lang;return true;}
return false;};};
apijs.core.bbcode=function(){this.bbcode=null;this.object=null;this.fragment=null;this.emotes=false;this.init=function(data,emotes){this.object={tag:'div',content:[]};this.object['class']='bbcode';this.bbcode=(data[0]!=='[')?'[p]'+data+'[/p]':data;this.bbcode=this.bbcode.replace(/\\\]/g,']');if((apijs.config.bbcode!==null)&&(typeof apijs.config.bbcode==='object'))
this.emotes=(typeof emotes==='boolean')?emotes:true;};this.exec=function(){this.readData(this.bbcode,0);this.fragment=document.createDocumentFragment();this.fragment.appendChild(this.createDomFragment(this.object));};this.getFragment=function(){return this.fragment;};this.readData=function(data,level){var element=null,attributes=null,content=null,text=null,other=null,cut=0;if((data[0]!=='[')&&((cut=data.search(/\[([a-z1-6]+)(?: [a-z:]+=["'][^\]]*["'])*\]/))>-1)){text=data.slice(0,cut);this.readData(text,level);other=data.slice(cut);if((cut=other.indexOf('[/'+RegExp.$1+']'))>-1){element=other.slice(0,cut+RegExp.$1.length+3);other=other.slice(cut+RegExp.$1.length+3);this.readData(element,level);}
if(/^(\[(?:area|br|col|hr|iframe|img|input|param)(?: [a-z:]+=["'][^\]]*["'])*\])/.test(other)){element=other.slice(0,RegExp.$1.length);other=other.slice(RegExp.$1.length);this.readData(element,level);}
if(other.length>0)
this.readData(other,level);}
else if(/^\[(area|br|col|hr|iframe|img|input|param)((?: [a-z:]+=["'][^\]]*["'])*)\]/.test(data)){element=RegExp.$1;attributes=RegExp.$2;other=data.slice(2+element.length+attributes.length);this.addElement(element,attributes,level);if(other.length>0)
this.readData(other,level);}
else if(/^\[([a-z1-6]+)((?: [a-z:]+=["'][^\]]*["'])*)\]/.test(data)){element=RegExp.$1;attributes=RegExp.$2;cut=data.indexOf('[/'+element+']');content=data.slice(2+element.length+attributes.length,cut);other=data.slice(3+element.length+cut);this.addElement(element,attributes,level);this.readData(content,level+1);if(other.length>0)
this.readData(other,level);}
else{this.addElement(data,null,level);}};this.addElement=function(data,attributes,level){var directlink=null,attr=null,name=null,value=null,hasEmotes=false,currentEmote={};directlink=this.getContentNode(this.object,0,level);if(attributes!==null){if(directlink.hasOwnProperty('content'))
directlink.content.push({tag:data});else
directlink.content=[{tag:data}];if(attributes.length>5){attributes=attributes.slice(1,-1).split(/["'] /);for(attr in attributes)if(attributes.hasOwnProperty(attr)){name=attributes[attr].slice(0,attributes[attr].indexOf('='));value=attributes[attr].slice(attributes[attr].indexOf('=')+2);if(directlink.hasOwnProperty('content'))
directlink.content[directlink.content.length-1][name]=value;else
directlink[name]=value;}}}
else{if(this.emotes){data=data.split(' ');for(value in data)if(data.hasOwnProperty(value)){if(typeof data[value]==='string'){if(apijs.config.bbcode.hasOwnProperty(data[value])){hasEmotes=true;currentEmote=apijs.config.bbcode[data[value]];data[value]='[img src="'+currentEmote.src+'" width="'+currentEmote.width+'" height="'+currentEmote.height+'" alt="'+data[value]+'" class="emote"]';}
else if(apijs.config.bbcode.hasOwnProperty(data[value].slice(0,-1))){hasEmotes=true;currentEmote=apijs.config.bbcode[data[value].slice(0,-1)];data[value]='[img src="'+currentEmote.src+'" width="'+currentEmote.width+'" height="'+currentEmote.height+'" alt="'+data[value].slice(0,-1)+'" class="emote"]'+data[value].slice(-1);}}}
data=data.join(' ');if(hasEmotes)
this.readData(data,level);else if(directlink.hasOwnProperty('content'))
directlink.content.push({text:data});else
directlink.content=[{text:data}];}
else{if(directlink.hasOwnProperty('content'))
directlink.content.push({text:data});else
directlink.content=[{text:data}];}}};this.getContentNode=function(dom,level,maxlevel){if((dom.content.length<1)||(maxlevel<1))
return dom;var i=dom.content.length-1;if(dom.content[i].hasOwnProperty('content')&&(++level<maxlevel))
return this.getContentNode(dom.content[i],level,maxlevel);return dom.content[i];};this.createDomFragment=function(data){var tag=null,attr=null,elem=0;if(data.hasOwnProperty('tag'))
tag=document.createElement(data.tag);else
return document.createTextNode(data.text);for(attr in data)if(data.hasOwnProperty(attr)){if(attr==='text')
tag.appendChild(document.createTextNode(data[attr]));if((attr!=='tag')&&(attr!=='text')&&(attr!=='content'))
tag.setAttribute(attr,data[attr]);if((data.tag==='a')&&(attr==='class')&&(data[attr].indexOf('popup')>-1)){if(apijs.config.navigator)
tag.addEventListener('click',openTab,false);else
tag.setAttribute('onclick','window.open(this.href); return false;');}}
if(data.hasOwnProperty('content')){for(elem=0;elem<data.content.length;elem++)
tag.appendChild(this.createDomFragment(data.content[elem]));}
return tag;};};
apijs.core.dialog=function(){this.classNames=null;this.image=null;this.timer=null;this.timerbis=null;this.callback=null;this.callbackParams=null;this.fragment=null;this.elemA=null;this.elemB=null;this.elemC=null;this.elemD=null;this.dialogInformation=function(title,text,icon){if((typeof title==='string')&&(typeof text==='string')){this.setupDialog('information',icon);this.htmlParent(false);this.htmlTitle(title);this.htmlText(text);this.htmlButtonOk();this.showDialog();document.getElementById('box').lastChild.firstChild.focus();}
else if(apijs.config.debug){this.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheDialog » dialogInformation[br]➩ (string) title : '+title+'[br]➩ (string) text : '+text+'[br]➩ (string) icon : '+icon+'[/pre]');}};this.dialogConfirmation=function(title,text,callback,callbackParams,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof callback==='function')){this.setupDialog('confirmation',icon);this.htmlParent(false);this.htmlTitle(title);this.htmlText(text);this.htmlButtonConfirm('button');this.callback=callback;this.callbackParams=callbackParams;this.showDialog();document.getElementById('box').lastChild.firstChild.focus();}
else if(apijs.config.debug){if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))
callback=callback.name;this.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheDialog » dialogConfirmation[br]➩ (string) title : '+title+'[br]➩ (string) text : '+text+'[br]➩ (function) callback : '+callback+'[br]➩ (mixed) callbackParams : '+callbackParams+'[br]➩ (string) icon : '+icon+'[/pre]');}};this.dialogFormOptions=function(title,text,action,callback,callbackParams,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof action==='string')&&(typeof callback==='function')){this.setupDialog('options',icon);this.htmlFormParent(action);this.htmlTitle(title);this.htmlText(text);this.htmlButtonConfirm('submit');this.callback=callback;this.callbackParams=callbackParams;this.showDialog();}
else if(apijs.config.debug){if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))
callback=callback.name;this.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheDialog » dialogFormOptions[br]➩ (string) title : '+title+'[br]➩ (string) text : '+text+'[br]➩ (string) action : '+action+'[br]➩ (function) callback : '+callback+'[br]➩ (mixed) callbackParams : '+callbackParams+'[br]➩ (string) icon : '+icon+'[/pre]');}};this.dialogFormUpload=function(title,text,inputname,uploadkey,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof uploadkey==='string')&&(typeof inputname==='string')){this.setupDialog('upload',icon);this.htmlFormParent(apijs.config.dialog.fileUpload,'multipart/form-data','iframeUpload.'+uploadkey);this.htmlTitle(title);this.htmlText(text);this.htmlFormUpload(inputname,uploadkey);this.htmlButtonConfirm('submit');this.showDialog();window.setTimeout(function(){document.getElementById('box').getElementsByTagName('input')[1].focus();},10);}
else if(apijs.config.debug){this.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheDialog » dialogFormUpload[br]➩ (string) title : '+title+'[br]➩ (string) text : '+text+'[br]➩ (string) inputname : '+inputname+'[br]➩ (string) uploadkey : '+uploadkey+'[br]➩ (string) icon : '+icon+'[/pre]');}};this.dialogProgress=function(title,text,icon){if((typeof title==='string')&&(typeof text==='string')){this.setupDialog('progress',icon);this.htmlParent(false);this.htmlTitle(title);this.htmlText(text);this.htmlProgressBar();this.showDialog();}
else if(apijs.config.debug){this.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheDialog » dialogProgress[br]➩ (string) title : '+title+'[br]➩ (string) text : '+text+'[br]➩ (string) icon : '+icon+'[/pre]');}};this.dialogWaiting=function(title,text,time,nolink,icon){if((typeof title==='string')&&(typeof text==='string')){this.setupDialog('waiting',icon);this.htmlParent(false);this.htmlTitle(title);this.htmlText(text);this.showDialog();if(nolink!==false)
this.timer=window.setTimeout(apijs.dialog.htmlLinkReload.bind(this),(typeof time==='number')?time:10000);}
else if(apijs.config.debug){this.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheDialog » dialogWaiting[br]➩ (string) title : '+title+'[br]➩ (string) text : '+text+'[br]➩ (number) time : '+time+'[br]➩ (boolean) nolink : '+nolink+'[br]➩ (string) icon : '+icon+'[/pre]');}};this.dialogPhoto=function(width,height,url,name,date,legend,slideshow){if((typeof width==='number')&&(typeof height==='number')&&(typeof url==='string')&&(typeof name==='string')&&(typeof date==='string')&&(typeof legend==='string')){if((typeof slideshow==='string')&&(slideshow.length>0)){this.setupDialog('photo slideshow');this.htmlParent(slideshow);}
else{this.setupDialog('photo');this.htmlParent(false);}
this.htmlPhoto(width,height,url,name,date,legend);this.htmlButtonClose();this.htmlButtonNavigation();this.showDialog();this.loadImage(width,height,url);}
else if(apijs.config.debug){this.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheDialog » dialogPhoto[br]➩ (number) width : '+width+'[br]➩ (number) height : '+height+'[br]➩ (string) url : '+url+'[br]➩ (string) name : '+name+'[br]➩ (string) date : '+date+'[br]➩ (string) legend : '+legend+'[/pre]');}};this.dialogVideo=function(url,name,date,legend,slideshow){if((typeof url==='string')&&(typeof name==='string')&&(typeof legend==='string')&&(typeof legend==='string')){if((typeof slideshow==='string')&&(slideshow.length>0)){this.setupDialog('video slideshow');this.htmlParent(slideshow);}
else{this.setupDialog('video');this.htmlParent(false);}
this.htmlVideo(url,name,date,legend);this.htmlButtonClose();this.htmlButtonNavigation();this.showDialog();}
else if(apijs.config.debug){this.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheDialog » dialogVideo[br]➩ (string) url : '+url+'[br]➩ (string) name : '+name+'[br]➩ (string) date : '+date+'[br]➩ (string) legend : '+legend+'[/pre]');}};this.actionClose=function(all){if(all){apijs.dialog.deleteDialog(true);apijs.dialog.showPage();}
else{apijs.dialog.deleteDialog(false);}};this.actionCloseOnClic=function(ev){var classNames=apijs.dialog.classNames.split(' ');if((ev.target.getAttribute('id')==='dialog')&&!in_array(['waiting','progress','lock'],classNames)){apijs.dialog.deleteDialog(true);apijs.dialog.showPage();}};this.actionConfirm=function(){var result=false;if(this.classNames.indexOf('confirmation')>-1){this.classNames+=' lock';if(!apijs.config.dialog.savingDialog){this.elemA=document.createElement('p');this.elemA.setAttribute('class','saving');this.elemA.appendChild(document.createTextNode(apijs.i18n.translate('operationInProgress')));document.getElementById('box').removeChild(document.getElementById('box').lastChild);document.getElementById('box').lastChild.setAttribute('class','novisible');document.getElementById('box').appendChild(this.elemA);this.timer=window.setTimeout(apijs.dialog.htmlLinkReload.bind(this),10000);}
else{this.dialogWaiting(document.getElementById('box').querySelector('h1').firstChild.nodeValue,apijs.i18n.translate('operationInProgress'),true,true,this.classNames.replace('confirmation','').replace('lock',''));}
if(apijs.config.dialog.savingTime>500){this.timerbis=window.setTimeout(function(){if(typeof this.callback==='function'){this.classNames=this.classNames.replace('lock','');this.callback(this.callbackParams);}}.bind(this),apijs.config.dialog.savingTime);}
else{this.classNames=this.classNames.replace('lock','');this.callback(this.callbackParams);}
result=true;}
else if(this.classNames.indexOf('options')>-1){if(this.callback(this.clone(this.callbackParams))===true){this.classNames+=' lock';this.elemA=document.createElement('p');this.elemA.setAttribute('class','saving');this.elemA.appendChild(document.createTextNode(apijs.i18n.translate('operationInProgress')));document.getElementById('box').removeChild(document.getElementById('box').lastChild);document.getElementById('box').lastChild.setAttribute('class','novisible');document.getElementById('box').appendChild(this.elemA);this.timer=window.setTimeout(apijs.dialog.htmlLinkReload.bind(this),10000);if(apijs.config.dialog.savingTime>500){this.timerbis=window.setTimeout(function(){if(document.getElementById('box')&&(document.getElementById('box').nodeName.toLowerCase()==='form')){this.classNames=this.classNames.replace('lock','');document.getElementById('box').submit();}}.bind(this),apijs.config.dialog.savingTime);}
else{result=true;}}}
else if(this.classNames.indexOf('upload')>-1){if(typeof apijs.core.upload==='function'){if((apijs.upload.extensions instanceof Array)&&(apijs.upload.actionConfirm()===true)){this.classNames+=' lock';result=true;}
else if(!(apijs.upload.extensions instanceof Array)&&apijs.config.debug){this.dialogInformation(apijs.i18n.translate('debugInvalidUse'),'[pre]TheDialog » actionConfirm[br]➩ '+apijs.i18n.translate('debugBadUse')+'[/pre]');}}
else if(apijs.config.debug){this.dialogInformation(apijs.i18n.translate('debugInvalidUse'),'[pre]TheDialog » actionConfirm[br]➩ TheUpload '+apijs.i18n.translate('debugNotExist')+'[/pre]');}}
return result;};this.actionKey=function(ev){var classNames=apijs.dialog.classNames.split(' ');if(apijs.config.debugkey){ev.preventDefault();apijs.dialog.dialogInformation(apijs.i18n.translate('debugKeyDetected'),'[pre]TheDialog » actionKey[br]'+apijs.i18n.translate('debugKeyCode',ev.keyCode)+'[/pre]');}
else if(in_array('slideshow',classNames)){if(ev.keyCode===27){ev.preventDefault();apijs.dialog.actionClose(true);}
else if(ev.keyCode===35){ev.preventDefault();apijs.slideshow.actionLast();}
else if(ev.keyCode===36){ev.preventDefault();apijs.slideshow.actionFirst();}
else if(ev.keyCode===37){ev.preventDefault();apijs.slideshow.actionPrev();}
else if(ev.keyCode===39){ev.preventDefault();apijs.slideshow.actionNext();}}
else if(in_array(['waiting','progress','lock'],classNames)){if((ev.ctrlKey&&((ev.keyCode===81)||(ev.keyCode===87)||(ev.keyCode===82)||(ev.keyCode===115)||(ev.keyCode===116)))||(ev.altKey&&(ev.keyCode===115))||(ev.keyCode===27)||(ev.keyCode===116))
ev.preventDefault();}
else if(ev.keyCode===27){ev.preventDefault();apijs.dialog.actionClose(true);}};this.actionCloseBrowser=function(ev){var classNames=apijs.dialog.classNames.split(' ');if(apijs.config.debugkey){ev.preventDefault();apijs.dialog.dialogInformation(apijs.i18n.translate('debugKeyDetected'),'[pre]TheDialog » actionCloseBrowser[br]'+apijs.i18n.translate('debugKeyCode',ev.keyCode)+'[/pre]');}
if(in_array(['waiting','progress','lock'],classNames)){ev.preventDefault();ev.stopPropagation();return'';}};this.setupDialog=function(type,icon){if(this.classNames!==null){this.deleteDialog(false);}
if(apijs.config.navigator){document.addEventListener('keydown',apijs.dialog.actionKey,true);window.addEventListener('beforeunload',apijs.dialog.actionCloseBrowser,true);this.restrictNavigation(true);}
this.classNames=(typeof icon==='string')?(type+' '+icon):type;this.fragment=document.createDocumentFragment();};this.showDialog=function(){var classNames=this.classNames.split(' ');if(document.getElementById('dialog')){this.fragment.firstChild.setAttribute('class',this.fragment.firstChild.getAttribute('class').replace('init','actif'));document.getElementById('dialog').appendChild(this.fragment.firstChild.firstChild);}
else if(!apijs.config.transition||in_array('notransition',classNames)){this.fragment.firstChild.setAttribute('class',this.fragment.firstChild.getAttribute('class').replace('init','actif'));document.body.appendChild(this.fragment);}
else{document.body.appendChild(this.fragment);window.setTimeout(function(){document.getElementById('dialog').setAttribute('class',document.getElementById('dialog').getAttribute('class').replace('init','actif'));},1);}
if(apijs.config.navigator&&apijs.config.dialog.closeOnClic&&!in_array(['waiting','progress','lock'],classNames))
document.addEventListener('click',apijs.dialog.actionCloseOnClic,false);};this.deleteDialog=function(total){var classNames=this.classNames.split(' '),video=null;if(this.timer)
clearTimeout(this.timer);if(apijs.config.navigator){document.removeEventListener('keydown',apijs.dialog.actionKey,true);window.removeEventListener('beforeunload',apijs.dialog.actionCloseBrowser,true);this.restrictNavigation(false);video=document.getElementById('dialog').querySelector('video');if(video&&(typeof video.pause==='function'))
video.pause();}
if(apijs.config.navigator&&apijs.config.dialog.closeOnClic&&!in_array(['waiting','progress','lock'],classNames))
document.removeEventListener('click',apijs.dialog.actionCloseOnClic,false);if(total&&(!apijs.config.transition||in_array('notransition',classNames))){document.getElementById('dialog').parentNode.removeChild(document.getElementById('dialog'));}
else if(total){document.getElementById('dialog').setAttribute('class',document.getElementById('dialog').getAttribute('class').replace('actif','deleting'));if((typeof document.getElementById('dialog').style.transitionDuration==='string')||(typeof document.getElementById('dialog').style.MozTransitionDuration==='string')){document.getElementById('dialog').addEventListener('transitionend',function(){if(document.getElementById('dialog'))
document.getElementById('dialog').parentNode.removeChild(document.getElementById('dialog'));},false);}
else if(typeof document.getElementById('dialog').style.OTransitionDuration==='string'){document.getElementById('dialog').addEventListener('OTransitionEnd',function(){if(document.getElementById('dialog'))
document.getElementById('dialog').parentNode.removeChild(document.getElementById('dialog'));},false);}
else if(typeof document.getElementById('dialog').style.webkitTransitionDuration==='string'){document.getElementById('dialog').addEventListener('webkitTransitionEnd',function(){if(document.getElementById('dialog'))
document.getElementById('dialog').parentNode.removeChild(document.getElementById('dialog'));},false);}}
else{document.getElementById('box').parentNode.removeChild(document.getElementById('box'));}
this.classNames=null;this.image=null;this.timer=null;this.fragment=null;this.elemA=null;this.elemB=null;this.elemC=null;this.elemD=null;};this.showPage=function(){if(document.getElementById('iframeUpload'))
document.getElementById('iframeUpload').parentNode.removeChild(document.getElementById('iframeUpload'));if(this.timerbis)
clearTimeout(this.timerbis);this.timerbis=null;this.callback=null;this.callbackParams=null;};this.restrictNavigation=function(lock){var tags='a,area,button,input,object,select,textarea,iframe,div',elems=null,elem=0;if(lock){elems=document.querySelectorAll(tags);for(elem=0;elem<elems.length;elem++)
elems[elem].setAttribute('tabindex','-1');}
else{elems=document.querySelectorAll(tags);for(elem=0;elem<elems.length;elem++)
elems[elem].removeAttribute('tabindex');}};this.checkWindowSize=function(width,height){if((width>=(window.innerWidth-window.innerWidth*apijs.config.dialog.margin/100))||(height>=(window.innerHeight-window.innerHeight*apijs.config.dialog.margin/100)))
return true;else
return false;};this.updateWindowSize=function(width,height,url){var infoMedia=null,infoWindow=null,mimeTypes=null;infoMedia={width:width,height:height,id:url.slice((url.lastIndexOf('/')+1),url.lastIndexOf('.')),mime:null};infoWindow={width:window.innerWidth,height:window.innerHeight};mimeTypes={ogv:'video/ogg',webm:'video/webm',jpg:'image/jpeg',jpeg:'image/jpeg',png:'image/png',gif:'image/gif',svg:'image/svg+xml'};infoMedia.mime=url.slice(url.lastIndexOf('.')+1);if(mimeTypes.hasOwnProperty(infoMedia.mime))
infoMedia.mime=mimeTypes[infoMedia.mime];if(this.checkWindowSize(width,height)){infoWindow.width-=window.innerWidth*apijs.config.dialog.margin/100;infoWindow.height-=window.innerHeight*apijs.config.dialog.margin/100;if(infoMedia.width>infoWindow.width){infoMedia.height=Math.floor(infoMedia.height*(infoWindow.width/infoMedia.width));infoMedia.width=infoWindow.width;if(infoMedia.height>infoWindow.height){infoMedia.width=Math.floor(infoMedia.width*(infoWindow.height/infoMedia.height));infoMedia.height=infoWindow.height;}}
else if(infoMedia.height>infoWindow.height){infoMedia.width=Math.floor(infoMedia.width*(infoWindow.height/infoMedia.height));infoMedia.height=infoWindow.height;if(infoMedia.width>infoWindow.width){infoMedia.height=Math.floor(infoMedia.height*(infoWindow.width/infoMedia.width));infoMedia.width=infoWindow.width;}}}
this.fragment.firstChild.firstChild.style.width=infoMedia.width+'px';this.fragment.firstChild.firstChild.style.marginLeft=parseInt(-(infoMedia.width+20)/2,10)+'px';this.fragment.firstChild.firstChild.style.marginTop=parseInt(-(infoMedia.height+65)/2,10)+'px';return infoMedia;};this.loadImage=function(width,height,url){if(apijs.config.navigator&&apijs.config.dialog.showLoader){this.image=new Image(width,height);this.image.src=url;this.image.addEventListener('load',function(){if(document.getElementById('topho')){document.getElementById('topho').removeAttribute('class');document.getElementById('topho').setAttribute('src',this.image.src);}}.bind(this),false);this.image.addEventListener('error',function(){if(document.getElementById('topho')){if(document.getElementById('topho').getAttribute('class').indexOf('resized')>-1){var img=document.getElementById('topho').cloneNode(true);document.getElementById('topho').parentNode.parentNode.removeChild(document.getElementById('topho').parentNode);document.getElementById('box').firstChild.firstChild.appendChild(img);}
if(apijs.config.dialog.savePhoto)
document.getElementById('box').firstChild.lastChild.removeChild(document.getElementById('box').firstChild.lastChild.lastChild);document.getElementById('topho').setAttribute('class','error_'+apijs.config.lang);}}.bind(this),false);}
else{document.getElementById('topho').removeAttribute('class');document.getElementById('topho').setAttribute('src',url);}};this.clone=function(data){if((typeof data!=='object')||(data===null))
return data;var value=null,object=new data.constructor();for(value in data)if(data.hasOwnProperty(value))
object[value]=apijs.dialog.clone(data[value]);return object;};this.htmlParent=function(slideshow){this.elemA=document.createElement('div');this.elemA.setAttribute('class',(typeof slideshow==='string')?('init '+slideshow):'init');this.elemA.setAttribute('id','dialog');this.elemB=document.createElement('div');this.elemB.setAttribute('class',this.classNames);this.elemB.setAttribute('id','box');this.elemA.appendChild(this.elemB);this.fragment.appendChild(this.elemA);};this.htmlFormParent=function(action,enctype,target){this.elemA=document.createElement('div');this.elemA.setAttribute('class','init');this.elemA.setAttribute('id','dialog');this.elemB=document.createElement('form');this.elemB.setAttribute('action',action);this.elemB.setAttribute('method','post');if(typeof enctype==='string')
this.elemB.setAttribute('enctype',enctype);if(typeof target==='string')
this.elemB.setAttribute('target',target);this.elemB.setAttribute('onsubmit','return apijs.dialog.actionConfirm();');this.elemB.setAttribute('class',this.classNames);this.elemB.setAttribute('id','box');this.elemA.appendChild(this.elemB);this.fragment.appendChild(this.elemA);};this.htmlTitle=function(title){this.elemA=document.createElement('h1');this.elemA.appendChild(document.createTextNode(title));this.fragment.firstChild.firstChild.appendChild(this.elemA);};this.htmlText=function(data){var bbcode=new apijs.core.bbcode();bbcode.init(data,apijs.config.dialog.emotes);bbcode.exec();this.fragment.firstChild.firstChild.appendChild(bbcode.getFragment());};this.htmlButtonOk=function(){this.elemA=document.createElement('div');this.elemA.setAttribute('class','control');this.elemB=document.createElement('button');this.elemB.setAttribute('type','button');this.elemB.setAttribute('onclick','apijs.dialog.actionClose(true);');this.elemB.setAttribute('class','confirm');this.elemB.appendChild(document.createTextNode(apijs.i18n.translate('buttonOk')));this.elemA.appendChild(this.elemB);this.fragment.firstChild.firstChild.appendChild(this.elemA);};this.htmlButtonConfirm=function(type){this.elemA=document.createElement('div');this.elemA.setAttribute('class','control');this.elemB=document.createElement('button');this.elemB.setAttribute('type',type);this.elemB.setAttribute('class','confirm');if(type!=='submit')
this.elemB.setAttribute('onclick','apijs.dialog.actionConfirm();');this.elemB.appendChild(document.createTextNode(apijs.i18n.translate('buttonConfirm')));this.elemA.appendChild(this.elemB);this.elemB=document.createElement('button');this.elemB.setAttribute('type','button');this.elemB.setAttribute('class','cancel');this.elemB.setAttribute('onclick','apijs.dialog.actionClose(true);');this.elemB.appendChild(document.createTextNode(apijs.i18n.translate('buttonCancel')));this.elemA.appendChild(this.elemB);this.fragment.firstChild.firstChild.appendChild(this.elemA);};this.htmlButtonNavigation=function(){var txtimg=((apijs.config.dialog.imagePrev===null)||(apijs.config.dialog.imageNext===null))?true:false;this.elemA=document.createElement('div');this.elemA.setAttribute('class',(txtimg)?'navigation txt':'navigation img');this.elemB=document.createElement('button');this.elemB.setAttribute('type','button');this.elemB.setAttribute('disabled','disabled');this.elemB.setAttribute('onclick','apijs.slideshow.actionPrev();');this.elemB.setAttribute('id','prev');if(txtimg){this.elemB.appendChild(document.createTextNode(apijs.i18n.translate('buttonPrev')));}
else{this.elemC=document.createElement('img');this.elemC.setAttribute('src',apijs.config.dialog.imagePrev.src);this.elemC.setAttribute('width',apijs.config.dialog.imagePrev.width);this.elemC.setAttribute('height',apijs.config.dialog.imagePrev.height);this.elemC.setAttribute('alt',apijs.i18n.translate('buttonPrev'));this.elemB.appendChild(this.elemC);}
this.elemA.appendChild(this.elemB);this.elemB=document.createElement('button');this.elemB.setAttribute('type','button');this.elemB.setAttribute('disabled','disabled');this.elemB.setAttribute('onclick','apijs.slideshow.actionNext();');this.elemB.setAttribute('id','next');if(txtimg){this.elemB.appendChild(document.createTextNode(apijs.i18n.translate('buttonNext')));}
else{this.elemC=document.createElement('img');this.elemC.setAttribute('src',apijs.config.dialog.imageNext.src);this.elemC.setAttribute('width',apijs.config.dialog.imageNext.width);this.elemC.setAttribute('height',apijs.config.dialog.imageNext.height);this.elemC.setAttribute('alt',apijs.i18n.translate('buttonNext'));this.elemB.appendChild(this.elemC);}
this.elemA.appendChild(this.elemB);this.fragment.firstChild.firstChild.appendChild(this.elemA);};this.htmlButtonClose=function(){var txtimg=(apijs.config.dialog.imageClose===null)?true:false;this.elemA=document.createElement('div');this.elemA.setAttribute('class',(txtimg)?'close txt':'close img');this.elemB=document.createElement('button');this.elemB.setAttribute('type','button');this.elemB.setAttribute('onclick','apijs.dialog.actionClose(true);');this.elemB.setAttribute('class','close');if(txtimg){this.elemB.appendChild(document.createTextNode(apijs.i18n.translate('buttonClose')));}
else{this.elemC=document.createElement('img');this.elemC.setAttribute('src',apijs.config.dialog.imageClose.src);this.elemC.setAttribute('width',apijs.config.dialog.imageClose.width);this.elemC.setAttribute('height',apijs.config.dialog.imageClose.height);this.elemC.setAttribute('alt',apijs.i18n.translate('buttonClose'));this.elemB.appendChild(this.elemC);}
this.elemA.appendChild(this.elemB);this.fragment.firstChild.firstChild.appendChild(this.elemA);};this.htmlLinkReload=function(){this.elemA=document.createElement('p');this.elemA.setAttribute('class','reload');this.elemA.appendChild(document.createTextNode(apijs.i18n.translate('operationTooLong')));this.elemB=document.createElement('a');this.elemB.setAttribute('href',location.href);this.elemB.appendChild(document.createTextNode(apijs.i18n.translate('reloadLink')));this.elemA.appendChild(this.elemB);this.elemA.appendChild(document.createTextNode('.'));this.elemB=document.createElement('br');this.elemA.appendChild(this.elemB);this.elemA.appendChild(document.createTextNode(apijs.i18n.translate('warningLostChange')));document.getElementById('box').appendChild(this.elemA);};this.htmlFormUpload=function(inputname,uploadkey){this.elemA=document.createElement('iframe');if(apijs.config.navigator)
this.elemA.setAttribute('src',apijs.config.dialog.imageUpload.src);this.elemA.setAttribute('name','iframeUpload.'+uploadkey);this.elemA.setAttribute('style','display:none;');this.elemA.setAttribute('id','iframeUpload');document.body.appendChild(this.elemA);this.elemA=document.createElement('div');this.elemB=document.createElement('input');this.elemB.setAttribute('type','hidden');this.elemB.setAttribute('name','UPLOAD_PROGRESS');this.elemB.setAttribute('value',uploadkey);this.elemA.appendChild(this.elemB);this.elemB=document.createElement('input');this.elemB.setAttribute('type','file');this.elemB.setAttribute('name',inputname);this.elemB.setAttribute('onchange',"document.getElementById('box').lastChild.firstChild.focus();");this.elemA.appendChild(this.elemB);this.fragment.firstChild.firstChild.appendChild(this.elemA);};this.htmlProgressBar=function(){if(apijs.config.navigator){this.elemA=document.createElement('object');this.elemA.setAttribute('data',apijs.config.dialog.imageUpload.src);this.elemA.setAttribute('type','image/svg+xml');this.elemA.setAttribute('width',apijs.config.dialog.imageUpload.width);this.elemA.setAttribute('height',apijs.config.dialog.imageUpload.height);this.elemA.setAttribute('id','progressbar');this.fragment.firstChild.firstChild.appendChild(this.elemA);}
else if(!apijs.config.navigator){this.elemA=document.createElement('embed');this.elemA.setAttribute('src',apijs.config.dialog.imageUpload.src);this.elemA.setAttribute('type','image/svg+xml');this.elemA.setAttribute('wmode','transparent');this.elemA.setAttribute('width',apijs.config.dialog.imageUpload.width);this.elemA.setAttribute('height',apijs.config.dialog.imageUpload.height);this.elemA.setAttribute('id','progressbar');this.fragment.firstChild.firstChild.appendChild(this.elemA);}};this.htmlPhoto=function(width,height,url,name,date,legend){var infoPhoto=this.updateWindowSize(width,height,url);this.elemA=document.createElement('dl');this.elemB=document.createElement('dt');if(apijs.config.dialog.showFullsize&&this.checkWindowSize(width,height)){this.elemC=document.createElement('a');this.elemC.setAttribute('href',url);this.elemC.setAttribute('onclick','window.open(this.href); this.blur(); return false;');this.elemD=document.createElement('img');this.elemD.setAttribute('width',infoPhoto.width);this.elemD.setAttribute('height',infoPhoto.height);this.elemD.setAttribute('alt','');this.elemD.setAttribute('class','loading resized');this.elemD.setAttribute('id','topho');this.elemC.appendChild(this.elemD);this.elemC.appendChild(document.createElement('span'));}
else{this.elemC=document.createElement('img');this.elemC.setAttribute('width',infoPhoto.width);this.elemC.setAttribute('height',infoPhoto.height);this.elemC.setAttribute('alt','');this.elemC.setAttribute('class','loading');this.elemC.setAttribute('id','topho');}
this.elemB.appendChild(this.elemC);this.elemA.appendChild(this.elemB);this.elemB=document.createElement('dd');if((name!=='false')||(date!=='false')){this.elemC=document.createElement('span');if((name!=='false')&&(name!=='auto')&&(date!=='false'))
this.elemC.appendChild(document.createTextNode(name+' ('+date+')'));else if((name!=='false')&&(name!=='auto'))
this.elemC.appendChild(document.createTextNode(name));else if((name==='auto')&&(date!=='false'))
this.elemC.appendChild(document.createTextNode(infoPhoto.id+' ('+date+')'));else if(name==='auto')
this.elemC.appendChild(document.createTextNode(infoPhoto.id));else if(date!=='false')
this.elemC.appendChild(document.createTextNode('('+date+')'));this.elemB.appendChild(this.elemC);}
this.elemB.appendChild(document.createTextNode(' '+legend+' '));if(apijs.config.dialog.savePhoto){this.elemC=document.createElement('a');this.elemC.setAttribute('href',apijs.config.dialog.filePhoto+'?id='+infoPhoto.id);this.elemC.setAttribute('type',infoPhoto.mime);this.elemC.setAttribute('class','download');this.elemC.appendChild(document.createTextNode(apijs.i18n.translate('downloadLink')));this.elemB.appendChild(this.elemC);}
this.elemA.appendChild(this.elemB);this.fragment.firstChild.firstChild.appendChild(this.elemA);};this.htmlVideo=function(url,name,date,legend){var nav=BrowserDetect,noVideo=null,infoVideo=this.updateWindowSize(apijs.config.dialog.videoWidth,apijs.config.dialog.videoHeight,url);this.elemA=document.createElement('dl');this.elemB=document.createElement('dt');this.elemC=document.createElement('video');this.elemC.setAttribute('src',url);this.elemC.setAttribute('width',infoVideo.width);this.elemC.setAttribute('height',infoVideo.height);this.elemC.setAttribute('controls','controls');if(apijs.config.dialog.videoAutoplay)
this.elemC.setAttribute('autoplay','autoplay');if(typeof this.elemC.pause!=='function'){noVideo=new apijs.core.bbcode();noVideo.init(apijs.i18n.translate('browserNoVideo',nav.browser,nav.version,infoVideo.mime,navigator.userAgent));noVideo.exec();this.elemC.appendChild(noVideo.getFragment());this.elemC.style.width=infoVideo.width;this.elemC.style.height=infoVideo.height;}
if(BrowserDetect.browser==='Safari'){this.elemC.setAttribute('style','height:'+infoVideo.height+'px');}
this.elemB.appendChild(this.elemC);this.elemA.appendChild(this.elemB);this.elemB=document.createElement('dd');if((name!=='false')||(date!=='false')){this.elemC=document.createElement('span');if((name!=='false')&&(name!=='auto')&&(date!=='false'))
this.elemC.appendChild(document.createTextNode(name+' ('+date+')'));else if((name!=='false')&&(name!=='auto'))
this.elemC.appendChild(document.createTextNode(name));else if((name==='auto')&&(date!=='false'))
this.elemC.appendChild(document.createTextNode(infoVideo.id+' ('+date+')'));else if(name==='auto')
this.elemC.appendChild(document.createTextNode(infoVideo.id));else if(date!=='false')
this.elemC.appendChild(document.createTextNode('('+date+')'));this.elemB.appendChild(this.elemC);}
this.elemB.appendChild(document.createTextNode(' '+legend+' '));if(apijs.config.dialog.saveVideo){this.elemC=document.createElement('a');this.elemC.setAttribute('href',apijs.config.dialog.fileVideo+'?id='+infoVideo.id);this.elemC.setAttribute('type',infoVideo.mime);this.elemC.setAttribute('class','download');this.elemC.appendChild(document.createTextNode(apijs.i18n.translate('downloadLink')));this.elemB.appendChild(this.elemC);}
this.elemA.appendChild(this.elemB);this.fragment.firstChild.firstChild.appendChild(this.elemA);};};
apijs.core.slideshow=function(){this.currentMedia={album:null,number:null,first:null,prev:null,next:null,last:null};this.gallery=[];this.totals=[];this.init=function(){var i,j,id,hoverload=false;for(i=0;document.getElementById(apijs.config.slideshow.ids+'.'+i)!==null;i++){hoverload=(document.getElementById(apijs.config.slideshow.ids+'.'+i).getAttribute('class').indexOf('hoverload')>-1);id=apijs.config.slideshow.ids+'.'+i+'.999';if(document.getElementById(id)){if(apijs.config.navigator){document.getElementById(id).addEventListener('click',apijs.slideshow.showMedia.bind(this),false);}
else{document.getElementById(id).setAttribute('onclick',"apijs.slideshow.showMedia(this.getAttribute('id')); return false;");}
this.gallery[i]=0;}
else{this.gallery[i]=false;}
for(j=0;document.getElementById(apijs.config.slideshow.ids+'.'+i+'.'+j)!==null;j++){id=apijs.config.slideshow.ids+'.'+i+'.'+j;if(apijs.config.navigator){if(hoverload&&(this.gallery[i]!==false)){document.getElementById(id).addEventListener('click',apijs.slideshow.showMedia.bind(this),false);document.getElementById(id).addEventListener('mouseover',apijs.slideshow.showMedia.bind(this),false);}
else{document.getElementById(id).addEventListener('click',apijs.slideshow.showMedia.bind(this),false);}}
else{if(hoverload&&(this.gallery[i]!==false)){document.getElementById(id).setAttribute('onclick',"apijs.slideshow.showMedia(this.getAttribute('id')); return false;");document.getElementById(id).setAttribute('onmouseover',"apijs.slideshow.showMedia(this.getAttribute('id')); return false;");}
else{document.getElementById(id).setAttribute('onclick',"apijs.slideshow.showMedia(this.getAttribute('id')); return false;");}}
this.totals[i]=j;}}};this.showMedia=function(ev){var media={num:0,id:null,url:null,conf:null,name:null,date:null,legend:null,width:null,height:null,classNames:''},tmp=null;if(typeof ev!=='string'){ev.preventDefault();media.id=ev.target.parentNode.getAttribute('id');media.url=ev.target.parentNode.getAttribute('href');media.alt=ev.target.getAttribute('alt');media.conf=ev.target.parentNode.querySelector('input').getAttribute('value').split('|');media.classNames=document.getElementById(media.id.slice(0,media.id.lastIndexOf('.'))).getAttribute('class');tmp=media.id.split('.');media.album=parseInt(tmp[1],10);media.number=parseInt(tmp[2],10);}
else{media.id=ev;media.url=document.getElementById(media.id).getAttribute('href');media.alt=document.getElementById(media.id).querySelector('img').getAttribute('alt');media.conf=document.getElementById(media.id).querySelector('input').getAttribute('value').split('|');media.classNames=document.getElementById(media.id.slice(0,media.id.lastIndexOf('.'))).getAttribute('class');tmp=media.id.split('.');media.album=parseInt(tmp[1],10);media.number=parseInt(tmp[2],10);}
media.classNames=media.classNames.replace('gallery','slideshow').replace('album','slideshow');if((this.gallery[media.album]!==false)&&((media.conf.length>1)||(media.conf.length<7))){if((typeof ev!=='string')&&ev.target.hasAttribute('class')&&(ev.target.getAttribute('class').indexOf('actif')>-1))
return;if((apijs.dialog.classNames===null)&&((media.conf.length===6)||(media.conf.length===4))){this.updategallery(media);}
else if((apijs.dialog.classNames===null)&&((media.conf.length===5)||(media.conf.length===3))){media.number=this.gallery[media.album];this.showDialog(media);}
else{this.updategallery(media);this.showDialog(media);}}
else if((media.conf.length===5)||(media.conf.length===3))
this.showDialog(media);else if(apijs.config.debug)
apijs.dialog.dialogInformation(apijs.i18n.translate('debugInvalidUse'),'[pre]TheSlideshow » showMedia[br]'+apijs.i18n.translate('debugNotRecognizedConfig')+'[/pre]');};this.updategallery=function(media){var id=null,tag=null,i=0;if((media.conf.length===6)&&(media.conf[0].length>0)&&(media.conf[1].length>0)&&(media.conf[2].length>0)&&(media.conf[3].length>0)&&(media.conf[4].length>0)){id=apijs.config.slideshow.ids+'.'+media.album;document.getElementById(id+'.999').setAttribute('href',document.getElementById(media.id).getAttribute('href'));document.getElementById(id+'.999').querySelector('img').setAttribute('alt',media.alt);document.getElementById(id+'.999').querySelector('img').setAttribute('src',media.conf.shift());document.getElementById(id+'.999').querySelector('input').setAttribute('value',media.conf.join('|'));for(tag=document.getElementById(id).querySelectorAll('img'),i=0;i<tag.length;i++){if(tag[i].hasAttribute('class')&&(tag[i].getAttribute('class').indexOf('actif')>-1))
tag[i].removeAttribute('class');}
document.getElementById(media.id).querySelector('img').setAttribute('class','actif');this.gallery[media.album]=media.number;}
else if(apijs.config.debug&&(media.conf.length===6)){apijs.dialog.dialogInformation(apijs.i18n.translate('debugInvalidConfig'),'[pre]TheSlideshow » changePhoto[br]➩ (string) url : '+media.conf[0]+'[br]➩ (number) width : '+media.conf[1]+'[br]➩ (number) height : '+media.conf[2]+'[br]➩ (string) date : '+media.conf[3]+'[br]➩ (string) legend : '+media.conf[4]+'[/pre]');}
else if((media.conf.length===4)&&(media.conf[0].length>0)&&(media.conf[1].length>0)&&(media.conf[2].length>0)){id=apijs.config.slideshow.ids+'.'+media.album;document.getElementById(id+'.999').setAttribute('href',document.getElementById(media.id).getAttribute('href'));document.getElementById(id+'.999').querySelector('img').setAttribute('alt',media.alt);document.getElementById(id+'.999').querySelector('img').setAttribute('src',media.conf.shift());document.getElementById(id+'.999').querySelector('input').setAttribute('value',media.conf.join('|'));for(tag=document.getElementById(id).querySelectorAll('img'),i=0;i<tag.length;i++){if(tag[i].hasAttribute('class')&&(tag[i].getAttribute('class').indexOf('actif')>-1))
tag[i].removeAttribute('class');}
document.getElementById(media.id).querySelector('img').setAttribute('class','actif');this.gallery[media.album]=media.number;}
else if(apijs.config.debug&&(media.conf.length===4)){apijs.dialog.dialogInformation(apijs.i18n.translate('debugInvalidConfig'),'[pre]TheSlideshow » changePhoto[br]➩ (string) url : '+media.conf[0]+'[br]➩ (string) date : '+media.conf[1]+'[br]➩ (string) legend : '+media.conf[2]+'[/pre]');}};this.showDialog=function(media){if((media.conf.length===5)&&(media.conf[0].length>0)&&(media.conf[1].length>0)&&(media.conf[2].length>0)&&(media.conf[3].length>0)){media.name=media.conf[2];media.date=media.conf[3];media.legend=media.conf[4];media.width=parseInt(media.conf[0],10);media.height=parseInt(media.conf[1],10);apijs.dialog.dialogPhoto(media.width,media.height,media.url,media.name,media.date,media.legend,media.classNames);this.showNavigation(media.album,media.number);}
else if(apijs.config.debug&&(media.conf.length===5)){apijs.dialog.dialogInformation(apijs.i18n.translate('debugInvalidConfig'),'[pre]TheSlideshow » showMedia[br]➩ (number) width : '+media.conf[0]+'[br]➩ (number) height : '+media.conf[1]+'[br]➩ (string) date : '+media.conf[2]+'[br]➩ (string) legend : '+media.conf[3]+'[/pre]');}
else if((media.conf.length===3)&&(media.conf[0].length>0)&&(media.conf[1].length>0)){media.name=media.conf[0];media.date=media.conf[1];media.legend=media.conf[2];apijs.dialog.dialogVideo(media.url,media.name,media.date,media.legend,media.classNames);this.showNavigation(media.album,media.number);}
else if(apijs.config.debug&&(media.conf.length===3)){apijs.dialog.dialogInformation(apijs.i18n.translate('debugInvalidConfig'),'[pre]TheSlideshow » showMedia[br]➩ (string) date : '+media.conf[0]+'[br]➩ (string) legend : '+media.conf[1]+'[/pre]');}};this.showNavigation=function(album,number){if((apijs.dialog.classNames.indexOf('photo slideshow')>-1)||(apijs.dialog.classNames.indexOf('video slideshow')>-1)){this.currentMedia.album=album;this.currentMedia.number=number;this.currentMedia.first=apijs.config.slideshow.ids+'.'+this.currentMedia.album+'.0';this.currentMedia.prev=apijs.config.slideshow.ids+'.'+this.currentMedia.album+'.'+(this.currentMedia.number-1);this.currentMedia.next=apijs.config.slideshow.ids+'.'+this.currentMedia.album+'.'+(this.currentMedia.number+1);this.currentMedia.last=apijs.config.slideshow.ids+'.'+this.currentMedia.album+'.'+this.totals[this.currentMedia.album];if(document.getElementById(this.currentMedia.prev))
document.getElementById('prev').removeAttribute('disabled');else
this.currentMedia.prev=null;if(document.getElementById(this.currentMedia.next))
document.getElementById('next').removeAttribute('disabled');else
this.currentMedia.next=null;}};this.actionFirst=function(){if((this.currentMedia!==null)&&(this.currentMedia.number>0)&&(this.currentMedia.number<=this.totals[this.currentMedia.album]))
this.showMedia(this.currentMedia.first);};this.actionPrev=function(){if((this.currentMedia!==null)&&(this.currentMedia.prev!==null)&&(this.currentMedia.number>0))
this.showMedia(this.currentMedia.prev);};this.actionNext=function(){if((this.currentMedia!==null)&&(this.currentMedia.next!==null)&&(this.currentMedia.number<this.totals[this.currentMedia.album]))
this.showMedia(this.currentMedia.next);};this.actionLast=function(){if((this.currentMedia!==null)&&(this.currentMedia.number>=0)&&(this.currentMedia.number<this.totals[this.currentMedia.album]))
this.showMedia(this.currentMedia.last);};};
apijs.core.upload=function(){this.percent=0;this.extensions=null;this.uploadkey=null;this.callback=null;this.callbackParams=null;this.svgTimer=null;this.svgDirection=0;this.svgWaiting=0;this.progressTimer=null;this.progressWaiting=0;this.sendFile=function(title,inputname,maxsize,extensions,callback,callbackParams,icon){if((typeof title==='string')&&(typeof inputname==='string')&&(typeof maxsize==='number')&&(typeof extensions==='object')&&(extensions instanceof Array)&&(typeof callback==='function')){this.callback=callback;this.callbackParams=callbackParams;this.extensions=extensions;this.uploadkey=uniqid();apijs.dialog.dialogFormUpload(title,this.prepareText(maxsize),inputname,this.uploadkey,icon);}
else if(apijs.config.debug){if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))
callback=callback.name;apijs.dialog.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheUpload » sendFile[br]➩ (string) title : '+title+'[br]➩ (string) inputname : '+inputname+'[br]➩ (number) maxsize : '+maxsize+'[br]➩ (array) extensions : '+extensions+'[br]➩ (function) callback : '+callback+'[br]➩ (mixed) callbackParams : '+callbackParams+'[br]➩ (string) icon : '+icon+'[/pre]');}};this.deleteFile=function(title,text,fileid,callback,callbackParams,icon){if((typeof title==='string')&&(typeof text==='string')&&(typeof fileid==='string')&&(typeof callback==='function')){this.callback=callback;this.callbackParams=callbackParams;icon=(typeof icon!=='string')?'delete':icon;apijs.dialog.dialogConfirmation(title,text,apijs.upload.actionDelete,fileid,icon);}
else if(apijs.config.debug){if((typeof callback==='function')&&(typeof callback.name==='string')&&(callback.name.length>0))
callback=callback.name;apijs.dialog.dialogInformation(apijs.i18n.translate('debugInvalidCall'),'[pre]TheUpload » deleteFile[br]➩ (string) title : '+title+'[br]➩ (string) text : '+text+'[br]➩ (string) fileid : '+fileid+'[br]➩ (function) callback : '+callback+'[br]➩ (mixed) callbackParams : '+callbackParams+'[br]➩ (string) icon : '+icon+'[/pre]');}};this.prepareText=function(maxsize){var text=null,cloneExtensions=null,latestExtension=null;cloneExtensions=apijs.dialog.clone(this.extensions);latestExtension=cloneExtensions.pop();if(latestExtension==='*'){text=apijs.i18n.translate('uploadAllType',maxsize);}
else if(cloneExtensions.length<1){text=apijs.i18n.translate('uploadOneType',latestExtension,maxsize);}
else{cloneExtensions=cloneExtensions.join(', ');text=apijs.i18n.translate('uploadMultiType',cloneExtensions,latestExtension,maxsize);}
return text;};this.actionConfirm=function(){var filename=document.getElementById('box').getElementsByTagName('input')[1].value,result=false,cloneExtensions=null,latestExtension=null;cloneExtensions=apijs.dialog.clone(this.extensions);latestExtension=cloneExtensions.pop();if(filename.length<1){document.getElementById('box').getElementsByTagName('input')[1].focus();}
else if((latestExtension!=='*')&&!in_array(filename.slice(filename.lastIndexOf('.')+1).toLowerCase(),this.extensions)){if(filename.lastIndexOf('/')>0)
filename=filename.slice(filename.lastIndexOf('/')+1);else if(filename.lastIndexOf('\\')>0)
filename=filename.slice(filename.lastIndexOf('\\')+1);if(cloneExtensions.length<1){apijs.dialog.dialogInformation(document.getElementById('box').querySelector('h1').firstChild.nodeValue,apijs.i18n.translate('uploadBadOneType',filename,latestExtension),'eeupload');}
else{cloneExtensions=cloneExtensions.join(', ');apijs.dialog.dialogInformation(document.getElementById('box').querySelector('h1').firstChild.nodeValue,apijs.i18n.translate('uploadBadMultiType',filename,cloneExtensions,latestExtension),'eeupload');}}
else{result=true;document.getElementById('iframeUpload').setAttribute('onload','apijs.upload.endUpload();');this.percent=0;this.svgDirection=0;this.svgWaiting=10;this.progressWaiting=15;this.svgTimer=window.setInterval(apijs.upload.animGeneric.bind(this),50);this.progressTimer=window.setTimeout(apijs.upload.uploadRealTime,1000);window.setTimeout(function(){apijs.dialog.dialogProgress(document.getElementById('box').querySelector('h1').firstChild.nodeValue,apijs.i18n.translate('uploadInProgress'),apijs.dialog.classNames.replace('upload','').replace('lock',''));},1);}
return result;};this.actionDelete=function(fileid){var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if((xhr.readyState===4)&&(xhr.status===200)){try{var result=null,status=null,message=null,icon=null;result=xhr.responseXML;status=result.getElementsByTagName('status')[0].firstChild.nodeValue;message=result.getElementsByTagName('message')[0].firstChild.nodeValue;icon=(status==='success')?'information':'error';apijs.dialog.dialogInformation(document.getElementById('box').querySelector('h1').firstChild.nodeValue,message,icon);if(status==='success')
apijs.upload.callback(apijs.upload.callbackParams);}
catch(ee){apijs.dialog.dialogInformation(document.getElementById('box').querySelector('h1').firstChild.nodeValue,'[pre]'+ee+'[/pre]','error');}}
else if((xhr.readyState===4)&&(xhr.status!==200)){apijs.dialog.dialogInformation(document.getElementById('box').querySelector('h1').firstChild.nodeValue,apijs.i18n.translate('deleteNotFound',xhr.status,xhr.statusText),'error');}};xhr.open('GET',apijs.config.dialog.fileUpload+'?delete='+fileid,true);xhr.send(null);};this.uploadRealTime=function(){var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if((xhr.readyState===4)&&(xhr.status===200)&&(apijs.upload.progressWaiting>0)&&(apijs.upload.percent<100)){try{var result=null,status=null,percent=null,rate=null,time=null;result=xhr.responseXML;status=result.getElementsByTagName('status')[0].firstChild.nodeValue;if(status==='uploading'){percent=parseInt(result.getElementsByTagName('percent')[0].firstChild.nodeValue,10);rate=result.getElementsByTagName('rate')[0].firstChild.nodeValue;time=result.getElementsByTagName('time')[0].firstChild.nodeValue;if((percent>0)&&(percent<100)&&(percent>apijs.upload.percent)){if(apijs.upload.svgTimer)
clearInterval(apijs.upload.svgTimer);rate=((rate==='false')||(rate.length<1))?false:parseInt(rate,10);time=((time==='false')||(time.length<1))?false:time;apijs.upload.animToValue(percent,rate,time);}
apijs.upload.percent=percent;apijs.upload.progressTimer=window.setTimeout(apijs.upload.uploadRealTime,1000);}
else if(status==='pending'){apijs.upload.progressWaiting-=1;apijs.upload.progressTimer=window.setTimeout(apijs.upload.uploadRealTime,1000);}}
catch(ee){apijs.upload.progressWaiting-=1;apijs.upload.progressTimer=window.setTimeout(apijs.upload.uploadRealTime,1000);if(typeof console==='object')
console.log('apijs.upload.uploadRealTime: '+xhr.status+' '+xhr.statusText+' '+ee);}}
else if((xhr.readyState===4)&&(xhr.status!==200)&&(typeof console==='object')){console.log('apijs.upload.uploadRealTime: '+xhr.status+' '+xhr.statusText);}};xhr.open('GET',apijs.config.dialog.fileUpload+'?realtime='+apijs.upload.uploadkey,true);xhr.send(null);};this.endUpload=function(){if(this.progressTimer)
clearTimeout(this.progressTimer);if(this.svgTimer)
clearInterval(this.svgTimer);this.extensions=null;this.percent=100;this.svgTimer=null;this.svgDirection=0;this.svgWaiting=0;this.progressTimer=null;this.progressWaiting=0;var result=null,status=null,message=null;try{if(apijs.config.navigator){result=window.frames['iframeUpload.'+this.uploadkey].document;status=result.querySelector('status').firstChild.nodeValue;message=result.querySelector('message').firstChild.nodeValue;}
else{result=window.frames['iframeUpload.'+this.uploadkey].document.documentElement.querySelector('body').innerHTML;result=result.replace(/[\r\n\t]|<[^>]+>|&[a-z]+;/g,'');status=(/status(.+)\/status/i).test(result);status=RegExp.$1;message=(/message(.+)\/message/i).test(result);message=RegExp.$1;if(status.length<1)
throw'TypeError: status is undefined';}
if(apijs.config.navigator&&document.getElementById('progressbar')){document.getElementById('iframeUpload').removeAttribute('onload');document.getElementById('iframeUpload').setAttribute('src',apijs.config.dialog.imageUpload.src);}
if(status==='success'){this.animToValue(100);window.setTimeout(function(){this.callback(this.uploadkey,this.callbackParams);}.bind(this),1500);}
else{apijs.dialog.dialogInformation(document.getElementById('box').querySelector('h1').firstChild.nodeValue,message,'eeupload');}}
catch(ee){try{if(apijs.config.navigator){result=window.frames['iframeUpload.'+this.uploadkey].document;status=result.querySelector('title').firstChild.nodeValue;message=result.querySelector('p').firstChild.nodeValue;}
else{result=window.frames['iframeUpload.'+this.uploadkey].document.documentElement.innerHTML;status=(/<title>(.+)<\/title>/i).test(result);status=RegExp.$1;message=(/<p>(.+)<\/p>/i).test(result);message=RegExp.$1;}
apijs.dialog.dialogInformation(status,message,'eeupload');return;}
catch(ff){if(typeof console==='object')
console.log('apijs.upload.endUpload: '+ff);}
apijs.dialog.dialogInformation(document.getElementById('box').querySelector('h1').firstChild.nodeValue,'[pre]'+ee+'[/pre]','eeupload');}};this.animGeneric=function(){if((this.percent<100)&&document.getElementById('progressbar')){try{var rect=(apijs.config.navigator)?document.getElementById('progressbar').getSVGDocument().getElementById('bar'):document.getElementById('progressbar').getSVGDocument().rootElement.getElementById('bar');}
catch(ee){this.svgWaiting-=1;return;}
if(this.svgDirection===0){rect.setAttribute('x',parseFloat(rect.getAttribute('x'),10)+1+'%');if(parseInt(rect.getAttribute('x'),10)>=(100-parseFloat(rect.getAttribute('width'),10)))
this.svgDirection=1;}
else{rect.setAttribute('x',parseFloat(rect.getAttribute('x'),10)-1+'%');if(parseInt(rect.getAttribute('x'),10)<=0)
this.svgDirection=0;}}
else{this.svgWaiting=0;clearInterval(this.svgTimer);}};this.animToValue=function(percent,rate,time){try{var rect=null,text=null;rect=(apijs.config.navigator)?document.getElementById('progressbar').getSVGDocument().getElementById('bar'):document.getElementById('progressbar').getSVGDocument().rootElement.getElementById('bar');text=(apijs.config.navigator)?document.getElementById('progressbar').getSVGDocument().getElementById('text'):document.getElementById('progressbar').getSVGDocument().rootElement.getElementById('text');}
catch(ee){return;}
if(percent<100){if(rect.getAttribute('x')!=='0')
rect.setAttribute('x','0');rect.setAttribute('width',percent+'%');if((typeof rate==='number')&&(typeof time==='string'))
text.firstChild.replaceData(0,text.firstChild.length,apijs.i18n.translate('uploadRateTime',percent,rate,time));else if(typeof rate==='number')
text.firstChild.replaceData(0,text.firstChild.length,apijs.i18n.translate('uploadRate',percent,rate));else if(typeof time==='string')
text.firstChild.replaceData(0,text.firstChild.length,apijs.i18n.translate('uploadTime',percent,time));else
text.firstChild.replaceData(0,text.firstChild.length,percent+'%');}
else{rect.setAttribute('x','0');rect.setAttribute('width','101%');text.firstChild.replaceData(0,text.firstChild.length,'100%');}};};
/**
 * Copyright 2010 | Kevin van Zonneveld | http://phpjs.org/
 * This program is free software, you can redistribute it or modify
 * it under the terms of the MIT license.
 */
function str_shuffle(data){var result='',rand=0;while(data.length>0){rand=Math.floor(Math.random()*data.length);result+=data[rand];data=data.substring(0,rand)+data.substr(rand+1);}
return result;}
function in_array(needle,haystack){var key=null;if(needle instanceof Array){for(key in needle)if(needle.hasOwnProperty(key)){if(in_array(needle[key],haystack))
return true;}}
else{for(key in haystack)if(haystack.hasOwnProperty(key)){if(!isNaN(key)&&(haystack[key]===needle))
return true;}}
return false;}
function ucwords(data){return data.replace(/^(.)|\s(.)/g,function($1){return $1.toUpperCase();});}
function uniqid(){return str_shuffle('958753cfb564e097e2f9121a43da98708727f30365b1da846cc6fae22afe7ebcbda4030bd81f1e4d0615b96358dc294c').substr(0,8);}
if(!Function.prototype.hasOwnProperty('bind')){Function.prototype.bind=function(owner){var that=this,args=Array.prototype.slice.call(arguments,1);return function(){return that.apply(owner,(args.length===0)?arguments:(arguments.length===0)?args:args.concat(Array.prototype.slice.call(arguments,0)));};};}
var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||'an unknown browser';this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||'an unknown version';this.OS=this.searchString(this.dataOS)||'an unknown OS';},searchString:function(data){var i,dataString,dataProp;for(i=0;i<data.length;i++){dataString=data[i].string;dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!==-1)
return data[i].identity;}
else if(dataProp){return data[i].identity;}}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index===-1)
return;else
return parseFloat(dataString.substring(index+this.versionSearchString.length+1));},dataBrowser:[{string:navigator.userAgent,subString:'Chrome',identity:'Chrome'},{string:navigator.userAgent,subString:'OmniWeb',versionSearch:'OmniWeb/',identity:'OmniWeb'},{string:navigator.vendor,subString:'Apple',identity:'Safari',versionSearch:'Version'},{prop:window.opera,identity:'Opera',versionSearch:'Version'},{string:navigator.vendor,subString:'iCab',identity:'iCab'},{string:navigator.vendor,subString:'KDE',identity:'Konqueror'},{string:navigator.userAgent,subString:'Firefox',identity:'Firefox'},{string:navigator.vendor,subString:'Camino',identity:'Camino'},{string:navigator.userAgent,subString:'Netscape',identity:'Netscape'},{string:navigator.userAgent,subString:'MSIE',identity:'Internet Explorer',versionSearch:'MSIE'},{string:navigator.userAgent,subString:'Gecko',identity:'Mozilla',versionSearch:'rv'},{string:navigator.userAgent,subString:'Mozilla',identity:'Netscape',versionSearch:'Mozilla'}],dataOS:[{string:navigator.platform,subString:'Win',identity:'Windows'},{string:navigator.platform,subString:'Mac',identity:'Mac'},{string:navigator.userAgent,subString:'iPhone',identity:'iPhone/iPod'},{string:navigator.platform,subString:'Linux',identity:'Linux'}]};BrowserDetect.init();