/**
 * Copyright 2008-2020 | Fabrice Creuzot (luigifab) <code~luigifab~fr>
 * https://www.luigifab.fr/openmage/apijs
 * This program is free software, you can redistribute it or modify
 * it under the terms of the GNU General Public License (GPL).
 */
var apijsOpenMage=new function(){"use strict";this.hide=!1,this.start=function(){var e=apijs.i18n.data;e.cs[252]="Chyba",e.de[250]="Eine Datei löschen",e.de[251]="Sind Sie sicher, dass Sie diese Datei löschen möchten?[br]Achtung, diese Aktion ist unrückgängig.",e.de[252]="Fehler",e.de[253]="Sie verfügen nicht über die notwendigen Rechte um diese Operation durchzuführen, bitte [a §]aktualisieren Sie die Seite[/a].",e.de[254]="Es tut uns leid, diese Datei existiert nicht mehr, bitte [a §]aktualisieren Sie die Seite[/a].",e.en[250]="Remove a file",e.en[251]="Are you sure you want to remove this file?[br]Be careful, you can't cancel this operation.",e.en[252]="Error",e.en[253]="You are not authorized to perform this operation, please [a §]refresh the page[/a].",e.en[254]="Sorry, the file no longer exists, please [a §]refresh the page[/a].",e.en[255]="Clear cache",e.en[256]="Are you sure you want to clear the cache?[br]Be careful, you can't cancel this operation.",e.es[250]="Borrar un archivo",e.es[251]="¿Está usted seguro-a de que desea eliminar este archivo?[br]Atención, pues no podrá cancelar esta operación.",e.es[253]="No está autorizado-a para llevar a cabo esta operación, por favor [a §]actualice la página[/a].",e.es[254]="Disculpe, pero el archivo ya no existe, por favor [a §]actualice la página[/a].",e.fr[250]="Supprimer un fichier",e.fr[251]="Êtes-vous certain(e) de vouloir supprimer ce fichier ?[br]Attention, cette opération n'est pas annulable.",e.fr[252]="Erreur",e.fr[253]="Vous n'êtes pas autorisé(e) à effectuer cette opération, veuillez [a §]actualiser la page[/a].",e.fr[254]="Désolé, le fichier n'existe plus, veuillez [a §]actualiser la page[/a].",e.fr[255]="Vider le cache",e.fr[256]="Êtes-vous certain(e) de vouloir vider le cache ?[br]Attention, cette opération n'est pas annulable.",e.it[250]="Eliminare un file",e.it[251]="Sicuri di voler eliminare il file?[br]Attenzione, questa operazione non può essere annullata.",e.it[252]="Errore",e.it[253]="Non siete autorizzati a eseguire questa operazione, vi preghiamo di [a §]ricaricare la pagina[/a].",e.it[254]="Spiacenti, il file non esiste più, vi preghiamo di [a §]ricaricare la pagina[/a].",e.ja[250]="ファイルを削除",e.ja[252]="エラー",e.nl[252]="Fout",e.pl[252]="Błąd",e.pt[250]="Suprimir um ficheiro",e.pt[251]="Tem certeza de que quer suprimir este ficheiro?[br]Atenção, não pode cancelar esta operação.",e.pt[252]="Erro",e.pt[253]="Não é autorizado(a) para efetuar esta operação, por favor [a §]atualize a página[/a].",e.pt[254]="Lamento, o ficheiro já não existe, por favor [a §]atualize a página[/a].",e.ru[250]="Удалить файл",e.ru[251]="Вы уверены, что хотите удалить этот файл?[br]Осторожно, вы не сможете отменить эту операцию.",e.ru[252]="Ошибка",e.ru[253]="Вы не авторизованы для выполнения этой операции, пожалуйста [a §]обновите страницу[/a].",e.ru[254]="Извините, но файл не существует, пожалуйста [a §]обновите страницу[/a].",e.tr[252]="Hata",e.zh[252]="错误信息"},this.error=function(e){"string"==typeof e||e.indexOf("<!DOCTYPE")<0?apijs.dialog.has("upload")?apijs.upload.onError(!1,e):apijs.dialog.dialogInformation(apijs.i18n.translate(252),e,"error"):(apijs.dialog.remove("lock"),self.location.reload())},this.sendFiles=function(e,a,t,i){apijs.upload.sendFiles(e,a,"myimage",t,i,"jpg,jpeg,gif,png",apijsOpenMage.updateForm)},this.actionSave=function(e){document.getElementById("apijsGallery").setAttribute("style","opacity:0.4; cursor:progress;");var a=new XMLHttpRequest;a.open("POST",e+"?isAjax=true",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4===a.readyState&&([0,200].has(a.status)?0===a.responseText.indexOf("success-")?apijsOpenMage.updateForm(a.responseText):apijsOpenMage.error(a.responseText):apijsOpenMage.error(a.status),document.getElementById("apijsGallery").removeAttribute("style"))},a.send(apijs.serialize(document.getElementById("product_edit_form"),"apijs"))},this.updateForm=function(e){var a;-1<e.indexOf("{")&&(e=JSON.parse(e.slice(e.indexOf("{")))).bbcode&&apijsOpenMage.error(e.bbcode),(a=document.getElementById("apijsGallery"))?(a.parentNode.innerHTML=e.html,a.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(function(e){e.checked=e.hasAttribute("checked"),e.hasAttribute("onchange")&&apijsOpenMage.checkVal(e)}),apijs.slideshow.init(),apijs.dialog.has("error")||apijs.dialog.actionClose()):MediabrowserInstance.selectFolder(MediabrowserInstance.currentNode),self.dispatchEvent(new CustomEvent("apijsformupdated"))},this.removeAttachment=function(e){apijs.dialog.dialogConfirmation(apijs.i18n.translate(250),apijs.i18n.translate(251),apijsOpenMage.actionRemoveAttachment,e)},this.actionRemoveAttachment=function(e){var a=new XMLHttpRequest;a.open("GET",e,!0),a.onreadystatechange=function(){4===a.readyState&&([0,200].has(a.status)?0===a.responseText.indexOf("success-")?apijsOpenMage.updateForm(a.responseText):apijsOpenMage.error(a.responseText):apijsOpenMage.error(a.status))},a.send()},this.removeMedia=function(e){(e=e.parentNode.parentNode).click(),e.classList.contains("selected")||e.click(),apijs.dialog.dialogConfirmation(apijs.i18n.translate(250),apijs.i18n.translate(251),apijsOpenMage.actionRemoveMedia,e.id)},this.actionRemoveMedia=function(e){new Ajax.Request(MediabrowserInstance.deleteFilesUrl,{parameters:{files:Object.toJSON([e])},onSuccess:function(e){try{MediabrowserInstance.onAjaxSuccess(e),MediabrowserInstance.selectFolder(MediabrowserInstance.currentNode)}catch(e){alert(e.message)}}.bind(MediabrowserInstance)})},this.clearCache=function(a){try{apijs.dialog.dialogConfirmation(apijs.i18n.translate(255),apijs.i18n.translate(256),apijsOpenMage.actionClearCache,a)}catch(e){console.error(e),confirm(Translator.translate("Are you sure?"))&&(self.location.href=a)}},this.actionClearCache=function(e){apijs.dialog.remove("waiting","lock"),self.location.href=e},this.checkVal=function(e){for(var a=e;"BODY"!==a.nodeName&&!a.querySelector(".val");)a=a.parentNode;(a=a.querySelector(".val"))&&(e.checked?a.setAttribute("disabled","disabled"):a.removeAttribute("disabled"))},this.overloadMediabrowser=function(){var e=[];"function"==typeof Mediabrowser&&e.push(Mediabrowser),"object"==typeof MediabrowserInstance&&e.push(MediabrowserInstance),e.forEach(function(e){"function"!=typeof e.origHideElement&&(e.origHideElement=e.hideElement,e.hideElement=function(e){this.origHideElement(e),"loading-mask"===e&&(document.getElementById("contents").classList.remove("no-display"),document.getElementById("contents-loader").classList.add("no-display"),apijs.dialog.has("error")||apijs.dialog.actionClose())},e.origShowElement=e.showElement,e.showElement=function(e){this.origShowElement(e),"loading-mask"===e&&(document.getElementById("contents").classList.add("no-display"),document.getElementById("contents-loader").classList.remove("no-display"))},e.origDrawBreadcrumbs=e.drawBreadcrumbs,e.drawBreadcrumbs=function(e){this.origDrawBreadcrumbs(e),document.getElementById("breadcrumbs")||(e=this.tree.getNodeById("root"),$("content_header").insert({after:'<ul class="breadcrumbs" id="breadcrumbs"><li><a href="#" onclick="MediabrowserInstance.selectFolderById(\''+e.id+"');\">"+e.text+"</a></li></ul>"}))})}),MediabrowserInstance.deleteFilesUrl=MediabrowserInstance.deleteFilesUrl.replace(/[a-z_]+\/deleteFiles\//,"apijs_wysiwyg/deleteFiles/"),MediabrowserInstance.deleteFolderUrl=MediabrowserInstance.deleteFolderUrl.replace(/[a-z_]+\/deleteFolder\//,"apijs_wysiwyg/deleteFolder/")},this.toggleVisibility=function(){this.hide=!this.hide,document.getElementById("apijsGallery").querySelectorAll("input.exclude").forEach(function(e){var a=e.parentNode.parentNode.parentNode;e.checked?a.classList[this.hide?"add":"remove"]("no-display"):a.classList.remove("no-display")},this)}};"function"==typeof self.addEventListener&&self.addEventListener("apijsload",apijsOpenMage.start.bind(apijsOpenMage));